{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/anchor/utils/messageGenerator.ts","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/anchor/utils/variableUpdater.ts","src://tavern_helper_template/src/anchor/utils/textParser.ts","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/src/anchor/utils/variableReader.ts","src://tavern_helper_template/src/anchor/components/SplashScreen.ts","src://tavern_helper_template/src/anchor/components/NewGameSetup.ts","src://tavern_helper_template/external var \"showdown\"","src://tavern_helper_template/external var \"YAML\"","src://tavern_helper_template/src/anchor/components/Dashboard.ts","src://tavern_helper_template/src/anchor/utils/pageManager.ts","src://tavern_helper_template/src/anchor/utils/gameInitializer.ts","src://tavern_helper_template/src/anchor/dashboardLogic.ts","src://tavern_helper_template/src/anchor/app.ts","src://tavern_helper_template/src/anchor/index.ts"],"sourcesContent":["/**\n * \n *  ->  user  ->  LLM ->  ->  assistant \n */\n\n// \ndeclare function getChatMessages(\n  range: string | number,\n  options?: { role?: 'all' | 'system' | 'assistant' | 'user' },\n): Array<{ message: string; message_id: number; role: string; data?: Record<string, any> }>;\n\ndeclare function createChatMessages(\n  messages: Array<{ role: 'user' | 'assistant' | 'system'; message: string; data?: Record<string, any> }>,\n  options?: { refresh?: 'none' | 'affected' | 'all' },\n): Promise<void>;\n\ndeclare function deleteChatMessages(message_ids: number[], options?: { refresh?: 'none' | 'all' }): Promise<void>;\n\ndeclare function getLastMessageId(): number;\n\ndeclare function generate(config: { user_input?: string; should_stream?: boolean }): Promise<string>;\n\n//  generate \nfunction checkGenerateAvailable(): boolean {\n  if (typeof generate === 'undefined') {\n    //  window \n    if (typeof window !== 'undefined' && (window as any).generate) {\n      return true;\n    }\n    return false;\n  }\n  return true;\n}\n\ndeclare function waitGlobalInitialized(name: string): Promise<void>;\n\ndeclare function eventOn(event: string, callback: (...args: any[]) => void): void;\n\ndeclare const iframe_events: {\n  STREAM_TOKEN_RECEIVED_FULLY: 'js_stream_token_received_fully';\n  GENERATION_ENDED: 'js_generation_ended';\n};\n\n// MVU \ndeclare const Mvu: {\n  getMvuData: (options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' }) => {\n    stat_data: Record<string, any>;\n    display_data: Record<string, any>;\n    delta_data: Record<string, any>;\n  };\n  parseMessage?: (message: string, old_data: any) => Promise<any | undefined>;\n};\n\nimport _ from 'lodash';\nimport {\n  extractAllOptions,\n  extractLastMaintext,\n  extractLastOption,\n  extractLastSum,\n  extractLastUpdateVariable,\n  removeOptionTags,\n  removeSuboptionTags,\n  removeThinkingTags,\n  removeThinkingTagsFromStream,\n  validateMessage,\n} from './textParser';\n\n//  setChatMessages\ndeclare function setChatMessages(\n  chat_messages: Array<{ message_id: number; message?: string; data?: Record<string, any> }>,\n  options?: { refresh?: 'none' | 'affected' | 'all' },\n): Promise<void>;\n\n/**\n *  data \n */\nasync function cleanOpeningMessage(): Promise<void> {\n  try {\n    const messages = getChatMessages(0);\n    if (!messages || messages.length === 0) return;\n\n    const openingMsg = messages[0];\n    if (openingMsg.role !== 'assistant') return;\n\n    const hasOptions = openingMsg.message.includes('<option>') || openingMsg.message.includes('<suboption>');\n    if (!hasOptions) return;\n\n    console.log(' ...');\n\n    // 1. \n    const options = extractAllOptions(openingMsg.message);\n\n    // 2. \n    let cleanedMessage = removeOptionTags(openingMsg.message);\n    cleanedMessage = removeSuboptionTags(cleanedMessage);\n\n    // 3. \n    await setChatMessages(\n      [\n        {\n          message_id: 0,\n          message: cleanedMessage,\n          data: {\n            ...(openingMsg.data || {}),\n            __options: options,\n          },\n        },\n      ],\n      { refresh: 'none' },\n    );\n\n    console.log('  data.__options');\n  } catch (error) {\n    console.warn(' :', error);\n  }\n}\n\n/**\n *  MVU \n */\nasync function getBaseMvuData(): Promise<any> {\n  try {\n    //  MVU \n    await waitGlobalInitialized('Mvu');\n\n    //  init(0) / latest message / chatchat  base\n    let initData: any = null;\n    let latestData: any = null;\n    let chatData: any = null;\n    try {\n      initData = Mvu.getMvuData({ type: 'message', message_id: 0 });\n    } catch {\n      // ignore\n    }\n    try {\n      latestData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    } catch {\n      // ignore\n    }\n    try {\n      chatData = Mvu.getMvuData({ type: 'chat' });\n    } catch {\n      // ignore\n    }\n\n    const base = _.merge({}, initData ?? {}, latestData ?? {}, chatData ?? {});\n    console.log('  MVU(merged) ');\n\n    // \n    return (\n      base ?? {\n        stat_data: {},\n        display_data: {},\n        delta_data: {},\n      }\n    );\n  } catch (error) {\n    console.warn('  MVU :', error);\n    //  MVU  MVU \n    return {\n      stat_data: {},\n      display_data: {},\n      delta_data: {},\n    };\n  }\n}\n\n/**\n * \n */\nexport interface MessageGeneratorCallbacks {\n  onShowGenerating?: () => void; // \n  onHideGenerating?: () => void; // \n  onError?: (error: string) => void; // \n  onStreamingUpdate?: (text: string) => void; //  maintext \n  onRefreshStoryIfOpen?: (userMessage: string) => void; // user\n  onRefreshStory?: (options?: string[]) => void; // assistant\n  onCreatedMessages?: (ids: { userMessageId: number; assistantMessageId: number }) => void; // user+assistant  id\n}\n\n/**\n *  assistant  user \n *  assistant  user  AI \n */\nexport async function regenerateAssistantMessage(\n  userMessageId: number,\n  callbacks: MessageGeneratorCallbacks = {},\n): Promise<boolean> {\n  try {\n    if (callbacks.onShowGenerating) callbacks.onShowGenerating();\n\n    // \n    let streamingHandler: ((fullText: string) => void) | null = null;\n    if (typeof eventOn !== 'undefined' && iframe_events?.STREAM_TOKEN_RECEIVED_FULLY) {\n      streamingHandler = (fullText: string) => {\n        const cleanedText = removeThinkingTagsFromStream(fullText);\n        if (!cleanedText || cleanedText.trim().length === 0) {\n          callbacks.onStreamingUpdate?.('');\n          return;\n        }\n        callbacks.onStreamingUpdate?.(cleanedText);\n      };\n      eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, streamingHandler);\n      console.log(' [regen] ');\n    } else {\n      console.log(' [regen] ');\n    }\n\n    //  generate \n    if (!checkGenerateAvailable()) {\n      throw new Error('generate ');\n    }\n\n    // generate user_input/\n    const generatePromise = generate({ should_stream: true });\n    const timeoutPromise = new Promise<string>((_, reject) => {\n      setTimeout(() => reject(new Error('generate 5')), 5 * 60 * 1000);\n    });\n    const result = await Promise.race([generatePromise, timeoutPromise]);\n\n    const cleanedResult = removeThinkingTags(result);\n    if (!cleanedResult || !validateMessage(cleanedResult)) {\n      if (callbacks.onHideGenerating) callbacks.onHideGenerating();\n      callbacks.onError?.('');\n      return false;\n    }\n\n    const maintext = extractLastMaintext(cleanedResult);\n    const option = extractLastOption(cleanedResult);\n    const sum = extractLastSum(cleanedResult);\n    const updateVariable = extractLastUpdateVariable(cleanedResult);\n\n    if (!maintext || !option) {\n      if (callbacks.onHideGenerating) callbacks.onHideGenerating();\n      callbacks.onError?.(' maintext  option');\n      return false;\n    }\n\n    let finalMessage = `<maintext>${maintext}</maintext>\\n\\n<option>${option}</option>`;\n    if (sum) finalMessage += `\\n\\n<sum>${sum}</sum>`;\n    if (updateVariable) finalMessage += `\\n\\n<UpdateVariable>${updateVariable}</UpdateVariable>`;\n\n    // base  userMessage.data regenerate  user \n    let base: any = null;\n    try {\n      const userMsg = getChatMessages(userMessageId)?.[0];\n      if (userMsg?.data) base = userMsg.data;\n    } catch {\n      // ignore\n    }\n    if (!base) {\n      try {\n        base =\n          getChatMessages(-1, { role: 'assistant' })?.[0]?.data ??\n          Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n      } catch {\n        base = { stat_data: {}, display_data: {}, delta_data: {} };\n      }\n    }\n\n    if (!base || typeof base !== 'object') base = { stat_data: {}, display_data: {}, delta_data: {} };\n    if (!base.stat_data) base.stat_data = {};\n    if (!base.display_data) base.display_data = {};\n    if (!base.delta_data) base.delta_data = {};\n\n    // MVU \n    let finalData = base;\n    if (Mvu.parseMessage) {\n      try {\n        const parsed = await Mvu.parseMessage(finalMessage, base);\n        if (parsed) finalData = parsed;\n      } catch (e) {\n        console.warn(' [regen] MVU :', e);\n      }\n    }\n\n    const extractedOptions = extractAllOptions(finalMessage);\n\n    //  maintext  sum\n    const maintextContent = extractLastMaintext(finalMessage);\n    const sumContent = extractLastSum(finalMessage);\n\n    let messageToSave = maintextContent || finalMessage;\n    if (sumContent) {\n      if (maintextContent) {\n        messageToSave = `${maintextContent}\\n\\n<sum>${sumContent}</sum>`;\n      } else if (!finalMessage.includes(`<sum>${sumContent}</sum>`)) {\n        messageToSave = `${finalMessage}\\n\\n<sum>${sumContent}</sum>`;\n      }\n    }\n\n    await createChatMessages(\n      [\n        {\n          role: 'assistant',\n          message: messageToSave,\n          data: {\n            ...finalData,\n            __options: extractedOptions,\n          },\n        },\n      ],\n      { refresh: 'none' },\n    );\n\n    const assistantMessageId = getLastMessageId();\n    console.log(' [regen] assistant ID:', assistantMessageId);\n\n    //  iduserMessageId \n    callbacks.onCreatedMessages?.({ userMessageId, assistantMessageId });\n\n    if (callbacks.onHideGenerating) callbacks.onHideGenerating();\n\n    setTimeout(() => {\n      callbacks.onRefreshStory?.(extractedOptions);\n    }, 300);\n\n    return true;\n  } catch (error) {\n    console.error(' [regen]  assistant :', error);\n    if (callbacks.onHideGenerating) callbacks.onHideGenerating();\n    callbacks.onError?.(error instanceof Error ? error.message : '');\n    return false;\n  }\n}\n\n/**\n * \n * @param userInput \n * @param callbacks \n */\nexport async function generateMessage(userInput: string, callbacks: MessageGeneratorCallbacks = {}): Promise<boolean> {\n  let userMessageId: number | null = null;\n\n  try {\n    // 0. \n    await cleanOpeningMessage();\n\n    // 1. UI\n    // \n\n    // 2. \"\"\n    if (callbacks.onShowGenerating) {\n      callbacks.onShowGenerating();\n    }\n\n    // 3.  MVU \n    const mvu_data = await getBaseMvuData();\n\n    // 4.  user \n    console.log(' [2]  user ...');\n    console.log(' [2] :', userInput);\n    console.log(' [2] MVU :', mvu_data ? '' : '');\n\n    try {\n      await createChatMessages(\n        [\n          {\n            role: 'user',\n            message: userInput, //  \n            data: mvu_data, //  MVU \n          },\n        ],\n        {\n          refresh: 'none', // \n        },\n      );\n      console.log(' [2] user ');\n\n      // 9.  user  ID\n      userMessageId = getLastMessageId();\n      console.log(' [2] user ID:', userMessageId);\n\n      //  ID AI  User  ID\n      if (callbacks.onCreatedMessages && userMessageId !== null) {\n        try {\n          callbacks.onCreatedMessages({ userMessageId, assistantMessageId: -1 });\n        } catch (e) {\n          console.warn(' onCreatedMessages (user) :', e);\n        }\n      }\n\n      // 10. mhjg\n      // \n      const checkAndRefresh = async (retries = 5) => {\n        const checkMessageId = getLastMessageId();\n        if (checkMessageId === userMessageId) {\n          // \n          const messages = getChatMessages(checkMessageId);\n          if (messages && messages.length > 0 && messages[0].role === 'user') {\n            if (callbacks.onRefreshStoryIfOpen) {\n              callbacks.onRefreshStoryIfOpen(messages[0].message);\n              console.log(' [2] ID:', userMessageId);\n            }\n            return;\n          }\n        }\n\n        // \n        if (retries > 0) {\n          setTimeout(() => checkAndRefresh(retries - 1), 50);\n        } else if (callbacks.onRefreshStoryIfOpen) {\n          // \n          callbacks.onRefreshStoryIfOpen(userInput);\n          console.log(' [2] ');\n        }\n      };\n\n      setTimeout(() => checkAndRefresh(), 50);\n    } catch (createError) {\n      console.error(' [2] createChatMessages :', createError);\n      throw new Error(\n        ` user : ${createError instanceof Error ? createError.message : String(createError)}`,\n      );\n    }\n\n    // 5.  generate \n    let streamingHandler: ((fullText: string) => void) | null = null;\n    if (typeof eventOn !== 'undefined' && iframe_events?.STREAM_TOKEN_RECEIVED_FULLY) {\n      streamingHandler = (fullText: string) => {\n        //  <thinking> \n        const cleanedText = removeThinkingTagsFromStream(fullText);\n\n        //  thinking \n        if (!cleanedText || cleanedText.trim().length === 0) {\n          if (callbacks.onStreamingUpdate) {\n            callbacks.onStreamingUpdate('');\n          }\n          return;\n        }\n\n        //  cleanedText/\n        if (callbacks.onStreamingUpdate) {\n          callbacks.onStreamingUpdate(cleanedText);\n        }\n      };\n\n      eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, streamingHandler);\n      console.log(' [3] ');\n    } else {\n      console.log(' [3] ');\n    }\n\n    // 6.  generate  LLM \n    console.log(' [3]  generate ...');\n    console.log(' [3] :', userInput);\n\n    //  generate \n    if (!checkGenerateAvailable()) {\n      console.error(' [3] generate ');\n      console.error(' [3] ');\n      console.error('   1. ');\n      console.error('   2.  iframe ');\n      console.error('   3.  generate ');\n      throw new Error('generate ');\n    }\n\n    let result: string;\n    try {\n      console.log(' [3]  generate...');\n      console.log(' [3] generate :', typeof generate);\n\n      // \n      const generatePromise = generate({\n        // user_input: userInput, // \n        should_stream: true, // \n      });\n\n      // 5\n      const timeoutPromise = new Promise<string>((_, reject) => {\n        setTimeout(\n          () => {\n            reject(new Error('generate 5'));\n          },\n          5 * 60 * 1000,\n        );\n      });\n\n      result = await Promise.race([generatePromise, timeoutPromise]);\n\n      console.log(' [3] generate :', result?.length || 0);\n      if (!result || result.length === 0) {\n        console.warn(' [3] generate ');\n      } else {\n        console.log(' [3] generate :', result.substring(0, 200) + '...');\n      }\n    } catch (generateError) {\n      console.error(' [3] generate :', generateError);\n      console.error(' [3] :', {\n        error: generateError,\n        errorType: typeof generateError,\n        errorMessage: generateError instanceof Error ? generateError.message : String(generateError),\n        errorStack: generateError instanceof Error ? generateError.stack : undefined,\n      });\n\n      // \n      if (generateError instanceof Error && generateError.message.includes('')) {\n        throw new Error('generate  LLM ');\n      }\n\n      throw new Error(\n        `generate : ${generateError instanceof Error ? generateError.message : String(generateError)}`,\n      );\n    }\n\n    // 7.  <thinking> \n    const cleanedResult = removeThinkingTags(result);\n\n    // 8. \n    if (!cleanedResult || !validateMessage(cleanedResult)) {\n      console.error(' [4] generate ');\n      // \n      if (callbacks.onHideGenerating) {\n        callbacks.onHideGenerating();\n      }\n      if (callbacks.onError) {\n        callbacks.onError('');\n      }\n      return false;\n    }\n\n    // 12.  <maintext><option><sum>  <UpdateVariable>\n    const maintext = extractLastMaintext(cleanedResult);\n    const option = extractLastOption(cleanedResult);\n    const sum = extractLastSum(cleanedResult);\n    const updateVariable = extractLastUpdateVariable(cleanedResult);\n\n    if (!maintext || !option) {\n      console.error(' [5]  maintext  option');\n      // \n      if (callbacks.onHideGenerating) {\n        callbacks.onHideGenerating();\n      }\n      if (callbacks.onError) {\n        callbacks.onError(' maintext  option');\n      }\n      return false;\n    }\n\n    // 13.  maintextoptionsum UpdateVariable\n    //  MVU \n    let finalMessage = `<maintext>${maintext}</maintext>\\n\\n<option>${option}</option>`;\n    if (sum) {\n      finalMessage += `\\n\\n<sum>${sum}</sum>`;\n      console.log(' [5]  <sum> ');\n    }\n    if (updateVariable) {\n      finalMessage += `\\n\\n<UpdateVariable>${updateVariable}</UpdateVariable>`;\n      console.log(' [5]  <UpdateVariable> ');\n    }\n\n    // 14.  MVU  user \n    console.log(' [6]  MVU ...');\n    let base: any;\n    if (userMessageId !== null) {\n      const userMessage = getChatMessages(userMessageId)?.[0];\n      if (userMessage?.data) {\n        base = userMessage.data;\n        console.log(' [6]  user ');\n      }\n    }\n\n    //  user  data assistant  MVU \n    if (!base) {\n      console.log(' [6]  assistant  MVU ...');\n      base =\n        getChatMessages(-1, { role: 'assistant' })?.[0]?.data ??\n        Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n      console.log(' [6]  assistant  MVU ');\n    }\n\n    //  base \n    if (!base || typeof base !== 'object') {\n      console.log(' [6] base ');\n      base = { stat_data: {}, display_data: {}, delta_data: {} };\n    }\n    if (!base.stat_data) base.stat_data = {};\n    if (!base.display_data) base.display_data = {};\n    if (!base.delta_data) base.delta_data = {};\n\n    // 15.  MVU  MVU.parseMessage \n    console.log(' [7]  MVU ...');\n    let finalData = base;\n    if (Mvu.parseMessage) {\n      try {\n        const parsed = await Mvu.parseMessage(finalMessage, base);\n        if (parsed) {\n          finalData = parsed;\n          console.log(' [7] MVU ');\n        } else {\n          console.log(' [7] MVU  undefined');\n        }\n      } catch (error) {\n        console.warn(' [7] MVU :', error);\n      }\n    } else {\n      console.log(' [7] MVU.parseMessage ');\n    }\n\n    // 16.  createChatMessages  finalMessage \n    console.log(' [8] ...');\n    const extractedOptions = extractAllOptions(finalMessage);\n    console.log(' [8] :', extractedOptions.length, '');\n\n    // 17.  assistant  <maintext>  <sum> \n    console.log(' [9]  assistant ...');\n    //  finalMessage  maintext  maintext \n    const maintextContent = extractLastMaintext(finalMessage);\n    const sumContent = extractLastSum(finalMessage);\n\n    let messageToSave = maintextContent || finalMessage;\n    if (sumContent) {\n      if (maintextContent) {\n        messageToSave = `${maintextContent}\\n\\n<sum>${sumContent}</sum>`;\n      } else if (!finalMessage.includes(`<sum>${sumContent}</sum>`)) {\n        messageToSave = `${finalMessage}\\n\\n<sum>${sumContent}</sum>`;\n      }\n    }\n\n    if (!maintextContent) {\n      console.warn(' [9]  finalMessage  maintext finalMessage');\n    } else {\n      console.log(' [9]  maintext  maintext  sum ');\n    }\n\n    await createChatMessages(\n      [\n        {\n          role: 'assistant',\n          message: messageToSave, //  maintext \n          data: {\n            ...finalData, // \n            __options: extractedOptions, //   data \n          },\n        },\n      ],\n      {\n        refresh: 'none', // \n      },\n    );\n    console.log(' [9] assistant ');\n\n    // 18.  ID\n    const assistantMessageId = getLastMessageId();\n    console.log(' [10]  ID:', assistantMessageId);\n\n    // 18.1  message_id/\n    if (callbacks.onCreatedMessages && userMessageId !== null) {\n      try {\n        callbacks.onCreatedMessages({ userMessageId, assistantMessageId });\n      } catch (e) {\n        console.warn(' onCreatedMessages :', e);\n      }\n    }\n\n    // 19. \n    if (callbacks.onHideGenerating) {\n      callbacks.onHideGenerating();\n    }\n\n    // 20. \n    // \n    setTimeout(() => {\n      if (callbacks.onRefreshStory) {\n        callbacks.onRefreshStory(extractedOptions);\n        console.log(' [11] ');\n      }\n    }, 300);\n\n    return true;\n  } catch (error) {\n    console.error(' :', error);\n\n    // \n    if (callbacks.onHideGenerating) {\n      callbacks.onHideGenerating();\n    }\n\n    // \n    if (callbacks.onError) {\n      callbacks.onError(error instanceof Error ? error.message : '');\n    }\n\n    return false;\n  }\n}\n","module.exports = _;","import _ from 'lodash';\nimport { GameConfig, GameData } from '../types/types';\n\n// \ndeclare function waitGlobalInitialized(name: string): Promise<void>;\ndeclare const Mvu: {\n  getMvuData: (options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' }) => {\n    stat_data: Record<string, any>;\n    display_data: Record<string, any>;\n    delta_data: Record<string, any>;\n  };\n  replaceMvuData: (\n    mvu_data: any,\n    options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' },\n  ) => Promise<void>;\n};\n\n/**\n *  MVU  MVU \n */\nexport async function updateMvuVariables(config: GameConfig): Promise<void> {\n  try {\n    //  MVU \n    await waitGlobalInitialized('Mvu');\n\n    //  MVU \n    //  chat \n    //  init(0) / latest message  reserve  system_state \n    let initData: any = null;\n    let latestData: any = null;\n    let chatData: any = null;\n    try {\n      initData = Mvu.getMvuData({ type: 'message', message_id: 0 });\n    } catch {\n      // ignore\n    }\n    try {\n      latestData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    } catch {\n      // ignore\n    }\n    chatData = Mvu.getMvuData({ type: 'chat' });\n\n    const currentMvuData = _.merge({}, initData ?? {}, latestData ?? {}, chatData ?? {});\n    const currentStatData = currentMvuData?.stat_data || {};\n\n    //  stat_data\n    const updatedStatData = _.cloneDeep(currentStatData);\n\n    //  system_state.antimatter.reserve\n    if (config.reserve !== undefined) {\n      if (!updatedStatData.system_state) {\n        updatedStatData.system_state = {};\n      }\n      if (!updatedStatData.system_state.antimatter) {\n        updatedStatData.system_state.antimatter = {};\n      }\n      //  reserve  0-100000 \n      const clampedReserve = _.clamp(config.reserve, 0, 100000);\n      updatedStatData.system_state.antimatter.reserve = clampedReserve;\n      console.info(`  system_state.antimatter.reserve: ${clampedReserve}`);\n    }\n\n    //  MVU\n    const updatedMvuData = {\n      ...currentMvuData,\n      stat_data: updatedStatData,\n    };\n\n    await Mvu.replaceMvuData(updatedMvuData, { type: 'chat' });\n    console.info(' MVU ');\n  } catch (error) {\n    console.error('  MVU :', error);\n    throw error;\n  }\n}\n\n/**\n * \n */\nexport async function updateGameData(data: Partial<GameData>): Promise<void> {\n  try {\n    const currentData = getVariables({ type: 'message' });\n    const updatedData = {\n      ...currentData,\n      game_data: {\n        ...(currentData.game_data || {}),\n        ...data,\n      },\n    };\n    replaceVariables(updatedData, { type: 'message' });\n    console.info('');\n  } catch (error) {\n    console.error(':', error);\n    throw error;\n  }\n}\n\n/**\n * \n */\nexport async function updateGameConfig(config: GameConfig): Promise<void> {\n  try {\n    const currentData = getVariables({ type: 'message' });\n    const updatedData = {\n      ...currentData,\n      game_config: config,\n    };\n    replaceVariables(updatedData, { type: 'message' });\n    console.info('');\n  } catch (error) {\n    console.error(':', error);\n    throw error;\n  }\n}\n\n/**\n * \n */\nexport async function initializeGameData(config: GameConfig): Promise<GameData> {\n  //  MVU  MVU\n  await updateMvuVariables(config);\n\n  // \n  const gameData: GameData = {\n    station_name: ' Alpha', // \n    difficulty: 'normal', // \n    resources: {\n      energy: 100,\n      supplies: 100,\n      crew: 10,\n    },\n    status: {\n      energy: 87,\n      life_support: 92,\n      system: 78,\n      personnel: '',\n      communication: 95,\n      laboratory: 83,\n      storage: 64,\n      computing: 71,\n    },\n    tasks: [],\n    diary: [],\n    messages: [],\n  };\n\n  await updateGameData(gameData);\n  await updateGameConfig(config);\n\n  return gameData;\n}\n","/**\n * \n *  LLM \n */\n\n/**\n *  <thinking> \n */\nexport function removeThinkingTags(text: string): string {\n  if (!text) return '';\n\n  //  <thinking>...</thinking> \n  let result = text;\n  let lastResult = '';\n\n  //  <thinking> \n  while (result !== lastResult) {\n    lastResult = result;\n    result = result.replace(/<thinking>[\\s\\S]*?<\\/thinking>/gi, '');\n  }\n\n  return result;\n}\n\n/**\n *  <thinking> \n * -  <thinking>...</thinking>\n * -  <thinking> <thinking> \n */\nexport function removeThinkingTagsFromStream(text: string): string {\n  if (!text) return '';\n\n  //  <thinking>...</thinking> \n  let cleaned = text.replace(/<thinking>[\\s\\S]*?<\\/thinking>/gi, '');\n\n  //  <thinking> \n  const lastThinkingStart = cleaned.lastIndexOf('<thinking>');\n\n  //  <thinking>\n  if (lastThinkingStart !== -1) {\n    cleaned = cleaned.substring(0, lastThinkingStart).trim();\n  }\n\n  return cleaned;\n}\n\n/**\n *  <sum> \n */\nexport function removeSumTags(text: string): string {\n  if (!text) return '';\n  return text.replace(/<sum>[\\s\\S]*?<\\/sum>/gi, '').trim();\n}\n\n/**\n *  <option> \n */\nexport function removeOptionTags(text: string): string {\n  if (!text) return '';\n  return text.replace(/<option>[\\s\\S]*?<\\/option>/gi, '').trim();\n}\n\n/**\n *  <suboption> \n */\nexport function removeSuboptionTags(text: string): string {\n  if (!text) return '';\n  return text.replace(/<suboption>[\\s\\S]*?<\\/suboption>/gi, '').trim();\n}\n\n/**\n *  summary \n * : : ... | : ... | : ... | : ...\n */\nexport function parseSummary(sumText: string): Record<string, string> {\n  if (!sumText) return {};\n\n  const result: Record<string, string> = {};\n  // \n  // : () (/) ( | )\n  const parts = sumText.split('|');\n\n  parts.forEach(part => {\n    const match = part.match(/^\\s*(||||Time|Location|Characters|Event)\\s*[:]\\s*([\\s\\S]*)$/i);\n    if (match) {\n      const key = match[1].trim();\n      const value = match[2].trim();\n      result[key] = value;\n    }\n  });\n\n  return result;\n}\n\n/**\n *  <maintext> \n */\nexport function extractLastMaintext(text: string): string {\n  const matches = text.match(/<maintext>([\\s\\S]*?)<\\/maintext>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  // \n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<maintext>([\\s\\S]*?)<\\/maintext>/i);\n  return contentMatch ? contentMatch[1].trim() : '';\n}\n\n/**\n *  <continue_choice> \n */\nexport function extractContinueChoice(text: string): string {\n  const matches = text.match(/<continue_choice>([\\s\\S]*?)<\\/continue_choice>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<continue_choice>([\\s\\S]*?)<\\/continue_choice>/i);\n  return contentMatch ? contentMatch[1].trim() : '';\n}\n\n/**\n *  <result> \n */\nexport function extractResult(text: string): string {\n  const matches = text.match(/<result>([\\s\\S]*?)<\\/result>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<result>([\\s\\S]*?)<\\/result>/i);\n  return contentMatch ? contentMatch[1].trim() : '';\n}\n\n/**\n *  <decision_node> \n */\nexport function extractNextChoice(text: string): string {\n  const matches = text.match(/<decision_node>([\\s\\S]*?)<\\/decision_node>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<decision_node>([\\s\\S]*?)<\\/decision_node>/i);\n  return contentMatch ? contentMatch[1].trim() : '';\n}\n\n/**\n *  <option> \n */\nexport function extractLastOption(text: string): string {\n  const matches = text.match(/<option>([\\s\\S]*?)<\\/option>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  // \n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<option>([\\s\\S]*?)<\\/option>/i);\n  return contentMatch ? contentMatch[1].trim() : '';\n}\n\n/**\n *  <suboption> \n * @returns  suboption \n */\nexport function extractAllOptions(text: string): string[] {\n  if (!text) return [];\n\n  //  <suboption> \n  const suboptionMatches = text.match(/<suboption>([\\s\\S]*?)<\\/suboption>/gi);\n  if (suboptionMatches && suboptionMatches.length > 0) {\n    const options: string[] = [];\n    suboptionMatches.forEach(match => {\n      const contentMatch = match.match(/<suboption>([\\s\\S]*?)<\\/suboption>/i);\n      if (contentMatch && contentMatch[1]) {\n        const content = contentMatch[1].trim();\n        if (content) {\n          options.push(content);\n        }\n      }\n    });\n    if (options.length > 0) {\n      return options;\n    }\n  }\n\n  //  <suboption> <option> \n  const optionMatches = text.match(/<option>([\\s\\S]*?)<\\/option>/gi);\n  if (!optionMatches || optionMatches.length === 0) {\n    return [];\n  }\n\n  //  option \n  const options: string[] = [];\n  optionMatches.forEach(match => {\n    const contentMatch = match.match(/<option>([\\s\\S]*?)<\\/option>/i);\n    if (contentMatch && contentMatch[1]) {\n      const content = contentMatch[1].trim();\n      if (content) {\n        // \n        const lines = content\n          .split('\\n')\n          .map(line => line.trim())\n          .filter(line => line);\n        if (lines.length > 1) {\n          // \n          options.push(...lines);\n        } else {\n          // \n          options.push(content);\n        }\n      }\n    }\n  });\n\n  return options;\n}\n\n/**\n *  <sum> \n */\nexport function extractLastSum(text: string): string {\n  const matches = text.match(/<sum>([\\s\\S]*?)<\\/sum>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  // \n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<sum>([\\s\\S]*?)<\\/sum>/i);\n  return contentMatch ? contentMatch[1].trim() : '';\n}\n\n/**\n *  <UpdateVariable> \n */\nexport function extractLastUpdateVariable(text: string): string {\n  const matches = text.match(/<UpdateVariable>([\\s\\S]*?)<\\/UpdateVariable>/gi);\n  if (!matches || matches.length === 0) {\n    return '';\n  }\n  // \n  const lastMatch = matches[matches.length - 1];\n  const contentMatch = lastMatch.match(/<UpdateVariable>([\\s\\S]*?)<\\/UpdateVariable>/i);\n  if (!contentMatch) {\n    return '';\n  }\n\n  const content = contentMatch[1].trim();\n\n  // \n  // MVU  JSONPatch \n  console.log('  <UpdateVariable> ');\n  return content;\n}\n\n/**\n *  maintext  option\n */\nexport function validateMessage(messageContent: string): boolean {\n  if (!messageContent || typeof messageContent !== 'string') {\n    return false;\n  }\n\n  //  thinking \n  const cleaned = removeThinkingTags(messageContent);\n  const maintext = extractLastMaintext(cleaned);\n  const option = extractLastOption(cleaned);\n\n  if (!maintext || !option) {\n    console.warn('  <maintext>  <option> ');\n    return false;\n  }\n\n  return true;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { GameData, GameConfig } from '../types/types';\nimport _ from 'lodash';\n\n// \ndeclare function getVariables(options: { type: 'message' | 'chat' | 'character' | 'global' }): Record<string, any>;\ndeclare function getLastMessageId(): number;\ndeclare function getChatMessages(\n  range: string | number,\n  options?: { role?: 'all' | 'system' | 'assistant' | 'user' },\n): Array<{ message: string; message_id: number; role: string; data?: Record<string, any> }>;\ndeclare function waitGlobalInitialized(name: string): Promise<void>;\ndeclare const Mvu: {\n  getMvuData: (options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' }) => {\n    stat_data: Record<string, any>;\n    display_data: Record<string, any>;\n    delta_data: Record<string, any>;\n  };\n};\n\n/**\n *  MVU \n */\nexport async function readGameData(): Promise<any> {\n  try {\n    //  MVU \n    if (typeof waitGlobalInitialized !== 'undefined') {\n      await waitGlobalInitialized('Mvu');\n    }\n\n    //  MVU  stat_data\n    if (typeof Mvu !== 'undefined' && Mvu.getMvuData) {\n      // init(0) -> latest message -> chatchat \n      let initData: any = null;\n      let latestData: any = null;\n      let chatData: any = null;\n      try {\n        initData = Mvu.getMvuData({ type: 'message', message_id: 0 });\n      } catch {\n        // ignore\n      }\n      try {\n        latestData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n      } catch {\n        // ignore\n      }\n      try {\n        chatData = Mvu.getMvuData({ type: 'chat' });\n      } catch {\n        // ignore\n      }\n\n      const merged = _.merge({}, initData ?? {}, latestData ?? {}, chatData ?? {});\n      return _.get(merged, 'stat_data') || {};\n    }\n\n    // \n    const variables = getVariables({ type: 'message' });\n    const gameData = variables.game_data || variables.stat_data || {};\n    return gameData;\n  } catch (error) {\n    console.warn(':', error);\n    return {};\n  }\n}\n\n/**\n * \n *  assistant \n * - assistant  1  false\n * - assistant  > 1  true\n */\nexport function hasSaveData(): boolean {\n  try {\n    //  assistant \n    const lastMessageId = getLastMessageId();\n    if (lastMessageId < 0) {\n      return false; // \n    }\n\n    //  assistant \n    const messages = getChatMessages(`0-${lastMessageId}`, { role: 'assistant' });\n\n    //  1  assistant \n    //  1  assistant \n    return messages && messages.length > 1;\n  } catch (error) {\n    console.warn(':', error);\n    return false;\n  }\n}\n\n/**\n * \n */\nexport function readGameConfig(): Partial<GameConfig> {\n  try {\n    const variables = getVariables({ type: 'message' });\n    const config = variables.game_config || {};\n    return config as Partial<GameConfig>;\n  } catch (error) {\n    console.warn(':', error);\n    return {};\n  }\n}\n","import { ComponentCallbacks } from '../types/types';\nimport { hasSaveData } from '../utils/variableReader';\n\n/**\n * \n */\nexport class SplashScreen {\n  private element: HTMLElement | null = null;\n  private callbacks: ComponentCallbacks;\n\n  constructor(callbacks: ComponentCallbacks) {\n    this.callbacks = callbacks;\n  }\n\n  public createElement(): HTMLElement {\n    const div = document.createElement('div');\n    div.className = 'screen splash-screen';\n    div.id = 'splash-screen';\n    div.innerHTML = this.getHTML();\n    this.element = div;\n    this.bindEvents();\n    this.updateContinueButton();\n    return div;\n  }\n\n  public show(): void {\n    if (this.element) {\n      this.element.classList.add('active');\n      this.updateContinueButton();\n    }\n  }\n\n  public hide(): void {\n    if (this.element) {\n      this.element.classList.remove('active');\n    }\n  }\n\n  public destroy(): void {\n    if (this.element) {\n      $(this.element).off();\n      $(this.element).remove();\n      this.element = null;\n    }\n\n    // \n    if (this.keyDownHandler) {\n      document.removeEventListener('keydown', this.keyDownHandler);\n      this.keyDownHandler = null;\n    }\n  }\n\n  private updateContinueButton(): void {\n    if (!this.element) return;\n\n    const continueButton = this.element.querySelector('#continue-button') as HTMLElement;\n    if (continueButton) {\n      if (hasSaveData()) {\n        continueButton.style.display = 'flex';\n      } else {\n        continueButton.style.display = 'none';\n      }\n    }\n  }\n\n  private keyDownHandler: ((e: KeyboardEvent) => void) | null = null;\n\n  private bindEvents(): void {\n    if (!this.element) return;\n\n    const newGameButton = this.element.querySelector('#new-game-button');\n    if (newGameButton) {\n      newGameButton.addEventListener('click', () => {\n        this.callbacks.onNewGame?.();\n      });\n    }\n\n    const continueButton = this.element.querySelector('#continue-button');\n    if (continueButton) {\n      continueButton.addEventListener('click', () => {\n        this.callbacks.onContinue?.();\n      });\n    }\n\n    const fullscreenButton = this.element.querySelector('#fullscreen-button');\n    if (fullscreenButton) {\n      fullscreenButton.addEventListener('click', () => {\n        this.requestFullscreen();\n      });\n    }\n\n    // Enter\n    this.keyDownHandler = (e: KeyboardEvent) => {\n      if (e.key === 'Enter' && this.element?.classList.contains('active')) {\n        e.preventDefault();\n        this.requestFullscreen();\n      }\n    };\n    document.addEventListener('keydown', this.keyDownHandler);\n  }\n\n  private requestFullscreen(): void {\n    const element = document.documentElement;\n    if (element.requestFullscreen) {\n      element.requestFullscreen().catch(err => {\n        console.warn(':', err);\n      });\n    } else if ((element as any).webkitRequestFullscreen) {\n      (element as any).webkitRequestFullscreen();\n    } else if ((element as any).mozRequestFullScreen) {\n      (element as any).mozRequestFullScreen();\n    } else if ((element as any).msRequestFullscreen) {\n      (element as any).msRequestFullscreen();\n    }\n  }\n\n  private getHTML(): string {\n    return `\n      <div class=\"splash-screen-content\">\n        <div class=\"splash-header\">\n          <div class=\"splash-logo\">\n            <i class=\"fas fa-anchor\"></i>\n          </div>\n          <h1 class=\"splash-title\"></h1>\n          <p class=\"splash-subtitle\">ANCHOR</p>\n        </div>\n        <div class=\"splash-actions\">\n          <button type=\"button\" class=\"splash-button primary\" id=\"new-game-button\">\n            <i class=\"fas fa-play\"></i>\n            <span></span>\n          </button>\n          <button type=\"button\" class=\"splash-button secondary\" id=\"continue-button\" style=\"display: none;\">\n            <i class=\"fas fa-redo\"></i>\n            <span></span>\n          </button>\n          <button type=\"button\" class=\"splash-button icon-only\" id=\"fullscreen-button\" title=\" (Enter)\">\n            <i class=\"fas fa-expand\"></i>\n          </button>\n        </div>\n        <div class=\"splash-footer\">\n          <p class=\"splash-copyright\"> 2026 </p>\n          <p class=\"splash-author\">Silly Tavern</p>\n          <p class=\"splash-hint\" style=\"margin-top: 0.5rem; font-size: 0.7rem; color: var(--text-tertiary);\"> Enter </p>\n        </div>\n      </div>\n    `;\n  }\n}\n","import { ComponentCallbacks, GameConfig } from '../types/types';\nimport _ from 'lodash';\n\n// \ndeclare function waitGlobalInitialized(name: string): Promise<void>;\ndeclare const toastr: any;\ndeclare const Mvu: {\n  getMvuData: (options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' }) => {\n    stat_data: Record<string, any>;\n    display_data: Record<string, any>;\n    delta_data: Record<string, any>;\n  };\n  replaceMvuData: (mvu_data: any, options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' }) => Promise<void>;\n};\n\n/**\n * \n */\nexport class NewGameSetup {\n  private element: HTMLElement | null = null;\n  private callbacks: ComponentCallbacks;\n\n  constructor(callbacks: ComponentCallbacks) {\n    this.callbacks = callbacks;\n  }\n\n  public createElement(): HTMLElement {\n    const div = document.createElement('div');\n    div.className = 'screen setup-screen';\n    div.id = 'setup-screen';\n    div.innerHTML = this.getHTML();\n    this.element = div;\n    this.bindEvents();\n    return div;\n  }\n\n  public show(): void {\n    if (this.element) {\n      this.element.classList.add('active');\n    }\n  }\n\n  public hide(): void {\n    if (this.element) {\n      this.element.classList.remove('active');\n    }\n  }\n\n  public destroy(): void {\n    if (this.element) {\n      $(this.element).off();\n      $(this.element).remove();\n      this.element = null;\n    }\n  }\n\n  private bindEvents(): void {\n    if (!this.element) return;\n\n    //  MVU \n    const reserveInput = this.element.querySelector('#energy-reserve') as HTMLInputElement;\n\n    if (reserveInput) {\n      reserveInput.addEventListener('input', async () => {\n        const config = this.getConfig();\n        if (config.reserve !== undefined) {\n          await this.updateMvuVariable(config.reserve);\n        }\n      });\n    }\n\n    const confirmButton = this.element.querySelector('#setup-confirm-button');\n    if (confirmButton) {\n      confirmButton.addEventListener('click', () => {\n        const reserveInput = this.element?.querySelector('#energy-reserve') as HTMLInputElement;\n        const inputValue = reserveInput?.value?.trim() || '';\n\n        // \n        if (!inputValue) {\n          toastr.error('', '');\n          return;\n        }\n\n        // \n        if (inputValue.includes('.')) {\n          toastr.error('', '');\n          return;\n        }\n\n        const reserve = parseInt(inputValue, 10);\n        if (isNaN(reserve)) {\n          toastr.error('', '');\n          return;\n        }\n\n        if (!Number.isInteger(reserve)) {\n          toastr.error('', '');\n          return;\n        }\n\n        if (reserve < 0 || reserve > 100000) {\n          toastr.error(' 0-100000 ', '');\n          return;\n        }\n\n        const config: GameConfig = { reserve };\n        this.callbacks.onConfirm?.(config);\n      });\n    }\n\n    const cancelButton = this.element.querySelector('#setup-cancel-button');\n    if (cancelButton) {\n      cancelButton.addEventListener('click', () => {\n        this.callbacks.onCancel?.();\n      });\n    }\n  }\n\n  private async updateMvuVariable(value: number): Promise<void> {\n    try {\n      //  MVU \n      if (typeof waitGlobalInitialized !== 'undefined') {\n        await waitGlobalInitialized('Mvu');\n      }\n\n      if (typeof Mvu === 'undefined' || !Mvu.getMvuData || !Mvu.replaceMvuData) {\n        console.warn(' MVU ');\n        return;\n      }\n\n      //  MVU \n      //  init(0) / latest message / chatchat  reserve  system_state \n      let initData: any = null;\n      let latestData: any = null;\n      let chatData: any = null;\n      try {\n        initData = Mvu.getMvuData({ type: 'message', message_id: 0 });\n      } catch {\n        // ignore\n      }\n      try {\n        latestData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n      } catch {\n        // ignore\n      }\n      chatData = Mvu.getMvuData({ type: 'chat' });\n\n      const currentMvuData = _.merge({}, initData ?? {}, latestData ?? {}, chatData ?? {});\n      const currentStatData = currentMvuData?.stat_data || {};\n\n      //  stat_data\n      const updatedStatData = { ...currentStatData };\n\n      if (!updatedStatData.system_state) {\n        updatedStatData.system_state = {};\n      }\n      if (!updatedStatData.system_state.antimatter) {\n        updatedStatData.system_state.antimatter = {};\n      }\n      //  reserve  0-100000 \n      updatedStatData.system_state.antimatter.reserve = Math.max(0, Math.min(100000, value));\n\n      //  MVU\n      const updatedMvuData = {\n        ...currentMvuData,\n        stat_data: updatedStatData,\n      };\n\n      await Mvu.replaceMvuData(updatedMvuData, { type: 'chat' });\n      console.info(`  MVU  reserve: ${value}`);\n    } catch (error) {\n      console.warn(`  MVU  reserve :`, error);\n    }\n  }\n\n  private getConfig(): GameConfig {\n    if (!this.element) {\n      return {};\n    }\n\n    const reserveInput = this.element.querySelector('#energy-reserve') as HTMLInputElement;\n\n    return {\n      reserve: reserveInput?.value ? parseInt(reserveInput.value, 10) : undefined,\n    };\n  }\n\n  private getHTML(): string {\n    return `\n      <div class=\"setup-screen-content\">\n        <div class=\"setup-header\">\n          <h1 class=\"setup-title\"></h1>\n          <p class=\"setup-subtitle\"></p>\n        </div>\n        <div class=\"setup-form\">\n          <div class=\"setup-form-group\">\n            <label class=\"setup-label\" for=\"energy-reserve\"></label>\n            <input\n              type=\"number\"\n              id=\"energy-reserve\"\n              class=\"setup-input\"\n              min=\"0\"\n              max=\"100000\"\n              step=\"1\"\n              placeholder=\"\"\n              required\n            />\n            <small style=\"color: var(--text-secondary); font-size: 0.7rem; margin-top: 0.25rem;\">\n              0 - 100000\n            </small>\n          </div>\n        </div>\n        <div class=\"setup-actions\">\n          <button type=\"button\" class=\"setup-button secondary\" id=\"setup-cancel-button\">\n            <i class=\"fas fa-times\"></i>\n            <span></span>\n          </button>\n          <button type=\"button\" class=\"setup-button primary\" id=\"setup-confirm-button\">\n            <i class=\"fas fa-check\"></i>\n            <span></span>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = showdown;","const __WEBPACK_NAMESPACE_OBJECT__ = YAML;","import { waitUntil } from 'async-wait-until';\nimport showdown from \"showdown\";\nimport _ from 'lodash';\nimport { parse, stringify } from 'yaml';\nimport { ComponentCallbacks, GameData, NetItem } from '../types/types';\n\n// \ndeclare function getWorldbook(worldbook_name: string): Promise<WorldbookEntry[]>;\ndeclare function replaceWorldbook(worldbook_name: string, entries: any[]): Promise<void>;\ndeclare function updateWorldbookWith(\n  worldbook_name: string,\n  updater: (worldbook: WorldbookEntry[]) => any[] | Promise<any[]>,\n): Promise<WorldbookEntry[]>;\ndeclare function deleteWorldbookEntries(\n  worldbook_name: string,\n  predicate: (entry: WorldbookEntry) => boolean,\n): Promise<{ worldbook: WorldbookEntry[]; deleted_entries: WorldbookEntry[] }>;\ndeclare function getVariables(option: { type: 'message'; message_id: number | 'latest' }): Record<string, any>;\ndeclare function eventOn(event: string, callback: (...args: any[]) => void): { stop: () => void };\ndeclare const tavern_events: {\n  MESSAGE_RECEIVED?: string;\n  CHAT_CHANGED?: string;\n  MESSAGE_UPDATED?: string;\n};\n\ndeclare function getChatMessages(\n  range: string | number,\n  options?: { role?: 'all' | 'system' | 'assistant' | 'user' },\n): Array<{ message: string; message_id: number; role: string; data?: Record<string, any> }>;\n\ndeclare function waitGlobalInitialized(name: string): Promise<void>;\ndeclare const Mvu: {\n  events: {\n    VARIABLE_UPDATE_ENDED: 'mag_variable_update_ended';\n  };\n  getMvuData: (options: { type: 'message' | 'chat' | 'character' | 'global'; message_id?: number | 'latest' }) => {\n    stat_data: Record<string, any>;\n    display_data: Record<string, any>;\n    delta_data: Record<string, any>;\n  };\n};\n\ntype WorldbookEntry = {\n  uid: number;\n  name: string;\n  enabled: boolean;\n  content: string;\n};\n\ninterface NetCategory {\n  id: string; //  <module>,  'Manual'\n  label: string; //  <alias>,  ''\n  items: NetItem[];\n}\n\n/**\n * Dashboard\n */\nexport class Dashboard {\n  private element: HTMLElement | null = null;\n  private callbacks: ComponentCallbacks;\n  private gameData: Partial<GameData> = {};\n  private keyDownHandler: ((e: KeyboardEvent) => void) | null = null;\n  private mvuUpdateListener: { stop: () => void } | null = null;\n  private statusRetryCount = 0;\n  private statusRetryTimer: number | null = null;\n  private markdownConverter: showdown.Converter;\n\n  // \n  private netCategories: NetCategory[] = [];\n  private netReport: string = '';\n  private expandedSections: Set<string> = new Set();\n  private selectedItem: { categoryId: string; index: number } | null = null;\n\n  constructor(callbacks: ComponentCallbacks) {\n    this.callbacks = callbacks;\n    this.markdownConverter = new showdown.Converter({ tables: true, strikethrough: true, tasklists: true, simpleLineBreaks: true, ghCodeBlocks: true, openLinksInNewWindow: true });\n  }\n\n  public createElement(): HTMLElement {\n    try {\n      const div = document.createElement('div');\n      div.className = 'screen main-screen';\n      div.id = 'main-screen';\n      div.innerHTML = this.getHTML();\n      this.element = div;\n\n      //  innerHTML \n      this.bindEvents();\n\n      // \n      this.refreshData();\n\n      console.log(' Dashboard ');\n      return div;\n    } catch (error) {\n      console.error('  Dashboard :', error);\n      //  div \n      const fallbackDiv = document.createElement('div');\n      fallbackDiv.className = 'screen main-screen';\n      fallbackDiv.id = 'main-screen';\n      fallbackDiv.innerHTML = '<div style=\"padding: 2rem; color: var(--text-primary);\">...</div>';\n      this.element = fallbackDiv;\n      return fallbackDiv;\n    }\n  }\n\n  public show(): void {\n    if (this.element) {\n      this.element.classList.add('active');\n      // \n      try {\n        this.refreshData();\n        console.log(' Dashboard ');\n      } catch (error) {\n        console.error(' Dashboard :', error);\n        // \n      }\n    } else {\n      console.error(' Dashboard element  null');\n    }\n  }\n\n  public hide(): void {\n    if (this.element) {\n      this.element.classList.remove('active');\n    }\n  }\n\n  public destroy(): void {\n    if (this.element) {\n      $(this.element).off();\n      $(this.element).remove();\n      this.element = null;\n    }\n\n    // \n    if (this.keyDownHandler) {\n      document.removeEventListener('keydown', this.keyDownHandler);\n      this.keyDownHandler = null;\n    }\n\n    if (this.mvuUpdateListener) {\n      this.mvuUpdateListener.stop();\n      this.mvuUpdateListener = null;\n    }\n\n    if (this.statusRetryTimer !== null) {\n      window.clearTimeout(this.statusRetryTimer);\n      this.statusRetryTimer = null;\n    }\n  }\n\n  public updateGameData(data: Partial<GameData>): void {\n    this.gameData = { ...this.gameData, ...data };\n    this.refreshData();\n  }\n\n  private refreshData(): void {\n    if (!this.element) {\n      console.warn(' Dashboard element  null');\n      return;\n    }\n\n    try {\n      //  MVU \n      this.updateStatusCards().catch(error => {\n        console.warn(' :', error);\n      });\n\n      // \n      this.updateTasksList();\n\n      // \n      this.updateNetContent();\n\n      //  maintext\n      setTimeout(() => {\n        try {\n          this.loadMaintextFromChat();\n        } catch (error) {\n          console.warn('  maintext :', error);\n        }\n      }, 100);\n\n      // \n      this.loadNetFromWorldbook().catch(err => console.error(' :', err));\n\n      console.info(' ');\n    } catch (error) {\n      console.error(' :', error);\n      // \n    }\n  }\n\n  private async updateStatusCards(): Promise<void> {\n    if (!this.element) return;\n\n    const statusGrid = this.element.querySelector('#status-grid');\n    if (!statusGrid) return;\n\n    try {\n      //  MVU  system_state \n      //  MVU  stat_data  ->  -> \n      await waitGlobalInitialized('Mvu');\n      await waitUntil(() => _.has(getVariables({ type: 'message' }), 'stat_data'), {\n        timeout: 3000,\n        intervalBetweenAttempts: 100,\n      }).catch(() => {\n        // timeout \n      });\n\n      //  chat \n      const chatData = Mvu.getMvuData({ type: 'chat' });\n      const chatSystemState = _.get(chatData, 'stat_data.system_state');\n\n      // latest message + 0 initvar\n      let latestSystemState: any = null;\n      let initSystemState: any = null;\n      try {\n        const latest = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n        latestSystemState = _.get(latest, 'stat_data.system_state');\n      } catch (e) {\n        console.warn('  latest message  system_state :', e);\n      }\n      try {\n        const initMsg = Mvu.getMvuData({ type: 'message', message_id: 0 });\n        initSystemState = _.get(initMsg, 'stat_data.system_state');\n      } catch (e) {\n        // message 0 \n      }\n\n      // init -> latest -> chatchat \n      const systemState: any = _.merge({}, initSystemState || {}, latestSystemState || {}, chatSystemState || {});\n\n      const hasSystemStateData =\n        systemState &&\n        (systemState.cycle !== undefined ||\n          systemState.system_pressure !== undefined ||\n          systemState.instability !== undefined ||\n          !!systemState.population ||\n          !!systemState.antimatter);\n\n      // \n      if (!hasSystemStateData) {\n        statusGrid.innerHTML = '<div class=\"status-empty\"></div>';\n\n        if (this.statusRetryCount < 10) {\n          this.statusRetryCount += 1;\n          if (this.statusRetryTimer !== null) window.clearTimeout(this.statusRetryTimer);\n          this.statusRetryTimer = window.setTimeout(() => {\n            this.updateStatusCards().catch(() => {});\n          }, 250);\n        }\n        return;\n      }\n\n      // \n      this.statusRetryCount = 0;\n      if (this.statusRetryTimer !== null) {\n        window.clearTimeout(this.statusRetryTimer);\n        this.statusRetryTimer = null;\n      }\n\n      //  initvar \n      const cards: string[] = [];\n\n      // Cycle ()\n      if (systemState.cycle !== undefined) {\n        cards.push(`\n          <div class=\"status-card\">\n            <div class=\"status-card-header\">\n              <i class=\"fas fa-clock status-card-icon\"></i>\n              <span class=\"status-card-title\"></span>\n            </div>\n            <div class=\"status-card-content\">\n              <div class=\"status-value\">\n                <span class=\"value-number\">${systemState.cycle}</span>\n              </div>\n            </div>\n          </div>\n        `);\n      }\n\n      // Antimatter ()\n      if (systemState.antimatter) {\n        const reserve = systemState.antimatter.reserve ?? 0;\n        const leakRisk = systemState.antimatter.leak_risk ?? 0;\n        const reservePercent = Math.round((reserve / 100000) * 100);\n        const riskLevel = leakRisk < 0.3 ? 'low' : leakRisk < 0.7 ? 'medium' : 'high';\n\n        cards.push(`\n          <div class=\"status-card\">\n            <div class=\"status-card-header\">\n              <i class=\"fas fa-atom status-card-icon\"></i>\n              <span class=\"status-card-title\"></span>\n            </div>\n            <div class=\"status-card-content\">\n              <div class=\"status-value\">\n                <span class=\"value-number\">${reserve.toLocaleString()}</span>\n                <div class=\"status-bar\">\n                  <div class=\"status-bar-fill\" style=\"width: ${reservePercent}%\"></div>\n                </div>\n                <div class=\"status-detail\" style=\"font-size: 0.65rem; margin-top: 0.3rem; color: var(--text-tertiary);\">\n                  : <span class=\"risk-${riskLevel}\">${(leakRisk * 100).toFixed(1)}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        `);\n      }\n\n      // Population ()\n      if (systemState.population) {\n        const pop = systemState.population;\n        const active = pop.active ?? 0;\n        const standby = pop.standby ?? 0;\n        const archived = pop.archived ?? 0;\n        const total = active + standby + archived;\n\n        cards.push(`\n          <div class=\"status-card\">\n            <div class=\"status-card-header\">\n              <i class=\"fas fa-users status-card-icon\"></i>\n              <span class=\"status-card-title\"></span>\n            </div>\n            <div class=\"status-card-content\">\n              <div class=\"status-value\">\n                <span class=\"value-number\">${total}</span>\n                <div class=\"status-detail\" style=\"font-size: 0.65rem; margin-top: 0.3rem; color: var(--text-tertiary);\">\n                  : ${active} | : ${standby} | : ${archived}\n                </div>\n              </div>\n            </div>\n          </div>\n        `);\n      }\n\n      // System Pressure ()\n      if (systemState.system_pressure !== undefined) {\n        const pressure = systemState.system_pressure ?? 0;\n        const pressurePercent = Math.round(pressure * 100);\n        const pressureLevel = pressure < 0.5 ? 'low' : pressure < 0.8 ? 'medium' : 'high';\n\n        cards.push(`\n          <div class=\"status-card\">\n            <div class=\"status-card-header\">\n              <i class=\"fas fa-tachometer-alt status-card-icon\"></i>\n              <span class=\"status-card-title\"></span>\n            </div>\n            <div class=\"status-card-content\">\n              <div class=\"status-value\">\n                <span class=\"value-number\">${pressurePercent}%</span>\n                <div class=\"status-bar\">\n                  <div class=\"status-bar-fill status-${pressureLevel}\" style=\"width: ${pressurePercent}%\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        `);\n      }\n\n      // Instability ()\n      if (systemState.instability !== undefined) {\n        const instability = systemState.instability ?? 0;\n        const instabilityPercent = Math.round(instability * 100);\n        const instabilityLevel = instability < 0.3 ? 'low' : instability < 0.7 ? 'medium' : 'high';\n\n        cards.push(`\n          <div class=\"status-card\">\n            <div class=\"status-card-header\">\n              <i class=\"fas fa-exclamation-triangle status-card-icon\"></i>\n              <span class=\"status-card-title\"></span>\n            </div>\n            <div class=\"status-card-content\">\n              <div class=\"status-value\">\n                <span class=\"value-number\">${instabilityPercent}%</span>\n                <div class=\"status-bar\">\n                  <div class=\"status-bar-fill status-${instabilityLevel}\" style=\"width: ${instabilityPercent}%\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        `);\n      }\n\n      if (cards.length > 0) {\n        statusGrid.innerHTML = cards.join('');\n      } else {\n        statusGrid.innerHTML = '<div class=\"status-empty\"></div>';\n      }\n    } catch (error) {\n      console.error(' :', error);\n      statusGrid.innerHTML = '<div class=\"status-empty\"></div>';\n    }\n  }\n\n  private updateTasksList(): void {\n    if (!this.element) return;\n\n    const tasksList = this.element.querySelector('#tasks-list');\n    if (!tasksList) return;\n\n    // gameData.tasks\n    const tasks =\n      this.gameData.tasks && Array.isArray(this.gameData.tasks) && this.gameData.tasks.length > 0\n        ? this.gameData.tasks\n        : this.getDefaultTasks();\n\n    tasksList.innerHTML = tasks\n      .map(\n        task => `\n      <div class=\"entry-item\">\n        <div class=\"entry-icon\">\n          <i class=\"fas ${this.getTaskIcon(task.status)}\"></i>\n        </div>\n        <div class=\"entry-content\">\n          <div class=\"entry-header\">\n            <span class=\"entry-title\">${this.escapeHtml(task.title)}</span>\n            <span class=\"entry-status ${task.status}\">${this.getStatusText(task.status)}</span>\n          </div>\n          <div class=\"entry-meta\">\n            <span class=\"entry-time\">${task.time}</span>\n            <span class=\"entry-priority priority-${task.priority}\">${this.getPriorityText(task.priority)}</span>\n          </div>\n          <div class=\"entry-description\">${this.escapeHtml(task.description)}</div>\n        </div>\n      </div>\n    `,\n      )\n      .join('');\n  }\n\n  private updateNetContent(): void {\n    if (!this.element) return;\n\n    const netContainer = this.element.querySelector('#module-net .net-body');\n    if (!netContainer) return;\n\n    // \n    const sidebarHtml = this.netCategories.map(cat => this.renderSidebarSection(cat.id, cat.label, cat.items)).join('');\n\n    // \n    const reportSidebarHtml = this.renderSidebarSection('report', '', [{ title: '' }]);\n\n    //  HTML\n    netContainer.innerHTML = `\n      <div class=\"net-explorer\">\n        <div class=\"net-sidebar\">\n          ${sidebarHtml}\n          ${reportSidebarHtml}\n        </div>\n        <div class=\"net-viewer\" id=\"net-viewer\">\n          ${this.renderNetViewer()}\n        </div>\n      </div>\n    `;\n\n    // \n    this.bindNetSidebarEvents();\n\n    // \n    if (this.selectedItem?.categoryId === 'report') {\n      const editor = this.element.querySelector('#net-report-editor') as HTMLTextAreaElement;\n      if (editor) {\n        $(editor).on(\n          'input',\n          _.debounce((e: any) => {\n            this.netReport = e.target.value;\n            this.saveReportToVariables(this.netReport);\n          }, 1000),\n        );\n      }\n    }\n\n    // \n    if (this.selectedItem?.categoryId === 'log') {\n      const saveBtn = this.element.querySelector('#net-history-save-btn');\n      const deleteBtn = this.element.querySelector('#net-history-delete-btn');\n      const titleInput = this.element.querySelector('#net-history-title-input') as HTMLInputElement;\n      const authorInput = this.element.querySelector('#net-history-author-input') as HTMLInputElement;\n      const contentEditor = this.element.querySelector('#net-history-content-editor') as HTMLTextAreaElement;\n\n      if (saveBtn && titleInput && authorInput && contentEditor) {\n        $(saveBtn).on('click', async () => {\n          const newTitle = titleInput.value.trim();\n          const newAuthor = authorInput.value.trim();\n          const newContent = contentEditor.value;\n          const { index } = this.selectedItem!;\n\n          if (!newTitle) {\n            alert('');\n            return;\n          }\n\n          $(saveBtn).prop('disabled', true).addClass('saving');\n\n          try {\n            await this.saveHistoryItem(index, newTitle, newAuthor, newContent);\n            // \n            const category = this.netCategories.find(c => c.id === 'log');\n            if (category) {\n              category.items[index].title = newTitle;\n              category.items[index].author = newAuthor;\n              category.items[index].content = newContent;\n            }\n            this.updateNetContent();\n            if (typeof toastr !== 'undefined') toastr.success('');\n          } catch (error) {\n            console.error(' :', error);\n            alert('');\n            $(saveBtn).prop('disabled', false).removeClass('saving');\n          }\n        });\n      }\n\n      if (deleteBtn) {\n        $(deleteBtn).on('click', async () => {\n          const { index } = this.selectedItem!;\n          const category = this.netCategories.find(c => c.id === 'log');\n          if (!category) return;\n          const item = category.items[index];\n\n          if (!confirm(`${item.title}`)) {\n            return;\n          }\n\n          $(deleteBtn).prop('disabled', true).addClass('deleting');\n\n          try {\n            await this.deleteHistoryItem(index);\n            // \n            category.items.splice(index, 1);\n            if (category.items.length === 0) {\n              this.netCategories = this.netCategories.filter(c => c.id !== 'log');\n            }\n            this.selectedItem = null;\n            this.updateNetContent();\n            if (typeof toastr !== 'undefined') toastr.success('');\n          } catch (error) {\n            console.error(' :', error);\n            alert('');\n            $(deleteBtn).prop('disabled', false).removeClass('deleting');\n          }\n        });\n      }\n    }\n  }\n\n  private async deleteHistoryItem(index: number): Promise<void> {\n    const WORLDBOOK_NAME = 'anchor';\n    const category = this.netCategories.find(c => c.id === 'log');\n    if (!category) return;\n\n    const item = category.items[index];\n    const entryName = `net-log-${item.title}`;\n\n    try {\n      await deleteWorldbookEntries(WORLDBOOK_NAME, e => e.name === entryName);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private async saveHistoryItem(index: number, title: string, author: string, content: string): Promise<void> {\n    const WORLDBOOK_NAME = 'anchor';\n    const category = this.netCategories.find(c => c.id === 'log');\n    if (!category) return;\n\n    const item = category.items[index];\n    const oldEntryName = `net-log-${item.title}`;\n\n    try {\n      //  updateWorldbookWith \n      await updateWorldbookWith(WORLDBOOK_NAME, worldbook => {\n        const entryIndex = worldbook.findIndex(e => e.name === oldEntryName);\n\n        if (entryIndex === -1) {\n          throw new Error(`: ${oldEntryName}`);\n        }\n\n        const updatedContent = [\n          {\n            title: title,\n            author: author,\n            content: content,\n          },\n        ];\n\n        // \n        worldbook[entryIndex] = {\n          ...worldbook[entryIndex],\n          name: `net-log-${title}`,\n          content: stringify(updatedContent, { lineWidth: 0 }),\n        };\n\n        return worldbook;\n      });\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private renderSidebarSection(id: string, label: string, items: any[]): string {\n    const isExpanded = this.expandedSections.has(id);\n    const icon = isExpanded ? 'fa-chevron-down' : 'fa-chevron-right';\n\n    let itemsHtml = '';\n    if (isExpanded) {\n      itemsHtml = `\n        <div class=\"net-sidebar-items\">\n          ${items\n            .map((item, index) => {\n              const isSelected = this.selectedItem?.categoryId === id && this.selectedItem?.index === index;\n              return `\n              <div class=\"net-sidebar-item ${isSelected ? 'active' : ''}\" data-net-section=\"${id}\" data-net-index=\"${index}\">\n                <i class=\"far fa-file-alt\"></i>\n                <span class=\"net-sidebar-item-title\">${this.escapeHtml(item.title)}</span>\n              </div>\n            `;\n            })\n            .join('')}\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"net-sidebar-section\" data-section-id=\"${id}\">\n        <div class=\"net-sidebar-header\">\n          <i class=\"fas ${icon}\"></i>\n          <span>${label}</span>\n        </div>\n        ${itemsHtml}\n      </div>\n    `;\n  }\n\n  private renderMarkdown(text: string): string {\n    return this.markdownConverter.makeHtml(text);\n  }\n\n  private renderNetViewer(): string {\n    if (!this.selectedItem) {\n      return '<div class=\"net-viewer-empty\"></div>';\n    }\n\n    const { categoryId, index } = this.selectedItem;\n\n    if (categoryId === 'report') {\n      return `\n        <div class=\"net-report-container\">\n          <div class=\"net-viewer-header\">\n            <span class=\"net-viewer-title\"></span>\n          </div>\n          <textarea id=\"net-report-editor\" class=\"net-report-editor\" placeholder=\"...\">${this.netReport || ''}</textarea>\n        </div>\n      `;\n    }\n\n    const category = this.netCategories.find(c => c.id === categoryId);\n    const item = category?.items[index];\n\n    if (!item) {\n      return '<div class=\"net-viewer-empty\"></div>';\n    }\n\n    // \n    if (categoryId === 'log') {\n      return `\n        <div class=\"net-item-viewer net-history-editor\">\n          <div class=\"net-viewer-header\">\n            <input type=\"text\" id=\"net-history-title-input\" class=\"net-history-title-input\" value=\"${this.escapeHtml(item.title)}\" placeholder=\"\">\n            <div class=\"net-viewer-meta\">\n              : <input type=\"text\" id=\"net-history-author-input\" class=\"net-history-author-input\" value=\"${this.escapeHtml(item.author)}\" placeholder=\"\">\n            </div>\n          </div>\n          <textarea id=\"net-history-content-editor\" class=\"net-history-content-editor\" placeholder=\"...\">${item.content}</textarea>\n          <div class=\"net-floating-actions\">\n            <button id=\"net-history-delete-btn\" class=\"net-floating-delete-btn\" title=\"\">\n              <i class=\"fas fa-trash-alt\"></i>\n            </button>\n            <button id=\"net-history-save-btn\" class=\"net-floating-save-btn\" title=\"\">\n              <i class=\"fas fa-save\"></i>\n            </button>\n          </div>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"net-item-viewer\">\n        <div class=\"net-viewer-header\">\n          <h2 class=\"net-viewer-title\">${this.escapeHtml(item.title)}</h2>\n          <div class=\"net-viewer-meta\">: ${this.escapeHtml(item.author)}</div>\n        </div>\n        <div class=\"net-viewer-content\">${this.renderMarkdown(item.content)}</div>\n      </div>\n    `;\n  }\n\n  private bindNetSidebarEvents(): void {\n    if (!this.element) return;\n\n    // /\n    $(this.element).off('click', '.net-sidebar-header');\n    $(this.element).on('click', '.net-sidebar-header', e => {\n      const sectionId = $(e.currentTarget).closest('.net-sidebar-section').attr('data-section-id');\n      if (sectionId) {\n        if (this.expandedSections.has(sectionId)) {\n          this.expandedSections.delete(sectionId);\n        } else {\n          this.expandedSections.add(sectionId);\n        }\n        this.updateNetContent();\n      }\n    });\n\n    // \n    $(this.element).off('click', '.net-sidebar-item');\n    $(this.element).on('click', '.net-sidebar-item', e => {\n      const categoryId = $(e.currentTarget).attr('data-net-section') as string;\n      const index = parseInt($(e.currentTarget).attr('data-net-index') || '0', 10);\n      this.selectedItem = { categoryId, index };\n      this.updateNetContent();\n    });\n  }\n\n  private async loadNetFromWorldbook(): Promise<void> {\n    const WORLDBOOK_NAME = 'anchor';\n    // : net-<module>-<alias>\n    const NET_ENTRY_REGEX = /^net-([^-]+)-(.+)$/;\n\n    try {\n      const worldbook = await getWorldbook(WORLDBOOK_NAME);\n      const categoriesMap = new Map<string, NetCategory>();\n\n      worldbook.forEach(entry => {\n        const match = entry.name.match(NET_ENTRY_REGEX);\n        if (match && entry.content) {\n          const moduleId = match[1];\n          const alias = match[2];\n\n          try {\n            const items = parse(entry.content) || [];\n            const itemsArray = Array.isArray(items) ? items : [items];\n\n            if (categoriesMap.has(moduleId)) {\n              // \n              const category = categoriesMap.get(moduleId)!;\n              category.items.push(...itemsArray);\n            } else {\n              categoriesMap.set(moduleId, {\n                id: moduleId,\n                label: moduleId === 'log' ? '' : alias, //  log \n                items: itemsArray,\n              });\n            }\n          } catch (e) {\n            console.error(`  [${entry.name}] YAML :`, e);\n          }\n        }\n      });\n\n      this.netCategories = Array.from(categoriesMap.values());\n\n      // \n      if (this.netCategories.length > 0 && !this.selectedItem) {\n        const firstCatId = this.netCategories[0].id;\n        this.expandedSections.add(firstCatId);\n        this.selectedItem = { categoryId: firstCatId, index: 0 };\n      }\n\n      // \n      try {\n        const gameVariables = getVariables({ type: 'message', message_id: 'latest' });\n        this.netReport = gameVariables.stat_data?.player_report || '';\n      } catch (e) {\n        console.warn(' :', e);\n      }\n\n      this.updateNetContent();\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  private async saveReportToVariables(content: string): Promise<void> {\n    try {\n      //  variableUpdater\n      const { updateStatDataVariable } = await import('../utils/variableUpdater');\n      await updateStatDataVariable('player_report', content);\n      console.info(' ');\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  private updateChatMessages(): void {\n    //  dashboardLogic.ts  initChatInterface \n    // \n    //  getChatMessages \n  }\n\n  private getDefaultTasks() {\n    return [\n      {\n        id: '1',\n        title: '',\n        status: 'completed' as const,\n        priority: 'high' as const,\n        time: '01-15 14:30',\n        description: '',\n      },\n    ];\n  }\n\n  private getDefaultMessages() {\n    return [\n      { id: '1', role: 'user' as const, content: '', time: '14:32' },\n      {\n        id: '2',\n        role: 'assistant' as const,\n        content:\n          '87%92%78%',\n        time: '14:32',\n      },\n      { id: '3', role: 'user' as const, content: '', time: '14:33' },\n      {\n        id: '4',\n        role: 'assistant' as const,\n        content:\n          '87%30',\n        time: '14:33',\n      },\n    ];\n  }\n\n  private getTaskIcon(status: string): string {\n    switch (status) {\n      case 'completed':\n        return 'fa-check-circle';\n      case 'in-progress':\n        return 'fa-clock';\n      case 'pending':\n        return 'fa-exclamation-circle';\n      default:\n        return 'fa-circle';\n    }\n  }\n\n  private getStatusText(status: string): string {\n    switch (status) {\n      case 'completed':\n        return '';\n      case 'in-progress':\n        return '';\n      case 'pending':\n        return '';\n      default:\n        return status;\n    }\n  }\n\n  private getPriorityText(priority: string): string {\n    switch (priority) {\n      case 'urgent':\n        return '';\n      case 'high':\n        return '';\n      case 'medium':\n        return '';\n      case 'low':\n        return '';\n      default:\n        return priority;\n    }\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  /**\n   *  maintext \n   */\n  private parseMaintext(messageContent: string): string {\n    const maintextMatch = messageContent.match(/<maintext>([\\s\\S]*?)<\\/maintext>/i);\n    if (!maintextMatch) {\n      return '';\n    }\n    return maintextMatch[1].trim();\n  }\n\n  /**\n   *  maintext \n   */\n  public updateMaintextDisplay(messageContent: string): void {\n    if (!this.element) return;\n\n    //  textParser\n    import('../utils/textParser')\n      .then(({ extractContinueChoice, extractResult, extractNextChoice }) => {\n        const el = this.element;\n        if (!el) return;\n\n        // 1. \n        const continueChoice = extractContinueChoice(messageContent);\n        const result = extractResult(messageContent);\n        const nextChoice = extractNextChoice(messageContent);\n\n        // 2. \n        const continueChoiceArea = el.querySelector('#maintext-continue-choice') as HTMLElement;\n        const resultArea = el.querySelector('#maintext-result') as HTMLElement;\n        const nextChoiceArea = el.querySelector('#maintext-next-choice') as HTMLElement;\n\n        if (continueChoice || result || nextChoice) {\n          // \n          if (continueChoiceArea) continueChoiceArea.textContent = continueChoice || '';\n          if (resultArea) resultArea.textContent = result || '';\n          if (nextChoiceArea) nextChoiceArea.textContent = nextChoice || '';\n        } else {\n          //  maintext  next_choice \n          const maintext = this.parseMaintext(messageContent);\n          if (nextChoiceArea) {\n            nextChoiceArea.textContent = maintext || '';\n          }\n          // \n          if (continueChoiceArea) continueChoiceArea.textContent = '';\n          if (resultArea) resultArea.textContent = '';\n        }\n\n        console.info(`  maintext`);\n      })\n      .catch(error => {\n        console.error('  maintext :', error);\n      });\n  }\n\n  /**\n   *  maintext \n   * continue_choice, result, decision_node\n   */\n  public loadMaintextFromChat(): void {\n    if (!this.element) return;\n\n    try {\n      //  getChatMessages \n      if (typeof getChatMessages === 'undefined') {\n        console.warn(' getChatMessages ');\n        return;\n      }\n\n      // 1.  assistant \n      let messages: Array<{ message: string; message_id: number; role: string }> = [];\n      try {\n        messages = getChatMessages(-1, { role: 'assistant' });\n      } catch (error) {\n        console.warn('  assistant :', error);\n      }\n\n      let lastMessage = messages.length > 0 ? messages[messages.length - 1] : null;\n\n      // 2.  assistant  role\n      if (!lastMessage) {\n        try {\n          messages = getChatMessages(-1);\n          lastMessage = messages.length > 0 ? messages[messages.length - 1] : null;\n        } catch (error) {\n          console.warn(' :', error);\n        }\n      }\n\n      if (!lastMessage) {\n        return;\n      }\n\n      // 4. \n      const messageContent = lastMessage.message || '';\n\n      //  textParser\n      import('../utils/textParser')\n        .then(({ extractContinueChoice, extractResult, extractNextChoice }) => {\n          const el = this.element;\n          if (!el) return;\n\n          // 5. \n          const continueChoice = extractContinueChoice(messageContent);\n          const result = extractResult(messageContent);\n          const nextChoice = extractNextChoice(messageContent);\n\n          // 6. \n          const continueChoiceArea = el.querySelector('#maintext-continue-choice') as HTMLElement;\n          const resultArea = el.querySelector('#maintext-result') as HTMLElement;\n          const nextChoiceArea = el.querySelector('#maintext-next-choice') as HTMLElement;\n\n          if (continueChoice || result || nextChoice) {\n            // \n            if (continueChoiceArea) continueChoiceArea.textContent = continueChoice || '';\n            if (resultArea) resultArea.textContent = result || '';\n            if (nextChoiceArea) nextChoiceArea.textContent = nextChoice || '';\n          } else {\n            //  maintext  next_choice \n            const maintext = this.parseMaintext(messageContent);\n            if (nextChoiceArea && maintext) {\n              nextChoiceArea.textContent = maintext;\n            }\n            // \n            if (continueChoiceArea) continueChoiceArea.textContent = '';\n            if (resultArea) resultArea.textContent = '';\n          }\n\n          console.info(`  maintext (message_id: ${lastMessage.message_id})`);\n        })\n        .catch(error => {\n          console.error('  textParser :', error);\n          const el = this.element;\n          if (!el) return;\n          // \n          const maintext = this.parseMaintext(messageContent);\n          const nextChoiceArea = el.querySelector('#maintext-next-choice') as HTMLElement;\n          if (nextChoiceArea && maintext) {\n            nextChoiceArea.textContent = maintext;\n          }\n        });\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  /**\n   * \n   */\n  private setupMessageListener(): void {\n    try {\n      if (typeof eventOn === 'undefined' || typeof tavern_events === 'undefined') {\n        console.warn('  API ');\n        return;\n      }\n\n      const handleMessageReceived = () => {\n        // \n        setTimeout(() => {\n          try {\n            this.loadMaintextFromChat();\n            //  MVU \n            this.updateStatusCards().catch(() => {});\n          } catch (error) {\n            console.error(' :', error);\n          }\n        }, 150);\n      };\n\n      //  MESSAGE_RECEIVED  CHAT_CHANGED \n      if (tavern_events.MESSAGE_RECEIVED) {\n        eventOn(tavern_events.MESSAGE_RECEIVED, handleMessageReceived);\n      }\n      if (tavern_events.CHAT_CHANGED) {\n        eventOn(tavern_events.CHAT_CHANGED, handleMessageReceived);\n      }\n      if (tavern_events.MESSAGE_UPDATED) {\n        eventOn(tavern_events.MESSAGE_UPDATED, handleMessageReceived);\n      }\n\n      //  refresh-maintext\n      if (this.element) {\n        this.element.addEventListener('refresh-maintext', (e: any) => {\n          //  chat  and \n          const latestMessage = e.detail?.message;\n          if (latestMessage) {\n            this.updateMaintextDisplay(latestMessage);\n          } else {\n            // \n            setTimeout(() => {\n              this.loadMaintextFromChat();\n            }, 100);\n          }\n        });\n        this.element.addEventListener('refresh-status', () => {\n          setTimeout(() => {\n            this.updateStatusCards().catch(() => {});\n          }, 50);\n        });\n      }\n\n      console.info(' ');\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  private bindEvents(): void {\n    if (!this.element) {\n      console.warn(' Dashboard element  null');\n      return;\n    }\n\n    try {\n      // \n      const fullscreenButton = this.element.querySelector('#dashboard-fullscreen-button');\n      if (fullscreenButton) {\n        fullscreenButton.addEventListener('click', () => {\n          this.toggleFullscreen();\n        });\n      } else {\n        console.warn(' ');\n      }\n\n      // Enter \n      this.setupEnterKeyFullscreen();\n\n      //  app.ts \n\n      //  API \n      setTimeout(() => {\n        try {\n          if (typeof eventOn !== 'undefined' && typeof tavern_events !== 'undefined') {\n            this.setupMessageListener();\n          } else {\n            console.warn('  API ');\n          }\n        } catch (error) {\n          console.warn(' :', error);\n        }\n      }, 200);\n\n      //  MVU  -> \n      setTimeout(async () => {\n        try {\n          await waitGlobalInitialized('Mvu');\n          if (this.mvuUpdateListener) return;\n          if (typeof Mvu === 'undefined' || !Mvu.events?.VARIABLE_UPDATE_ENDED) return;\n\n          this.mvuUpdateListener = eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, () => {\n            if (this.statusRetryTimer !== null) window.clearTimeout(this.statusRetryTimer);\n            this.statusRetryTimer = window.setTimeout(() => {\n              this.updateStatusCards().catch(() => {});\n            }, 50);\n          });\n        } catch (e) {\n          console.warn(' MVU :', e);\n        }\n      }, 250);\n\n      // \n      this.element.addEventListener('refresh-net', () => {\n        console.log('  refresh-net ');\n        this.loadNetFromWorldbook();\n      });\n    } catch (error) {\n      console.error(' bindEvents :', error);\n      // \n    }\n  }\n\n  private getHTML(): string {\n    return `\n      <!--  -->\n      <header class=\"main-header\">\n        <div class=\"header-content\">\n          <div class=\"logo-section\">\n            <i class=\"fas fa-anchor logo-icon\"></i>\n            <h1 class=\"logo-text\"></h1>\n          </div>\n          <!--  -->\n          <nav class=\"top-nav-menu\">\n            <button type=\"button\" class=\"nav-item active\" data-module=\"status\" id=\"nav-status\" title=\" (1)\">\n              <span class=\"nav-shortcut\">1</span>\n              <i class=\"fas fa-chart-line nav-icon\"></i>\n              <span class=\"nav-text\"></span>\n            </button>\n            <button type=\"button\" class=\"nav-item\" data-module=\"tasks\" id=\"nav-tasks\" title=\" (2)\">\n              <span class=\"nav-shortcut\">2</span>\n              <i class=\"fas fa-tasks nav-icon\"></i>\n              <span class=\"nav-text\"></span>\n            </button>\n            <button type=\"button\" class=\"nav-item\" data-module=\"net\" id=\"nav-net\" title=\" (3)\">\n              <span class=\"nav-shortcut\">3</span>\n              <i class=\"fas fa-network-wired nav-icon\"></i>\n              <span class=\"nav-text\"></span>\n            </button>\n            <button type=\"button\" class=\"nav-item\" data-module=\"communication\" id=\"nav-communication\" title=\" (4)\">\n              <span class=\"nav-shortcut\">4</span>\n              <i class=\"fas fa-comments nav-icon\"></i>\n              <span class=\"nav-text\"></span>\n            </button>\n          </nav>\n          <div class=\"header-actions\">\n            <button type=\"button\" class=\"fullscreen-button\" id=\"dashboard-fullscreen-button\" title=\" (Enter)\">\n              <i class=\"fas fa-expand\"></i>\n            </button>\n            <div class=\"header-status\">\n              <div class=\"status-indicator online\">\n                <span class=\"status-dot\"></span>\n                <span class=\"status-text\"></span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <!--  -->\n      <main class=\"main-content\">\n        <!--  -->\n        <section class=\"content-panel\">\n          <!--  -->\n          <div class=\"module-container active\" id=\"module-status\">\n            <div class=\"module-body\">\n              <!--  -->\n              <div class=\"maintext-container\">\n                <div class=\"maintext-header\">\n                  <h3 class=\"maintext-title\">\n                    <i class=\"fas fa-scroll\"></i>\n                    \n                  </h3>\n                </div>\n                <div class=\"maintext-areas\">\n                  <div class=\"maintext-section\">\n                    <div class=\"maintext-section-header\">\n                      <span class=\"maintext-section-title\"><i class=\"fas fa-history\" title=\"\"></i></span>\n                    </div>\n                    <div class=\"maintext-section-area\" id=\"maintext-continue-choice\"></div>\n                  </div>\n                  <div class=\"maintext-section\">\n                    <div class=\"maintext-section-header\">\n                      <span class=\"maintext-section-title\"><i class=\"fas fa-microchip\" title=\"\"></i></span>\n                    </div>\n                    <div class=\"maintext-section-area\" id=\"maintext-result\"></div>\n                  </div>\n                  <div class=\"maintext-section\">\n                    <div class=\"maintext-section-header\">\n                      <span class=\"maintext-section-title\"><i class=\"fas fa-bolt\" title=\"\"></i></span>\n                    </div>\n                    <div class=\"maintext-section-area\" id=\"maintext-next-choice\"></div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"status-grid\" id=\"status-grid\"></div>\n            </div>\n          </div>\n\n          <!--  -->\n          <div class=\"module-container\" id=\"module-tasks\">\n            <div class=\"module-body\">\n              <div class=\"entry-list\" id=\"tasks-list\"></div>\n            </div>\n          </div>\n\n          <!--  -->\n          <div class=\"module-container\" id=\"module-net\">\n            <div class=\"module-body net-body\">\n              <!--  updateNetContent  -->\n            </div>\n          </div>\n\n          <!--  -->\n          <div class=\"module-container\" id=\"module-communication\">\n            <div class=\"module-body communication-body\">\n              <div class=\"chat-messages\" id=\"chat-messages\"></div>\n              <div class=\"chat-input-container\">\n                <div class=\"chat-input-wrapper\">\n                  <button type=\"button\" id=\"chat-show-options-btn\" class=\"chat-show-options-btn\" title=\"\">\n                    <i class=\"fas fa-list\"></i>\n                  </button>\n                  <button\n                    type=\"button\"\n                    id=\"chat-regenerate-btn\"\n                    class=\"chat-regenerate-btn\"\n                    title=\" assistant \"\n                  >\n                    <i class=\"fas fa-rotate-right\"></i>\n                  </button>\n                  <button\n                    type=\"button\"\n                    id=\"chat-rollback-btn\"\n                    class=\"chat-rollback-btn\"\n                    title=\"\"\n                  >\n                    <i class=\"fas fa-arrow-left\"></i>\n                  </button>\n                  <button\n                    type=\"button\"\n                    id=\"chat-favorite-btn\"\n                    class=\"chat-favorite-btn\"\n                    title=\"\"\n                  >\n                    <i class=\"fas fa-star\"></i>\n                  </button>\n                  <textarea id=\"chat-input\" class=\"chat-input\" placeholder=\"...\" rows=\"1\"></textarea>\n                  <button type=\"button\" id=\"chat-send-btn\" class=\"chat-send-btn\">\n                    <i class=\"fas fa-paper-plane\"></i>\n                  </button>\n                </div>\n              </div>\n              <!-- Option  -->\n              <div class=\"chat-options-overlay\" id=\"chat-options-overlay\">\n                <div class=\"chat-options-container\" id=\"chat-options-container\">\n                  <div class=\"chat-options-header\">\n                    <span class=\"chat-options-title\"></span>\n                    <button type=\"button\" class=\"chat-options-close\" id=\"chat-options-close\" title=\"\">\n                      <i class=\"fas fa-times\"></i>\n                    </button>\n                  </div>\n                </div>\n                <div class=\"chat-options-list\" id=\"chat-options-list\"></div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <!--  -->\n      <div class=\"modal-overlay\" id=\"modal-overlay\">\n        <div class=\"modal-container\" id=\"modal-container\">\n          <div class=\"modal-header\">\n            <h3 class=\"modal-title\" id=\"modal-title\"></h3>\n            <button class=\"modal-close\" id=\"modal-close\">\n              <i class=\"fas fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"modal-body\" id=\"modal-body\"></div>\n        </div>\n      </div>\n\n    `;\n  }\n\n  private setupEnterKeyFullscreen(): void {\n    try {\n      // \n      if (this.keyDownHandler) {\n        document.removeEventListener('keydown', this.keyDownHandler);\n        this.keyDownHandler = null;\n      }\n\n      // \n      this.keyDownHandler = (e: KeyboardEvent) => {\n        try {\n          //  Dashboard \n          if (!this.element?.classList.contains('active')) {\n            return;\n          }\n\n          //  Enter  Esc \n          const activeElement = document.activeElement;\n          if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {\n            return;\n          }\n\n          // Enter \n          if (e.key === 'Enter') {\n            e.preventDefault();\n            this.toggleFullscreen();\n          }\n        } catch (error) {\n          console.error(' :', error);\n        }\n      };\n\n      document.addEventListener('keydown', this.keyDownHandler);\n      console.log(' Enter ');\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  private requestFullscreen(): void {\n    try {\n      const element = document.documentElement;\n      if (element.requestFullscreen) {\n        element.requestFullscreen().catch(err => {\n          console.warn(':', err);\n        });\n      } else if ((element as any).webkitRequestFullscreen) {\n        (element as any).webkitRequestFullscreen();\n      } else if ((element as any).mozRequestFullScreen) {\n        (element as any).mozRequestFullScreen();\n      } else if ((element as any).msRequestFullscreen) {\n        (element as any).msRequestFullscreen();\n      }\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  private exitFullscreen(): void {\n    try {\n      if (document.exitFullscreen) {\n        document.exitFullscreen();\n      } else if ((document as any).webkitExitFullscreen) {\n        (document as any).webkitExitFullscreen();\n      } else if ((document as any).mozCancelFullScreen) {\n        (document as any).mozCancelFullScreen();\n      } else if ((document as any).msExitFullscreen) {\n        (document as any).msExitFullscreen();\n      }\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  private toggleFullscreen(): void {\n    try {\n      if (!document.fullscreenElement) {\n        this.requestFullscreen();\n      } else {\n        this.exitFullscreen();\n      }\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n}\n","import { PageState } from '../types/types';\nimport { SplashScreen } from '../components/SplashScreen';\nimport { NewGameSetup } from '../components/NewGameSetup';\nimport { Dashboard } from '../components/Dashboard';\nimport { ComponentCallbacks } from '../types/types';\nimport { initializeNewGame, continueGame } from './gameInitializer';\nimport { hasSaveData } from './variableReader';\n\n/**\n * \n */\nexport class PageManager {\n  private currentPage: PageState = 'splash';\n  private splashScreen: SplashScreen;\n  private setupScreen: NewGameSetup;\n  private dashboard: Dashboard;\n  private appContainer: HTMLElement;\n\n  constructor(appContainer: HTMLElement) {\n    this.appContainer = appContainer;\n\n    const callbacks: ComponentCallbacks = {\n      onStart: () => this.goToSplash(),\n      onNewGame: () => this.goToSetup(),\n      onContinue: () => this.goToGame(),\n      onConfirm: (config) => this.handleConfirm(config),\n      onCancel: () => this.goToSplash(),\n      onFullscreenToggle: () => this.toggleFullscreen(),\n    };\n\n    this.splashScreen = new SplashScreen(callbacks);\n    this.setupScreen = new NewGameSetup(callbacks);\n    this.dashboard = new Dashboard(callbacks);\n  }\n\n  public initialize(): void {\n    // \n    this.appContainer.appendChild(this.splashScreen.createElement());\n    this.appContainer.appendChild(this.setupScreen.createElement());\n    this.appContainer.appendChild(this.dashboard.createElement());\n\n    // \n    const hasSave = hasSaveData();\n    if (hasSave) {\n      // \n      this.goToGame();\n    } else {\n      // \n      this.showPage('splash');\n    }\n  }\n\n  private showPage(page: PageState): void {\n    console.log(` : ${page}`);\n\n    // \n    try {\n      this.splashScreen.hide();\n      this.setupScreen.hide();\n      this.dashboard.hide();\n    } catch (error) {\n      console.warn(' :', error);\n    }\n\n    // \n    try {\n      switch (page) {\n        case 'splash':\n          this.splashScreen.show();\n          // \n          this.requestFullscreen();\n          break;\n        case 'setup':\n          this.setupScreen.show();\n          break;\n        case 'game':\n          this.dashboard.show();\n          //  Dashboard \n          setTimeout(() => {\n            const dashboardElement = document.getElementById('main-screen');\n            if (dashboardElement && dashboardElement.classList.contains('active')) {\n              console.log(' Dashboard ');\n            } else {\n              console.error(' Dashboard element:', dashboardElement);\n            }\n          }, 100);\n          break;\n      }\n    } catch (error) {\n      console.error(`  ${page} :`, error);\n      throw error;\n    }\n\n    this.currentPage = page;\n    console.info(` : ${page}`);\n  }\n\n  private goToSplash(): void {\n    this.showPage('splash');\n  }\n\n  private goToSetup(): void {\n    this.showPage('setup');\n  }\n\n  private async goToGame(): Promise<void> {\n    try {\n      console.log(' ...');\n      const gameData = await continueGame();\n      console.log(' :', gameData);\n\n      // \n      this.dashboard.updateGameData(gameData);\n\n      // \n      this.showPage('game');\n\n      console.log(' ');\n    } catch (error) {\n      console.error(' :', error);\n      console.error(' :', {\n        error: error,\n        errorMessage: error instanceof Error ? error.message : String(error),\n        errorStack: error instanceof Error ? error.stack : undefined,\n      });\n\n      // \n      try {\n        this.dashboard.updateGameData({});\n        this.showPage('game');\n        console.warn(' ');\n      } catch (fallbackError) {\n        console.error(' :', fallbackError);\n        toastr.error('', '');\n      }\n    }\n  }\n\n  private async handleConfirm(config: any): Promise<void> {\n    try {\n      // initializeNewGame  createOpeningStoryMessage\n      const gameData = await initializeNewGame(config);\n      this.dashboard.updateGameData(gameData);\n      this.showPage('game');\n      toastr.success('', '');\n    } catch (error) {\n      console.error(':', error);\n      toastr.error('', '');\n    }\n  }\n\n  private requestFullscreen(): void {\n    const element = document.documentElement;\n    if (element.requestFullscreen) {\n      element.requestFullscreen().catch((err) => {\n        console.warn(':', err);\n      });\n    } else if ((element as any).webkitRequestFullscreen) {\n      (element as any).webkitRequestFullscreen();\n    } else if ((element as any).mozRequestFullScreen) {\n      (element as any).mozRequestFullScreen();\n    } else if ((element as any).msRequestFullscreen) {\n      (element as any).msRequestFullscreen();\n    }\n  }\n\n  private toggleFullscreen(): void {\n    if (!document.fullscreenElement) {\n      this.requestFullscreen();\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen();\n      } else if ((document as any).webkitExitFullscreen) {\n        (document as any).webkitExitFullscreen();\n      } else if ((document as any).mozCancelFullScreen) {\n        (document as any).mozCancelFullScreen();\n      } else if ((document as any).msExitFullscreen) {\n        (document as any).msExitFullscreen();\n      }\n    }\n  }\n\n  public getDashboard(): Dashboard {\n    return this.dashboard;\n  }\n}\n","import { GameConfig, GameData } from '../types/types';\nimport { initializeGameData } from './variableUpdater';\n\n// \ndeclare function getVariables(options: { type: 'message' | 'chat' | 'character' | 'global' }): Record<string, any>;\n\n/**\n * \n * assistant\n */\nexport async function initializeNewGame(config: GameConfig): Promise<GameData> {\n  console.info('...', config);\n\n  const gameData = await initializeGameData(config);\n\n  console.info('');\n  return gameData;\n}\n\n/**\n * \n */\nexport async function continueGame(): Promise<Partial<GameData>> {\n  console.info('...');\n\n  const variables = getVariables({ type: 'message' });\n  const gameData = variables.game_data || variables.stat_data || {};\n\n  console.info('');\n  return gameData as Partial<GameData>;\n}\n","//  - Dashboard \n// \n\nimport { stringify } from 'yaml';\n\n// \ndeclare function getChatMessages(\n  range: string | number,\n  options?: { role?: 'all' | 'system' | 'assistant' | 'user' },\n): Array<{ message: string; message_id: number; role: string; data?: Record<string, any> }>;\n\ndeclare function deleteChatMessages(message_ids: number[], options?: { refresh?: 'none' | 'all' }): Promise<void>;\ndeclare function createWorldbookEntries(\n  worldbook_name: string,\n  new_entries: any[],\n): Promise<{ worldbook: any[]; new_entries: any[] }>;\n\ndeclare function getLastMessageId(): number;\n\ndeclare function eventOn(event: string, callback: (...args: any[]) => void): void;\n\ndeclare const tavern_events: {\n  MESSAGE_RECEIVED?: string;\n  MESSAGE_UPDATED?: string;\n};\n\ndeclare const errorCatched: (fn: () => void) => () => void;\n\n// ==========  ==========\nexport function initNavigation() {\n  const navItems = document.querySelectorAll('.nav-item');\n  const modules = document.querySelectorAll('.module-container');\n\n  // \n  function switchModule(moduleId: string) {\n    if (!moduleId) return;\n\n    //  active \n    navItems.forEach(nav => nav.classList.remove('active'));\n    modules.forEach(module => module.classList.remove('active'));\n\n    //  active \n    const targetNavItem = document.querySelector(`.nav-item[data-module=\"${moduleId}\"]`);\n    const targetModule = document.getElementById(`module-${moduleId}`);\n\n    if (targetNavItem) {\n      targetNavItem.classList.add('active');\n    }\n    if (targetModule) {\n      targetModule.classList.add('active');\n    }\n  }\n\n  // \n  navItems.forEach(item => {\n    item.addEventListener('click', () => {\n      const moduleId = item.getAttribute('data-module');\n      if (moduleId) {\n        switchModule(moduleId);\n      }\n    });\n  });\n\n  // 1, 2, 3, 4\n  const moduleMap: Record<string, string> = {\n    '1': 'status',\n    '2': 'tasks',\n    '3': 'net',\n    '4': 'communication',\n  };\n\n  document.addEventListener('keydown', e => {\n    // \n    const mainScreen = document.getElementById('main-screen');\n    if (!mainScreen || !mainScreen.classList.contains('active')) {\n      return;\n    }\n\n    // \n    const activeElement = document.activeElement;\n    if (\n      activeElement &&\n      (activeElement.tagName === 'INPUT' ||\n        activeElement.tagName === 'TEXTAREA' ||\n        (activeElement instanceof HTMLElement && activeElement.isContentEditable))\n    ) {\n      return;\n    }\n\n    //  1-4\n    if (e.key >= '1' && e.key <= '4') {\n      const moduleId = moduleMap[e.key];\n      if (moduleId) {\n        e.preventDefault();\n        switchModule(moduleId);\n        console.log(` : ${moduleId} (${e.key})`);\n      }\n    }\n  });\n}\n\n// ==========  ==========\nexport function initModals() {\n  const modalOverlay = document.getElementById('modal-overlay');\n  const modalClose = document.getElementById('modal-close');\n\n  if (!modalOverlay || !modalClose) return;\n\n  modalClose.addEventListener('click', () => {\n    modalOverlay.classList.remove('active');\n  });\n\n  modalOverlay.addEventListener('click', e => {\n    if (e.target === modalOverlay) {\n      modalOverlay.classList.remove('active');\n    }\n  });\n}\n\n// ==========  ==========\nexport function initAnimations() {\n  //  CSS \n  //  JS \n}\n\n// ==========  ==========\nexport function initStatusCardInteractions() {\n  const statusCards = document.querySelectorAll('.status-card');\n  statusCards.forEach(card => {\n    card.addEventListener('click', () => {\n      // \n      console.log('');\n    });\n  });\n}\n\n// ==========  ==========\n\n/**\n * \n */\ninterface ConversationRound {\n  assistantMessage: {\n    message_id: number;\n    message: string;\n  } | null;\n  userMessage: {\n    message_id: number;\n    message: string;\n  } | null;\n  summary?: string; //  <sum> \n  pending?: boolean; // AI\n  pendingUserMessage?: string; // \n}\n\n/**\n * \n */\nexport function initChatInterface() {\n  const chatInput = document.getElementById('chat-input') as HTMLTextAreaElement;\n  const chatSendBtn = document.getElementById('chat-send-btn') as HTMLButtonElement;\n  const chatRegenerateBtn = document.getElementById('chat-regenerate-btn') as HTMLButtonElement;\n  const chatRollbackBtn = document.getElementById('chat-rollback-btn') as HTMLButtonElement;\n  const chatFavoriteBtn = document.getElementById('chat-favorite-btn') as HTMLButtonElement;\n  const chatMessages = document.getElementById('chat-messages') as HTMLElement;\n\n  if (!chatInput || !chatSendBtn || !chatMessages) {\n    return;\n  }\n\n  // \n  let rounds: ConversationRound[] = [];\n  let currentRoundIndex = -1; // \n\n  // / currentRoundIndex \n  let activePendingRoundIndex: number | null = null;\n\n  function findLastPendingRoundIndex(): number | null {\n    for (let i = rounds.length - 1; i >= 0; i--) {\n      const r = rounds[i];\n      if (r && r.pending) return i;\n    }\n    return null;\n  }\n\n  function getPendingRoundIndexSafe(): number | null {\n    if (\n      activePendingRoundIndex !== null &&\n      activePendingRoundIndex >= 0 &&\n      activePendingRoundIndex < rounds.length &&\n      rounds[activePendingRoundIndex]?.pending\n    ) {\n      return activePendingRoundIndex;\n    }\n    return findLastPendingRoundIndex();\n  }\n\n  // \n  let streamingElement: HTMLElement | null = null;\n\n  // raw\n  let lastStreamedRawMessage: string = '';\n\n  // \n  let isGenerating = false;\n\n  // \n  let isSending = false;\n\n  //  messageGenerator \n  let latestOptions: string[] = [];\n\n  //  message_id rounds  id  id\n  let lastCreatedIds: { userMessageId: number; assistantMessageId: number } | null = null;\n\n  // \n  let optionTimers: any[] = [];\n\n  //  generateMessage \n  let generateMessagePromise: Promise<any> | null = null;\n\n  //  regenerateAssistantMessage \n  let regenerateAssistantMessagePromise: Promise<any> | null = null;\n\n  function ensureRegenerateAssistantLoaded(): Promise<any> {\n    if (!regenerateAssistantMessagePromise) {\n      regenerateAssistantMessagePromise = import('./utils/messageGenerator').then(\n        module => module.regenerateAssistantMessage,\n      );\n    }\n    return regenerateAssistantMessagePromise;\n  }\n\n  // \n  function ensureMessageGeneratorLoaded(): Promise<any> {\n    if (!generateMessagePromise) {\n      generateMessagePromise = import('./utils/messageGenerator').then(module => module.generateMessage);\n    }\n    return generateMessagePromise;\n  }\n\n  // \n  function adjustInputHeight() {\n    chatInput.style.height = 'auto';\n    const maxHeight = 80;\n    const newHeight = Math.min(chatInput.scrollHeight, maxHeight);\n    chatInput.style.height = `${newHeight}px`;\n  }\n\n  chatInput.addEventListener('input', () => {\n    adjustInputHeight();\n    updateButtonStates();\n  });\n\n  // HTML\n  function escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  // \n  // \n  // 1.  assistant  assistantMessage userMessage\n  // 2.  user \n  // 3.  assistant \n  function groupMessagesIntoRounds(\n    allMessages: Array<{\n      message: string;\n      message_id: number;\n      role: string;\n    }>,\n  ): ConversationRound[] {\n    const rounds: ConversationRound[] = [];\n\n    //  assistant \n    let pendingRound: ConversationRound | null = null;\n\n    // \n    allMessages.forEach(msg => {\n      //  user \n      if (msg.role === 'user') {\n        const round: ConversationRound = {\n          userMessage: {\n            message_id: msg.message_id,\n            message: msg.message,\n          },\n          assistantMessage: null,\n        };\n\n        rounds.push(round);\n        pendingRound = round;\n        return;\n      }\n\n      //  assistant \n      if (msg.role === 'assistant') {\n        //  sum\n        let sum = '';\n        const sumMatch = msg.message.match(/<sum>([\\s\\S]*?)<\\/sum>/i);\n        if (sumMatch) {\n          sum = sumMatch[1].trim();\n        }\n\n        // \n        if (pendingRound && !pendingRound.assistantMessage) {\n          pendingRound.assistantMessage = {\n            message_id: msg.message_id,\n            message: msg.message,\n          };\n          if (sum) pendingRound.summary = sum;\n          pendingRound = null;\n        } else {\n          //  /  assistant \n          rounds.push({\n            userMessage: null,\n            assistantMessage: {\n              message_id: msg.message_id,\n              message: msg.message,\n            },\n            summary: sum || undefined,\n          });\n        }\n      }\n    });\n\n    return rounds;\n  }\n\n  // \n  async function displayRound(roundIndex: number) {\n    // \n    if (!isGenerating) {\n      chatMessages.innerHTML = '';\n      streamingElement = null;\n    } else {\n      // \n      const existingMessages = Array.from(chatMessages.children).filter(child => child !== streamingElement);\n      existingMessages.forEach(msg => msg.remove());\n    }\n\n    // AI\n    if (roundIndex < 0 || roundIndex >= rounds.length) {\n      updateButtonStates();\n      return;\n    }\n\n    const round = rounds[roundIndex];\n\n    //  user - \n    if (round.userMessage) {\n      renderUserMessage(round.userMessage.message);\n    } else if (round.pendingUserMessage) {\n      // \n      renderUserMessage(round.pendingUserMessage);\n    }\n\n    //  assistant - \n    if (round.assistantMessage) {\n      await renderAssistantMessage(\n        round.assistantMessage.message,\n        round.assistantMessage.message,\n        round.summary, // \n      );\n    } else if (round.pending && isGenerating) {\n      // \n      if (!streamingElement) {\n        showGenerating();\n      }\n      // \n      if (streamingElement && streamingElement.parentNode === chatMessages) {\n        // \n        chatMessages.appendChild(streamingElement);\n      }\n    }\n\n    updateButtonStates();\n  }\n\n  function updateButtonStates() {\n    if (!chatRegenerateBtn) return;\n\n    // \n    const isLastRound = currentRoundIndex === rounds.length - 1;\n\n    // \n    if (isGenerating || isSending) {\n      if (chatRegenerateBtn) chatRegenerateBtn.disabled = true;\n      if (chatRollbackBtn) chatRollbackBtn.disabled = true;\n      if (showOptionsBtn) (showOptionsBtn as HTMLButtonElement).disabled = true;\n      chatInput.disabled = true;\n      chatSendBtn.disabled = true;\n      return;\n    }\n\n    const round = rounds[currentRoundIndex];\n    if (!round) {\n      chatInput.disabled = !isLastRound;\n      chatSendBtn.disabled = true;\n      return;\n    }\n\n    // \n    const hasUserMessage = !!round.userMessage && typeof round.userMessage.message_id === 'number';\n    const isCompleted = !!round.assistantMessage && !round.pending;\n    \n    // 1.  AI \n    chatRegenerateBtn.disabled = !(isLastRound && hasUserMessage && isCompleted);\n\n    // 2. \n    if (chatRollbackBtn) {\n      chatRollbackBtn.disabled = !(isLastRound && currentRoundIndex > 0);\n    }\n\n    // 3.  AI \n    if (showOptionsBtn) {\n      (showOptionsBtn as HTMLButtonElement).disabled = !(isLastRound && isCompleted);\n    }\n\n    // 4. \n    chatInput.disabled = !isLastRound;\n    chatSendBtn.disabled = !isLastRound || !chatInput.value.trim();\n\n    // 5.  user  assistant \n    if (chatFavoriteBtn) {\n      chatFavoriteBtn.disabled = !(hasUserMessage && isCompleted);\n    }\n  }\n\n  /**\n   * \n   */\n  async function favoriteCurrentRound() {\n    if (isGenerating || isSending) return;\n\n    const round = rounds[currentRoundIndex];\n    if (!round?.userMessage || !round?.assistantMessage || round.pending) {\n      if (typeof toastr !== 'undefined') {\n        toastr.warning('');\n      } else {\n        alert('');\n      }\n      return;\n    }\n\n    const name = prompt('');\n    if (!name || !name.trim()) {\n      return;\n    }\n\n    try {\n      //  net-log-<name> moduleId  log  Dashboard \n      const entryName = `net-log-${name.trim()}`;\n      const { removeSumTags } = await import('./utils/textParser');\n\n      // \n      const content = [\n        {\n          title: name.trim(),\n          author: 'System', // \n          //  ###  Markdown \n          content: `### User\\n${round.userMessage.message}\\n\\n---\\n\\n### Assistant\\n${removeSumTags(\n            round.assistantMessage.message,\n          )}`,\n        },\n      ];\n\n      const yamlContent = stringify(content, { lineWidth: 0 });\n\n      // \n      //  net-log-xxx Dashboard.ts  match[1]  log\n      await createWorldbookEntries('anchor', [\n        {\n          name: entryName,\n          content: yamlContent,\n          enabled: false, // \n          //  WorldbookEntry \n          type: 'constant',\n          keys: [],\n          scan_depth: 0,\n        },\n      ]);\n\n      if (typeof toastr !== 'undefined') {\n        toastr.success(' ');\n      } else {\n        alert(' ');\n      }\n\n      // \n      const dashboardElement = document.getElementById('main-screen');\n      dashboardElement?.dispatchEvent(new CustomEvent('refresh-net'));\n    } catch (error) {\n      console.error(' :', error);\n      if (typeof toastr !== 'undefined') {\n        toastr.error('');\n      } else {\n        alert('');\n      }\n    }\n  }\n\n  //  assistant \n  async function renderAssistantMessage(content: string, rawMessage: string, summaryText?: string) {\n    const messageItem = document.createElement('div');\n    messageItem.className = 'message-item message-assistant';\n\n    try {\n      const { extractContinueChoice, extractResult, extractNextChoice, removeSumTags } =\n        await import('./utils/textParser');\n\n      //  rawMessage  maintext maintext \n      const { extractLastMaintext } = await import('./utils/textParser');\n      const maintext = extractLastMaintext(rawMessage);\n\n      //  maintext  maintext \n      const searchText = maintext || rawMessage;\n\n      const continueChoice = extractContinueChoice(searchText);\n      const result = extractResult(searchText);\n      const nextChoice = extractNextChoice(searchText);\n\n      // \n      const columns: Array<{ header: string; content: string; key: string; icon: string }> = [];\n\n      if (continueChoice) {\n        columns.push({\n          header: '',\n          content: continueChoice,\n          key: 'continue',\n          icon: '<i class=\"fas fa-history\" title=\"\"></i>',\n        });\n      }\n      if (result) {\n        columns.push({\n          header: '',\n          content: result,\n          key: 'result',\n          icon: '<i class=\"fas fa-microchip\" title=\"\"></i>',\n        });\n      }\n      if (nextChoice) {\n        columns.push({\n          header: '',\n          content: nextChoice,\n          key: 'next',\n          icon: '<i class=\"fas fa-bolt\" title=\"\"></i>',\n        });\n      }\n\n      if (columns.length > 0) {\n        // 1-3\n        const columnsHtml = columns\n          .map(\n            col => `\n          <div class=\"message-column\">\n            <div class=\"message-column-header\">${col.icon}</div>\n            <div class=\"message-column-content\">${escapeHtml(col.content)}</div>\n          </div>\n        `,\n          )\n          .join('');\n\n        messageItem.innerHTML = `\n          <div class=\"message-bubble\">\n            <div class=\"message-content message-content-three-columns\">\n              ${columnsHtml}\n            </div>\n            <div class=\"message-time\"></div>\n          </div>\n        `;\n      } else {\n        //  <sum> \n        const displayContent = removeSumTags(content);\n        messageItem.innerHTML = `\n          <div class=\"message-bubble\">\n            <div class=\"message-content\">${escapeHtml(displayContent)}</div>\n            <div class=\"message-time\"></div>\n          </div>\n        `;\n      }\n\n      //  messageItem \n      if (summaryText) {\n        const summaryCard = await createSummaryCardElement(summaryText);\n        if (summaryCard) {\n          messageItem.appendChild(summaryCard);\n        }\n      }\n    } catch (error) {\n      console.error(' :', error);\n      const { removeSumTags } = await import('./utils/textParser');\n      const displayContent = removeSumTags(content);\n      messageItem.innerHTML = `\n        <div class=\"message-bubble\">\n          <div class=\"message-content\">${escapeHtml(displayContent)}</div>\n          <div class=\"message-time\"></div>\n        </div>\n      `;\n    }\n\n    chatMessages.appendChild(messageItem);\n  }\n\n  //  user \n  function renderUserMessage(content: string) {\n    const messageItem = document.createElement('div');\n    messageItem.className = 'message-item message-user';\n\n    // \n    messageItem.innerHTML = `\n      <div class=\"message-bubble\">\n        <div class=\"message-content\">${escapeHtml(content)}</div>\n        <div class=\"message-time\"></div>\n      </div>\n    `;\n\n    chatMessages.appendChild(messageItem);\n  }\n\n  //  summary \n  async function createSummaryCardElement(sumText: string): Promise<HTMLElement | null> {\n    if (!sumText) return null;\n\n    try {\n      const { parseSummary } = await import('./utils/textParser');\n      const sumObj = parseSummary(sumText);\n\n      if (Object.keys(sumObj).length === 0) return null;\n\n      const summaryCard = document.createElement('div');\n      summaryCard.className = 'summary-card';\n\n      // \n      const labelIcons: Record<string, string> = {\n        : 'fa-clock',\n        Time: 'fa-clock',\n        : 'fa-location-dot',\n        Location: 'fa-location-dot',\n        : 'fa-users',\n        Characters: 'fa-users',\n        : 'fa-star',\n        Event: 'fa-star',\n      };\n\n      let innerHTML = '<div class=\"summary-content\">';\n      for (const [key, value] of Object.entries(sumObj)) {\n        const icon = labelIcons[key] || 'fa-info-circle';\n        innerHTML += `\n          <div class=\"summary-item\">\n            <span class=\"summary-label\"><i class=\"fas ${icon}\"></i> ${escapeHtml(key)}</span>\n            <span class=\"summary-value\">${escapeHtml(value)}</span>\n          </div>\n        `;\n      }\n      innerHTML += '</div>';\n\n      summaryCard.innerHTML = innerHTML;\n      return summaryCard;\n    } catch (error) {\n      console.error('  summary :', error);\n      return null;\n    }\n  }\n\n  // \n  async function loadChatHistory() {\n    try {\n      const lastMessageId = getLastMessageId();\n\n      const allMessages = lastMessageId >= 0 ? getChatMessages(`0-${lastMessageId}`) : [];\n      const newRounds = groupMessagesIntoRounds(allMessages);\n\n      rounds = newRounds;\n\n      // \n      if (rounds.length > 0) {\n        currentRoundIndex = rounds.length - 1;\n        if (!isGenerating) {\n          await displayRound(currentRoundIndex);\n        }\n      }\n\n      console.log(' ', rounds.length, '', currentRoundIndex + 1, '');\n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  // \n  async function refreshDisplay() {\n    await loadChatHistory();\n  }\n\n  // \n  function setupKeyboardNavigation() {\n    const communicationModule = document.getElementById('module-communication');\n    if (!communicationModule) return;\n\n    const keyHandler = (e: KeyboardEvent) => {\n      // \n      if (!communicationModule.classList.contains('active')) return;\n      if (document.activeElement === chatInput) return;\n\n      if (e.key === 'ArrowLeft') {\n        e.preventDefault();\n        goToPreviousRound();\n      } else if (e.key === 'ArrowRight') {\n        e.preventDefault();\n        goToNextRound();\n      } else if (e.key === 'o' || e.key === 'O') {\n        // O \n        e.preventDefault();\n        // \n        if (currentRoundIndex !== rounds.length - 1) return;\n        const showOptionsBtn = document.getElementById('chat-show-options-btn') as HTMLButtonElement;\n        if (showOptionsBtn) {\n          showOptionsBtn.click();\n        }\n      }\n    };\n\n    document.addEventListener('keydown', keyHandler);\n  }\n\n  // \n  async function sendMessage() {\n    // \n    if (isSending) {\n      console.warn(' ');\n      return;\n    }\n\n    // \n    if (currentRoundIndex !== rounds.length - 1) {\n      console.warn(' ');\n      return;\n    }\n\n    const message = chatInput.value.trim();\n    if (!message) {\n      return;\n    }\n\n    // \n    isSending = true;\n\n    chatInput.value = '';\n    adjustInputHeight();\n\n    // \n    chatSendBtn.disabled = true;\n    chatInput.disabled = true;\n\n    // \n    isGenerating = true;\n    updateButtonStates();\n\n    //  sendMessage \n    //  generateMessage  loadChatHistory \n\n    try {\n      const generateMessage = await ensureMessageGeneratorLoaded();\n      console.log(' :', message);\n\n      const success = await generateMessage(message, {\n        onShowGenerating: () => {\n          // \n          if (!streamingElement) {\n            showGenerating();\n          }\n        },\n        onHideGenerating: () => {\n          //  DOM \n          //  onRefreshStory -> finalizeStreamingAsAssistant \n          if (streamingElement) {\n            const timeEl = streamingElement.querySelector('.message-time') as HTMLElement | null;\n            if (timeEl) timeEl.textContent = '';\n          }\n        },\n        onError: (error: string) => {\n          console.error(' :', error);\n          hideGenerating();\n          isGenerating = false;\n          chatSendBtn.disabled = false;\n          chatInput.disabled = false;\n          isSending = false;\n\n          //  pending \n          const idx = getPendingRoundIndexSafe();\n          const r = typeof idx === 'number' ? rounds[idx] : rounds[currentRoundIndex];\n          if (r && r.pending) {\n            r.pending = false;\n            if (lastCreatedIds) {\n              r.userMessage = {\n                message_id: lastCreatedIds.userMessageId,\n                message: r.pendingUserMessage || '',\n              };\n            }\n            delete r.pendingUserMessage;\n          }\n          updateButtonStates(); // \n        },\n        onStreamingUpdate: (text: string) => {\n          // /\n          updateStreamingMessage(text);\n\n          //  Dashboard \n          const dashboardElement = document.getElementById('main-screen');\n          dashboardElement?.dispatchEvent(new CustomEvent('refresh-maintext', { detail: { message: text } }));\n        },\n        onRefreshStoryIfOpen: (userMessage: string) => {\n          // user pending\n          console.log(' user :', userMessage);\n\n          // \n          isGenerating = true;\n\n          // pending\n          const pendingRound: ConversationRound = {\n            assistantMessage: null,\n            userMessage: null,\n            pending: true,\n            pendingUserMessage: userMessage,\n          };\n\n          // pendingrounds\n          rounds.push(pendingRound);\n          currentRoundIndex = rounds.length - 1;\n          activePendingRoundIndex = currentRoundIndex;\n\n          // \n          displayRound(currentRoundIndex);\n        },\n        onRefreshStory: async (options?: string[]) => {\n          // assistant \n          console.log(' assistant ');\n\n          if (options && options.length > 0) {\n            latestOptions = options;\n          } else {\n            latestOptions = [];\n          }\n\n          //   finalize\n          //  raw  finalize '' finalize \n          await finalizeStreamingAsAssistant(lastStreamedRawMessage || '');\n\n          //  message_id  id/\n          if (lastCreatedIds) {\n            const idx = getPendingRoundIndexSafe();\n            const r = typeof idx === 'number' ? rounds[idx] : rounds[currentRoundIndex];\n            if (r?.userMessage) r.userMessage.message_id = lastCreatedIds.userMessageId;\n            if (r?.assistantMessage) r.assistantMessage.message_id = lastCreatedIds.assistantMessageId;\n          }\n\n          isGenerating = false;\n          isSending = false;\n          chatSendBtn.disabled = false;\n          chatInput.disabled = false;\n          updateButtonStates();\n\n          //   loadChatHistory()\n\n          // \n          setTimeout(() => {\n            try {\n              const dashboardElement = document.getElementById('main-screen');\n              dashboardElement?.dispatchEvent(\n                new CustomEvent('refresh-maintext', { detail: { message: lastStreamedRawMessage } }),\n              );\n              dashboardElement?.dispatchEvent(new CustomEvent('refresh-status'));\n            } catch (err) {\n              console.debug('refresh-maintext dispatch failed:', err);\n            }\n          }, 200);\n        },\n        onCreatedMessages: (ids: { userMessageId: number; assistantMessageId: number }) => {\n          lastCreatedIds = ids;\n        },\n      });\n\n      if (success) {\n        console.log(' ');\n        //  onRefreshStory \n        //  AI \n      }\n    } catch (error) {\n      console.error(' :', error);\n      hideGenerating();\n      isGenerating = false;\n      // \n      chatSendBtn.disabled = false;\n      chatInput.disabled = false;\n      isSending = false;\n      updateButtonStates();\n    }\n    //  finally  onRefreshStory \n    //  AI \n  }\n\n  //  assistant  generate  assistant \n  async function regenerateCurrentRound() {\n    if (!chatRegenerateBtn) return;\n    if (isGenerating || isSending) return;\n\n    // \n    if (currentRoundIndex !== rounds.length - 1) {\n      console.warn(' ');\n      return;\n    }\n\n    const round = rounds[currentRoundIndex];\n    if (!round?.userMessage) {\n      updateButtonStates();\n      return;\n    }\n\n    const userMessageId = round.userMessage.message_id;\n    const assistantMessageId = round.assistantMessage?.message_id;\n\n    if (typeof userMessageId !== 'number' || !Number.isFinite(userMessageId)) return;\n\n    // UI \n    isSending = true;\n    isGenerating = true;\n    lastStreamedRawMessage = '';\n    chatSendBtn.disabled = true;\n    chatInput.disabled = true;\n    chatRegenerateBtn.disabled = true;\n    if (chatRollbackBtn) chatRollbackBtn.disabled = true;\n\n    //  pending userMessage assistantMessage\n    round.assistantMessage = null;\n    round.pending = true;\n    activePendingRoundIndex = currentRoundIndex;\n    await displayRound(currentRoundIndex);\n\n    try {\n      if (typeof assistantMessageId === 'number' && Number.isFinite(assistantMessageId)) {\n        await deleteChatMessages([assistantMessageId], { refresh: 'none' });\n        console.log('  assistant :', assistantMessageId);\n\n        // \n        const dashboardElement = document.getElementById('main-screen');\n        dashboardElement?.dispatchEvent(new CustomEvent('refresh-maintext'));\n      } else {\n        console.log('  assistant ');\n      }\n\n      const regenerateAssistantMessage = await ensureRegenerateAssistantLoaded();\n\n      await regenerateAssistantMessage(userMessageId, {\n        onShowGenerating: () => {\n          if (!streamingElement) showGenerating();\n        },\n        onHideGenerating: () => {\n          if (streamingElement) {\n            const timeEl = streamingElement.querySelector('.message-time') as HTMLElement | null;\n            if (timeEl) timeEl.textContent = '';\n          }\n        },\n        onError: (error: string) => {\n          console.error(' :', error);\n          hideGenerating();\n          isGenerating = false;\n          isSending = false;\n          chatSendBtn.disabled = false;\n          chatInput.disabled = false;\n          round.pending = false;\n          updateButtonStates();\n          // \n          loadChatHistory();\n        },\n        onStreamingUpdate: (text: string) => {\n          updateStreamingMessage(text);\n\n          //  Dashboard \n          const dashboardElement = document.getElementById('main-screen');\n          dashboardElement?.dispatchEvent(new CustomEvent('refresh-maintext', { detail: { message: text } }));\n        },\n        onRefreshStory: async (options?: string[]) => {\n          console.log(' assistant ');\n\n          latestOptions = options && options.length > 0 ? options : [];\n\n          await finalizeStreamingAsAssistant(lastStreamedRawMessage || '');\n\n          //  assistant  assistantMessageId\n          if (lastCreatedIds) {\n            const idx = getPendingRoundIndexSafe();\n            const r = typeof idx === 'number' ? rounds[idx] : rounds[currentRoundIndex];\n            if (r?.assistantMessage) r.assistantMessage.message_id = lastCreatedIds.assistantMessageId;\n          }\n\n          //  pending\n          round.pending = false;\n\n          isGenerating = false;\n          isSending = false;\n          chatSendBtn.disabled = false;\n          chatInput.disabled = false;\n          updateButtonStates();\n\n          setTimeout(() => {\n            try {\n              const dashboardElement = document.getElementById('main-screen');\n              dashboardElement?.dispatchEvent(\n                new CustomEvent('refresh-maintext', { detail: { message: lastStreamedRawMessage } }),\n              );\n              dashboardElement?.dispatchEvent(new CustomEvent('refresh-status'));\n            } catch (err) {\n              console.debug('refresh-maintext dispatch failed:', err);\n            }\n          }, 200);\n        },\n        onCreatedMessages: (ids: { userMessageId: number; assistantMessageId: number }) => {\n          // regenerate  assistant userMessageId\n          lastCreatedIds = ids;\n        },\n      });\n    } catch (e) {\n      console.error(' :', e);\n      hideGenerating();\n      round.pending = false;\n      isGenerating = false;\n      isSending = false;\n      chatSendBtn.disabled = false;\n      chatInput.disabled = false;\n      updateButtonStates();\n      loadChatHistory();\n    }\n  }\n\n  /**\n   * User + Assistant\n   */\n  async function rollbackToPreviousRound() {\n    if (isGenerating || isSending) return;\n\n    // \n    if (currentRoundIndex !== rounds.length - 1) {\n      console.warn(' ');\n      return;\n    }\n\n    // \n    const round = rounds[currentRoundIndex];\n    if (!round) return;\n\n    // \n    if (rounds.length <= 1) {\n      console.warn(' ');\n      return;\n    }\n\n    const idsToDelete: number[] = [];\n    if (round.assistantMessage?.message_id && typeof round.assistantMessage.message_id === 'number') {\n      idsToDelete.push(round.assistantMessage.message_id);\n    }\n    if (round.userMessage?.message_id && typeof round.userMessage.message_id === 'number') {\n      idsToDelete.push(round.userMessage.message_id);\n    }\n\n    //  pending \n    if (round.pending && lastCreatedIds?.userMessageId) {\n      idsToDelete.push(lastCreatedIds.userMessageId);\n    }\n\n    if (idsToDelete.length === 0) {\n      console.warn('  ID');\n      //  ID\n      rounds.splice(currentRoundIndex, 1);\n      currentRoundIndex = Math.max(0, rounds.length - 1);\n      await displayRound(currentRoundIndex);\n      updateButtonStates();\n      return;\n    }\n\n    // \n    if (!confirm('')) {\n      return;\n    }\n\n    try {\n      // UI \n      isSending = true;\n      chatSendBtn.disabled = true;\n      chatInput.disabled = true;\n      if (chatRegenerateBtn) chatRegenerateBtn.disabled = true;\n      if (chatRollbackBtn) chatRollbackBtn.disabled = true;\n\n      // 1. \n      await deleteChatMessages(idsToDelete, { refresh: 'none' });\n      console.log(' :', idsToDelete);\n\n      // 2. \n      rounds.splice(currentRoundIndex, 1);\n\n      // 3. \n      currentRoundIndex = Math.max(0, rounds.length - 1);\n\n      // 4. \n      latestOptions = [];\n\n      // 5. \n      await displayRound(currentRoundIndex);\n\n      // 6. \n      const dashboardElement = document.getElementById('main-screen');\n      dashboardElement?.dispatchEvent(new CustomEvent('refresh-maintext'));\n      dashboardElement?.dispatchEvent(new CustomEvent('refresh-status'));\n\n      // 7. \n      setTimeout(() => {\n        showOptionsOverlay();\n      }, 300);\n\n      console.log(' ');\n    } catch (error) {\n      console.error(' :', error);\n      alert('');\n    } finally {\n      isSending = false;\n      chatSendBtn.disabled = false;\n      chatInput.disabled = false;\n      updateButtonStates();\n    }\n  }\n\n  // \n  function showGenerating() {\n    if (!streamingElement) {\n      streamingElement = document.createElement('div');\n      streamingElement.className = 'message-item message-assistant message-streaming';\n      streamingElement.innerHTML = `\n        <div class=\"message-bubble\">\n          <div class=\"message-content message-content-three-columns\"></div>\n        </div>\n      `;\n      chatMessages.appendChild(streamingElement);\n    }\n  }\n\n  // \n  function hideGenerating() {\n    if (streamingElement) {\n      streamingElement.remove();\n      streamingElement = null;\n    }\n  }\n\n  // \n  async function finalizeStreamingAsAssistant(finalText: string) {\n    //  streamingElement  rounds  race\n    //  DOM \n    if (streamingElement) {\n      try {\n        //  finalText \n        let columnsContainer = streamingElement.querySelector('.message-content-three-columns') as HTMLElement;\n        if (!columnsContainer) {\n          //  updateColumnsFromStream \n          streamingElement.innerHTML = `\n            <div class=\"message-bubble\">\n              <div class=\"message-content message-content-three-columns\"></div>\n              <div class=\"message-time\"></div>\n            </div>\n          `;\n          columnsContainer = streamingElement.querySelector('.message-content-three-columns') as HTMLElement;\n        }\n\n        //  finalText \n        await updateColumnsFromStream(finalText, columnsContainer);\n      } catch (err) {\n        //  <sum> \n        console.error(' finalize  DOM :', err);\n        const { removeSumTags } = await import('./utils/textParser');\n        const displayContent = removeSumTags(finalText);\n        if (streamingElement) {\n          streamingElement.innerHTML = `\n            <div class=\"message-bubble\">\n              <div class=\"message-content\">${escapeHtml(displayContent)}</div>\n              <div class=\"message-time\"></div>\n            </div>\n          `;\n        }\n      }\n\n      // \n      streamingElement.classList.remove('message-streaming');\n      const timeEl = streamingElement.querySelector('.message-time');\n      if (timeEl) timeEl.textContent = '';\n    }\n\n    //  rounds  finalText\n    //  currentRoundIndex\n    const pendingIdx = getPendingRoundIndexSafe();\n    if (typeof pendingIdx === 'number' && pendingIdx >= 0 && pendingIdx < rounds.length) {\n      const targetRound = rounds[pendingIdx];\n      if (targetRound && targetRound.pending) {\n        //  sum\n        let sum = '';\n        const sumMatch = finalText.match(/<sum>([\\s\\S]*?)<\\/sum>/i);\n        if (sumMatch) {\n          sum = sumMatch[1].trim();\n        }\n\n        //  pending finalText  assistantMessage\n        targetRound.assistantMessage = {\n          //  id id \n          message_id: Date.now(),\n          message: finalText || (streamingElement ? streamingElement.textContent || '' : ''),\n        };\n\n        if (sum) targetRound.summary = sum;\n\n        //  pendingUserMessage ->  userMessage id\n        if (targetRound.pendingUserMessage) {\n          targetRound.userMessage = {\n            message_id: Date.now() - 1,\n            message: targetRound.pendingUserMessage,\n          };\n        }\n\n        targetRound.pending = false;\n        delete targetRound.pendingUserMessage;\n\n        //  sum summary \n        if (sum && streamingElement) {\n          const summaryCard = await createSummaryCardElement(sum);\n          if (summaryCard) {\n            streamingElement.appendChild(summaryCard);\n          }\n        }\n      }\n    } else {\n      console.warn(' finalize:  pending ');\n    }\n\n    //   displayRound()  DOM\n    //  chatMessages //\n    //  rounds \n    streamingElement = null;\n    activePendingRoundIndex = null;\n  }\n\n  // /\n  async function updateStreamingMessage(text: string) {\n    //  finalize \n    lastStreamedRawMessage = text;\n\n    if (!streamingElement) {\n      // \n      showGenerating();\n    }\n\n    if (!streamingElement) return;\n\n    try {\n      // \n      let columnsContainer = streamingElement.querySelector('.message-content-three-columns') as HTMLElement;\n      if (!columnsContainer) {\n        streamingElement.innerHTML = `\n          <div class=\"message-bubble\">\n            <div class=\"message-content message-content-three-columns\"></div>\n            <div class=\"message-time\"></div>\n          </div>\n        `;\n        columnsContainer = streamingElement.querySelector('.message-content-three-columns') as HTMLElement;\n        if (!columnsContainer) return;\n      }\n\n      await updateColumnsFromStream(text, columnsContainer);\n    } catch (error) {\n      console.error(' :', error);\n    }\n  }\n\n  // /\n  async function updateColumnsFromStream(text: string, container: HTMLElement) {\n    // \n    const columnConfigs = [\n      {\n        tag: 'continue_choice',\n        header: '<i class=\"fas fa-history\" title=\"\"></i>',\n        key: 'continue',\n      },\n      {\n        tag: 'result',\n        header: '<i class=\"fas fa-microchip\" title=\"\"></i>',\n        key: 'result',\n      },\n      {\n        tag: 'decision_node',\n        header: '<i class=\"fas fa-bolt\" title=\"\"></i>',\n        key: 'next',\n      },\n    ];\n\n    // \n    for (const config of columnConfigs) {\n      const startTag = `<${config.tag}>`;\n      const endTag = `</${config.tag}>`;\n\n      // \n      let columnElement = container.querySelector(`[data-column-key=\"${config.key}\"]`) as HTMLElement;\n\n      // \n      if (columnElement) {\n        const isClosed = columnElement.hasAttribute('data-closed');\n        if (isClosed) {\n          // \n          continue;\n        }\n      }\n\n      // \n      const startIndex = text.indexOf(startTag);\n      if (startIndex === -1) {\n        // \n        continue;\n      }\n\n      // \n      const contentStart = startIndex + startTag.length;\n      const endIndex = text.indexOf(endTag, contentStart);\n\n      let content = '';\n\n      if (endIndex !== -1) {\n        // \n        content = text.substring(contentStart, endIndex);\n\n        // \n        if (!columnElement) {\n          columnElement = document.createElement('div');\n          columnElement.className = 'message-column';\n          columnElement.setAttribute('data-column-key', config.key);\n          const headerElement = document.createElement('div');\n          headerElement.className = 'message-column-header';\n          headerElement.innerHTML = config.header;\n          const contentElement = document.createElement('div');\n          contentElement.className = 'message-column-content';\n          columnElement.appendChild(headerElement);\n          columnElement.appendChild(contentElement);\n          container.appendChild(columnElement);\n        }\n\n        // \n        columnElement.setAttribute('data-closed', 'true');\n      } else {\n        // \n        content = text.substring(contentStart);\n\n        // \n        if (!columnElement) {\n          columnElement = document.createElement('div');\n          columnElement.className = 'message-column';\n          columnElement.setAttribute('data-column-key', config.key);\n          const headerElement = document.createElement('div');\n          headerElement.className = 'message-column-header';\n          headerElement.innerHTML = config.header;\n          const contentElement = document.createElement('div');\n          contentElement.className = 'message-column-content';\n          columnElement.appendChild(headerElement);\n          columnElement.appendChild(contentElement);\n          container.appendChild(columnElement);\n        }\n      }\n\n      //  HTML\n      const contentElement = columnElement.querySelector('.message-column-content') as HTMLElement;\n      if (contentElement) {\n        // \n        const oldScrollTop = contentElement.scrollTop;\n        const oldScrollHeight = contentElement.scrollHeight;\n        const wasAtBottom = oldScrollTop + contentElement.clientHeight >= oldScrollHeight - 10;\n\n        // \n        contentElement.textContent = content;\n\n        // \n        if (wasAtBottom) {\n          // \n          contentElement.scrollTop = contentElement.scrollHeight;\n        } else {\n          // \n          const newScrollHeight = contentElement.scrollHeight;\n          if (newScrollHeight > oldScrollHeight) {\n            // \n            contentElement.scrollTop = oldScrollTop + (newScrollHeight - oldScrollHeight);\n          } else {\n            // \n            contentElement.scrollTop = oldScrollTop;\n          }\n        }\n      }\n    }\n  }\n\n  // \n  function goToPreviousRound() {\n    if (currentRoundIndex > 0) {\n      currentRoundIndex--;\n      displayRound(currentRoundIndex);\n    }\n  }\n\n  // \n  function goToNextRound() {\n    if (currentRoundIndex < rounds.length - 1) {\n      currentRoundIndex++;\n      displayRound(currentRoundIndex);\n    }\n  }\n\n  // ========== Option  ==========\n  const optionsOverlay = document.getElementById('chat-options-overlay');\n  const optionsContainer = document.getElementById('chat-options-container');\n  const optionsList = document.getElementById('chat-options-list');\n  const showOptionsBtn = document.getElementById('chat-show-options-btn');\n  const closeOptionsBtn = document.getElementById('chat-options-close');\n\n  // \n  async function getOptionsFromLatestMessage(): Promise<string[]> {\n    try {\n      //  messageGenerator \n      if (latestOptions.length > 0) {\n        console.log('  messageGenerator ');\n        return latestOptions;\n      }\n\n      //  assistant  data \n      const messages = getChatMessages(-1, { role: 'assistant' });\n      const lastMessage = messages.length > 0 ? messages[messages.length - 1] : null;\n      if (!lastMessage) {\n        return [];\n      }\n\n      if (lastMessage.data?.__options && lastMessage.data.__options.length > 0) {\n        console.log('  assistant.data ');\n        return lastMessage.data.__options;\n      }\n\n      // \n      const { extractAllOptions } = await import('./utils/textParser');\n      const messageContent = lastMessage.message || '';\n      const options = extractAllOptions(messageContent);\n      if (options.length > 0) {\n        console.log(' ');\n      }\n      return options;\n    } catch (error) {\n      console.error(' :', error);\n      return [];\n    }\n  }\n\n  // \n  async function showOptionsOverlay() {\n    if (!optionsOverlay || !optionsContainer || !optionsList) {\n      return;\n    }\n\n    // \n    optionTimers.forEach(timer => clearTimeout(timer));\n    optionTimers = [];\n\n    const options = await getOptionsFromLatestMessage();\n\n    if (options.length === 0) {\n      // option\n      showNoOptionsMessage();\n      return;\n    }\n\n    // \n    optionsList.innerHTML = '';\n\n    // \n    optionsList.classList.remove('collapse');\n\n    // \n    optionsList.style.position = 'absolute';\n    optionsList.style.top = '0';\n    optionsList.style.left = '0';\n    optionsList.style.right = '0';\n    optionsList.style.bottom = '0';\n    optionsList.style.width = '100%';\n    optionsList.style.height = '100%';\n    //  list  hover hover / CSS \n    //  click handler  list  overlay \n    optionsList.style.pointerEvents = 'auto';\n\n    //  overlay \n    if (!optionsOverlay) return;\n\n    // \n    const usedPositions: Array<{ x: number; y: number }> = [];\n    const minDistance = 150; // \n\n    // \n    function generateRandomPosition(): { x: number; y: number } {\n      const maxAttempts = 50;\n      let attempts = 0;\n      const margin = 0.15; // 15%\n\n      while (attempts < maxAttempts) {\n        // \n        const x = margin + Math.random() * (1 - 2 * margin);\n        const y = margin + Math.random() * (1 - 2 * margin);\n\n        // \n        const tooClose = usedPositions.some(pos => {\n          const overlayWidth = optionsOverlay!.clientWidth;\n          const overlayHeight = optionsOverlay!.clientHeight;\n          const dx = (x - pos.x) * overlayWidth;\n          const dy = (y - pos.y) * overlayHeight;\n          const distance = Math.sqrt(dx * dx + dy * dy);\n          return distance < minDistance;\n        });\n\n        if (!tooClose) {\n          usedPositions.push({ x, y });\n          return { x, y };\n        }\n\n        attempts++;\n      }\n\n      // \n      const x = margin + Math.random() * (1 - 2 * margin);\n      const y = margin + Math.random() * (1 - 2 * margin);\n      usedPositions.push({ x, y });\n      return { x, y };\n    }\n\n    // \n    options.forEach((optionText, index) => {\n      // \n      const delay = index * 80; // \n\n      const timer = setTimeout(() => {\n        // STEP 1:  +  CSS \n        const chatOption = document.createElement('div');\n        chatOption.className = 'chat-option';\n\n        const floatInner = document.createElement('div');\n        floatInner.className = 'chat-option-inner';\n\n        const optionButton = document.createElement('button');\n        optionButton.type = 'button';\n        optionButton.className = 'chat-option-button';\n\n        const optionTextSpan = document.createElement('span');\n        optionTextSpan.className = 'chat-option-text';\n        optionTextSpan.textContent = optionText;\n        optionButton.title = optionText;\n\n        optionButton.appendChild(optionTextSpan);\n        floatInner.appendChild(optionButton);\n        chatOption.appendChild(floatInner);\n\n        // \n        const position = generateRandomPosition();\n        const rotate = (Math.random() - 0.5) * 30; // -15  15 \n\n        chatOption.style.setProperty('--rot', `${rotate}deg`);\n        chatOption.style.left = `${position.x * 100}%`;\n        chatOption.style.top = `${position.y * 100}%`;\n        chatOption.style.position = 'absolute';\n        chatOption.style.pointerEvents = 'auto'; // \n\n        // \"\"\n        const weight = options.length - index;\n        // \n        optionButton.style.opacity = `${0.85 + weight * 0.03}`;\n        // \n        optionButton.style.filter = 'none';\n\n        // \n        optionButton.addEventListener('click', () => {\n          optionButton.classList.add('selected');\n          chatOption.classList.add('selected-parent');\n          optionsList.classList.add('collapse');\n\n          setTimeout(() => {\n            chatInput.value = optionText;\n            adjustInputHeight();\n            sendMessage();\n            hideOptionsOverlay();\n          }, 220);\n        });\n\n        optionsList.appendChild(chatOption);\n\n        // \"\"\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            chatOption.classList.add('show');\n          });\n        });\n      }, delay);\n\n      optionTimers.push(timer);\n    });\n\n    optionsOverlay.classList.add('active');\n    console.log(`  ${options.length} `);\n  }\n\n  // \n  function showNoOptionsMessage() {\n    const messageDiv = document.createElement('div');\n    messageDiv.className = 'chat-no-options-message';\n    messageDiv.innerHTML = `\n      <div class=\"chat-no-options-content\">\n        <div class=\"chat-no-options-text\"> qwq</div>\n        <button type=\"button\" class=\"chat-no-options-close\" title=\"\"></button>\n      </div>\n    `;\n\n    const closeBtn = messageDiv.querySelector('.chat-no-options-close');\n    if (closeBtn) {\n      closeBtn.addEventListener('click', () => {\n        hideOptionsOverlay();\n      });\n    }\n\n    // \n    if (optionsList) {\n      optionsList.innerHTML = '';\n      // \n      optionsList.style.position = 'absolute';\n      optionsList.style.top = '50%';\n      optionsList.style.left = '50%';\n      optionsList.style.transform = 'translate(-50%, -50%)';\n      optionsList.style.width = 'auto';\n      optionsList.style.height = 'auto';\n      optionsList.style.pointerEvents = 'auto';\n      optionsList.classList.remove('collapse');\n      optionsList.appendChild(messageDiv);\n    }\n\n    // \n    if (optionsOverlay) {\n      optionsOverlay.classList.add('active');\n    }\n  }\n\n  // \n  function hideOptionsOverlay() {\n    if (optionsOverlay) {\n      optionsOverlay.classList.remove('active');\n    }\n    //  collapse \n    if (optionsList) {\n      optionsList.classList.remove('collapse');\n    }\n  }\n\n  // \n  if (showOptionsBtn) {\n    showOptionsBtn.addEventListener('click', showOptionsOverlay);\n  }\n\n  if (closeOptionsBtn) {\n    closeOptionsBtn.addEventListener('click', hideOptionsOverlay);\n  }\n\n  if (optionsOverlay) {\n    optionsOverlay.addEventListener('click', e => {\n      // \n      // - target  overlay\n      // -  target  list list \n      if (e.target === optionsOverlay || e.target === optionsList) {\n        hideOptionsOverlay();\n      }\n    });\n  }\n\n  // \n  chatSendBtn.addEventListener('click', sendMessage);\n\n  // \n  if (chatRegenerateBtn) {\n    chatRegenerateBtn.addEventListener('click', regenerateCurrentRound);\n  }\n\n  // \n  if (chatFavoriteBtn) {\n    chatFavoriteBtn.addEventListener('click', favoriteCurrentRound);\n  }\n\n  // \n  if (chatRollbackBtn) {\n    chatRollbackBtn.addEventListener('click', rollbackToPreviousRound);\n  }\n\n  //  Enter Shift+Enter \n  chatInput.addEventListener('keydown', e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  });\n\n  // \n  setupKeyboardNavigation();\n\n  // \n  function setupModuleSwitchListener() {\n    const communicationModule = document.getElementById('module-communication');\n    if (!communicationModule) return;\n\n    const observer = new MutationObserver(() => {\n      if (communicationModule.classList.contains('active')) {\n        console.log(' ');\n        refreshDisplay();\n      }\n    });\n\n    observer.observe(communicationModule, {\n      attributes: true,\n      attributeFilter: ['class'],\n    });\n  }\n\n  // \n  loadChatHistory();\n\n  // \n  setupModuleSwitchListener();\n}\n","//  - \nimport { PageManager } from './utils/pageManager';\nimport { initNavigation, initModals, initAnimations, initStatusCardInteractions, initChatInterface } from './dashboardLogic';\n\nlet pageManager: PageManager | null = null;\n\n/**\n * \n */\nfunction initApp() {\n  const appContainer = document.getElementById('app');\n  if (!appContainer) {\n    console.error(' #app ');\n    return;\n  }\n\n  // \n  pageManager = new PageManager(appContainer);\n  pageManager.initialize();\n\n  // \n  const mainScreen = document.getElementById('main-screen');\n  if (mainScreen) {\n    const observer = new MutationObserver(() => {\n      if (mainScreen.classList.contains('active')) {\n        // DOM\n        setTimeout(() => {\n          initDashboardFeatures();\n        }, 100);\n      }\n    });\n\n    observer.observe(mainScreen, {\n      attributes: true,\n      attributeFilter: ['class'],\n    });\n  }\n\n  // \n  eventOn(tavern_events.MESSAGE_UPDATED, () => {\n    if (pageManager) {\n      const dashboard = pageManager.getDashboard();\n      // \n      // \n      console.info('');\n    }\n  });\n}\n\n/**\n * \n */\nfunction initDashboardFeatures() {\n  // \n  if (document.querySelector('.nav-item[data-module=\"status\"]')?.hasAttribute('data-initialized')) {\n    return;\n  }\n\n  initNavigation();\n  initModals();\n  initAnimations();\n  initStatusCardInteractions();\n  initChatInterface();\n\n  // \n  document.querySelectorAll('.nav-item').forEach(item => {\n    item.setAttribute('data-initialized', 'true');\n  });\n\n  console.info('');\n}\n\n//  jQuery \n$(() => {\n  errorCatched(initApp)();\n});\n\n// \n$(window).on('pagehide', () => {\n  console.info('');\n  if (pageManager) {\n    // \n  }\n});\n","// \nimport './styles.css';\n\n// \nfunction init() {\n  //  FontAwesome CSS\n  if (!document.querySelector('link[href*=\"font-awesome\"]')) {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css';\n    document.head.appendChild(link);\n  }\n\n  //  meta \n  if (!document.querySelector('meta[charset]')) {\n    const charset = document.createElement('meta');\n    charset.setAttribute('charset', 'UTF-8');\n    document.head.appendChild(charset);\n  }\n\n  if (!document.querySelector('meta[name=\"viewport\"]')) {\n    const viewport = document.createElement('meta');\n    viewport.setAttribute('name', 'viewport');\n    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0');\n    document.head.appendChild(viewport);\n  }\n\n  // \n  document.title = '';\n\n  // \n  if (!document.querySelector('meta[name=\"description\"]')) {\n    const description = document.createElement('meta');\n    description.setAttribute('name', 'description');\n    description.setAttribute('content', ' -  - ');\n    document.head.appendChild(description);\n  }\n}\n\n//  jQuery \n$(() => {\n  init();\n  console.info('');\n});\n\n// \n$(window).on('pagehide', () => {\n  console.info('');\n});\n\n// \nimport './app';\n"],"names":["checkGenerateAvailable","generate","window","async","regenerateAssistantMessage","userMessageId","callbacks","onShowGenerating","streamingHandler","eventOn","iframe_events","STREAM_TOKEN_RECEIVED_FULLY","fullText","cleanedText","trim","length","onStreamingUpdate","console","log","Error","generatePromise","should_stream","timeoutPromise","Promise","_","reject","setTimeout","result","race","cleanedResult","onHideGenerating","onError","maintext","extractLastMaintext","option","sum","updateVariable","finalMessage","base","userMsg","getChatMessages","data","role","Mvu","getMvuData","type","message_id","stat_data","display_data","delta_data","finalData","parseMessage","parsed","e","warn","extractedOptions","extractAllOptions","maintextContent","sumContent","messageToSave","includes","createChatMessages","message","__options","refresh","assistantMessageId","getLastMessageId","onCreatedMessages","onRefreshStory","error","generateMessage","userInput","messages","openingMsg","options","cleanedMessage","setChatMessages","cleanOpeningMessage","mvu_data","waitGlobalInitialized","initData","latestData","chatData","getBaseMvuData","checkAndRefresh","retries","checkMessageId","onRefreshStoryIfOpen","createError","String","substring","generateError","errorType","errorMessage","errorStack","stack","undefined","userMessage","module","exports","initializeGameData","config","currentMvuData","currentStatData","updatedStatData","reserve","system_state","antimatter","clampedReserve","info","updatedMvuData","replaceMvuData","updateMvuVariables","gameData","station_name","difficulty","resources","energy","supplies","crew","status","life_support","system","personnel","communication","laboratory","storage","computing","tasks","diary","currentData","getVariables","updatedData","game_data","replaceVariables","updateGameData","game_config","updateGameConfig","removeThinkingTags","text","lastResult","replace","removeThinkingTagsFromStream","cleaned","lastThinkingStart","lastIndexOf","removeSumTags","removeOptionTags","removeSuboptionTags","parseSummary","sumText","split","forEach","part","match","key","value","matches","contentMatch","extractContinueChoice","extractResult","extractNextChoice","extractLastOption","suboptionMatches","content","push","optionMatches","lines","map","line","filter","extractLastSum","extractLastUpdateVariable","validateMessage","messageContent","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","hasSaveData","lastMessageId","SplashScreen","element","constructor","this","createElement","div","document","className","id","innerHTML","getHTML","bindEvents","updateContinueButton","show","classList","add","hide","remove","destroy","$","off","keyDownHandler","removeEventListener","continueButton","querySelector","style","display","newGameButton","addEventListener","onNewGame","onContinue","fullscreenButton","requestFullscreen","contains","preventDefault","documentElement","catch","err","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","NewGameSetup","reserveInput","getConfig","updateMvuVariable","confirmButton","inputValue","toastr","parseInt","isNaN","Number","isInteger","onConfirm","cancelButton","onCancel","Math","max","min","showdown","YAML","Dashboard","mvuUpdateListener","statusRetryCount","statusRetryTimer","markdownConverter","netCategories","netReport","expandedSections","Set","selectedItem","tables","strikethrough","tasklists","simpleLineBreaks","ghCodeBlocks","openLinksInNewWindow","refreshData","fallbackDiv","stop","clearTimeout","updateStatusCards","updateTasksList","updateNetContent","loadMaintextFromChat","loadNetFromWorldbook","statusGrid","timeout","intervalBetweenAttempts","chatSystemState","latestSystemState","initSystemState","latest","initMsg","systemState","cycle","system_pressure","instability","population","cards","leakRisk","leak_risk","reservePercent","round","riskLevel","toLocaleString","toFixed","pop","active","standby","archived","total","pressure","pressurePercent","pressureLevel","instabilityPercent","instabilityLevel","join","tasksList","Array","isArray","getDefaultTasks","task","getTaskIcon","escapeHtml","title","getStatusText","time","priority","getPriorityText","description","netContainer","sidebarHtml","cat","renderSidebarSection","label","items","reportSidebarHtml","renderNetViewer","bindNetSidebarEvents","categoryId","editor","on","target","saveReportToVariables","saveBtn","deleteBtn","titleInput","authorInput","contentEditor","newTitle","newAuthor","newContent","index","addClass","saveHistoryItem","category","find","c","author","success","alert","removeClass","item","confirm","deleteHistoryItem","splice","entryName","deleteWorldbookEntries","name","oldEntryName","updateWorldbookWith","worldbook","entryIndex","findIndex","updatedContent","stringify","lineWidth","isExpanded","has","icon","itemsHtml","renderMarkdown","makeHtml","sectionId","currentTarget","closest","attr","delete","NET_ENTRY_REGEX","getWorldbook","categoriesMap","Map","entry","alias","parse","itemsArray","set","from","values","firstCatId","gameVariables","player_report","updateStatDataVariable","updateChatMessages","getDefaultMessages","textContent","parseMaintext","maintextMatch","updateMaintextDisplay","then","el","continueChoice","nextChoice","continueChoiceArea","resultArea","nextChoiceArea","lastMessage","setupMessageListener","tavern_events","handleMessageReceived","MESSAGE_RECEIVED","CHAT_CHANGED","MESSAGE_UPDATED","latestMessage","detail","toggleFullscreen","setupEnterKeyFullscreen","events","VARIABLE_UPDATE_ENDED","activeElement","tagName","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","fullscreenElement","PageManager","currentPage","splashScreen","setupScreen","dashboard","appContainer","onStart","goToSplash","goToSetup","goToGame","handleConfirm","onFullscreenToggle","initialize","appendChild","showPage","page","dashboardElement","getElementById","variables","continueGame","fallbackError","initializeNewGame","getDashboard","initChatInterface","chatInput","chatSendBtn","chatRegenerateBtn","chatRollbackBtn","chatFavoriteBtn","chatMessages","rounds","currentRoundIndex","activePendingRoundIndex","getPendingRoundIndexSafe","pending","i","r","findLastPendingRoundIndex","streamingElement","lastStreamedRawMessage","isGenerating","isSending","latestOptions","lastCreatedIds","optionTimers","generateMessagePromise","regenerateAssistantMessagePromise","adjustInputHeight","height","newHeight","scrollHeight","displayRound","roundIndex","children","child","msg","updateButtonStates","renderUserMessage","pendingUserMessage","assistantMessage","rawMessage","summaryText","messageItem","searchText","columns","header","columnsHtml","col","displayContent","summaryCard","createSummaryCardElement","renderAssistantMessage","summary","showGenerating","parentNode","isLastRound","disabled","showOptionsBtn","hasUserMessage","isCompleted","sumObj","keys","labelIcons","Time","Location","Characters","Event","entries","loadChatHistory","newRounds","allMessages","pendingRound","sumMatch","groupMessagesIntoRounds","sendMessage","timeEl","hideGenerating","idx","updateStreamingMessage","dispatchEvent","CustomEvent","finalizeStreamingAsAssistant","debug","ids","finalText","columnsContainer","updateColumnsFromStream","pendingIdx","targetRound","Date","now","container","columnConfigs","tag","startTag","endTag","columnElement","hasAttribute","startIndex","indexOf","contentStart","endIndex","setAttribute","headerElement","contentElement","oldScrollTop","scrollTop","oldScrollHeight","wasAtBottom","clientHeight","newScrollHeight","optionsOverlay","optionsContainer","optionsList","closeOptionsBtn","showOptionsOverlay","timer","getOptionsFromLatestMessage","messageDiv","closeBtn","hideOptionsOverlay","position","top","left","transform","width","pointerEvents","showNoOptionsMessage","right","bottom","usedPositions","optionText","chatOption","floatInner","optionButton","optionTextSpan","attempts","margin","x","random","y","some","pos","overlayWidth","clientWidth","overlayHeight","dx","dy","sqrt","generateRandomPosition","rotate","setProperty","weight","opacity","requestAnimationFrame","isFinite","deleteChatMessages","warning","prompt","yamlContent","createWorldbookEntries","enabled","scan_depth","idsToDelete","shiftKey","communicationModule","click","setupKeyboardNavigation","MutationObserver","refreshDisplay","observe","attributes","attributeFilter","setupModuleSwitchListener","pageManager","initApp","mainScreen","navItems","querySelectorAll","modules","switchModule","nav","targetNavItem","targetModule","getAttribute","moduleMap","HTMLElement","isContentEditable","initNavigation","modalOverlay","modalClose","initModals","card","initDashboardFeatures","errorCatched","link","rel","href","head","charset","viewport","init"],"ignoreList":[],"sourceRoot":""}