<head><script type="module">import{waitUntil as e}from'https://testingcf.jsdelivr.net/npm/async-wait-until/+esm';var t={137(e,t,s){s.d(t,{generateMessage:()=>c,regenerateAssistantMessage:()=>r});var n=s(224),a=s.n(n),i=s(685);function o(){return'undefined'!=typeof generate||!('undefined'==typeof window||!window.generate)}async function r(e,t={}){try{t.onShowGenerating&&t.onShowGenerating();let s=null;if('undefined'!=typeof eventOn&&iframe_events?.STREAM_TOKEN_RECEIVED_FULLY?(s=e=>{const s=(0,i.Wq)(e);s&&0!==s.trim().length?t.onStreamingUpdate?.(s):t.onStreamingUpdate?.('')},eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY,s),console.log('âœ… [regen] å·²æ³¨å†Œæµå¼è¾“å‡ºç›‘å¬å™¨')):console.log('â„¹ï¸ [regen] æµå¼äº‹ä»¶ä¸å¯ç”¨ï¼Œé€€åŒ–ä¸ºéæµå¼æ¨¡å¼'),!o())throw new Error('generate å‡½æ•°ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿é…’é¦†åŠ©æ‰‹å·²æ­£ç¡®åŠ è½½');const n=generate({should_stream:!0}),a=new Promise((_,e)=>{setTimeout(()=>e(new Error('generate è°ƒç”¨è¶…æ—¶ï¼ˆ5åˆ†é’Ÿï¼‰')),3e5)}),r=await Promise.race([n,a]),c=(0,i.OK)(r);if(!c||!(0,i.Mq)(c))return t.onHideGenerating&&t.onHideGenerating(),t.onError?.('ç”Ÿæˆçš„æ¶ˆæ¯ä¸ç¬¦åˆè§„èŒƒ'),!1;const l=(0,i.extractLastMaintext)(c),d=(0,i.l$)(c),u=(0,i.$R)(c),m=(0,i.Xo)(c);if(!l||!d)return t.onHideGenerating&&t.onHideGenerating(),t.onError?.('æ— æ³•æå– maintext æˆ– option'),!1;let h=`<maintext>${l}</maintext>\n\n<option>${d}</option>`;u&&(h+=`\n\n<sum>${u}</sum>`),m&&(h+=`\n\n<UpdateVariable>${m}</UpdateVariable>`);let g=null;try{const t=getChatMessages(e)?.[0];t?.data&&(g=t.data)}catch{}if(!g)try{g=getChatMessages(-1,{role:'assistant'})?.[0]?.data??Mvu.getMvuData({type:'message',message_id:'latest'})}catch{g={stat_data:{},display_data:{},delta_data:{}}}g&&'object'==typeof g||(g={stat_data:{},display_data:{},delta_data:{}}),g.stat_data||(g.stat_data={}),g.display_data||(g.display_data={}),g.delta_data||(g.delta_data={});let p=g;if(Mvu.parseMessage)try{const e=await Mvu.parseMessage(h,g);e&&(p=e)}catch(e){console.warn('âš ï¸ [regen] MVU è§£æå¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€æ•°æ®:',e)}const v=(0,i.extractAllOptions)(h),y=(0,i.extractLastMaintext)(h)||h;await createChatMessages([{role:'assistant',message:y,data:{...p,__options:v}}],{refresh:'none'});const f=getLastMessageId();return console.log('âœ… [regen] assistant æ¶ˆæ¯å·²åˆ›å»ºï¼ŒID:',f),t.onCreatedMessages?.({userMessageId:e,assistantMessageId:f}),t.onHideGenerating&&t.onHideGenerating(),setTimeout(()=>{t.onRefreshStory?.(v)},300),!0}catch(e){return console.error('âŒ [regen] é‡æ–°ç”Ÿæˆ assistant å¤±è´¥:',e),t.onHideGenerating&&t.onHideGenerating(),t.onError?.(e instanceof Error?e.message:'é‡æ–°ç”Ÿæˆå¤±è´¥'),!1}}async function c(e,t={}){let s=null;try{t.onShowGenerating&&t.onShowGenerating();const n=await async function(){try{await waitGlobalInitialized('Mvu');let e=null,t=null,s=null;try{e=Mvu.getMvuData({type:'message',message_id:0})}catch{}try{t=Mvu.getMvuData({type:'message',message_id:'latest'})}catch{}try{s=Mvu.getMvuData({type:'chat'})}catch{}const n=a().merge({},e??{},t??{},s??{});return console.log('ğŸ“Š ä» MVU(merged) è·å–åŸºç¡€æ•°æ®'),n??{stat_data:{},display_data:{},delta_data:{}}}catch(e){return console.warn('âš ï¸ è·å– MVU æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨ç©ºå¯¹è±¡:',e),{stat_data:{},display_data:{},delta_data:{}}}}();console.log('ğŸ“ [æ­¥éª¤2] å¼€å§‹åˆ›å»º user æ¶ˆæ¯...'),console.log('ğŸ“ [æ­¥éª¤2] ç”¨æˆ·è¾“å…¥:',e),console.log('ğŸ“ [æ­¥éª¤2] MVU æ•°æ®:',n?'å·²è·å–':'æœªè·å–');try{await createChatMessages([{role:'user',message:e,data:n}],{refresh:'none'}),console.log('âœ… [æ­¥éª¤2] user æ¶ˆæ¯å·²åˆ›å»º'),s=getLastMessageId(),console.log('âœ… [æ­¥éª¤2] user æ¶ˆæ¯å·²åˆ›å»ºï¼ŒID:',s);const a=async(n=5)=>{const i=getLastMessageId();if(i===s){const e=getChatMessages(i);if(e&&e.length>0&&'user'===e[0].role)return void(t.onRefreshStoryIfOpen&&(t.onRefreshStoryIfOpen(e[0].message),console.log('âœ… [æ­¥éª¤2] å·²åˆ·æ–°æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯ï¼ŒID:',s)))}n>0?setTimeout(()=>a(n-1),50):t.onRefreshStoryIfOpen&&(t.onRefreshStoryIfOpen(e),console.log('âš ï¸ [æ­¥éª¤2] éªŒè¯æ¶ˆæ¯å¤±è´¥ï¼Œä½†ä»å°è¯•åˆ·æ–°æ˜¾ç¤º'))};setTimeout(()=>a(),50)}catch(e){throw console.error('âŒ [æ­¥éª¤2] createChatMessages è°ƒç”¨å¤±è´¥:',e),new Error(`åˆ›å»º user æ¶ˆæ¯å¤±è´¥: ${e instanceof Error?e.message:String(e)}`)}let r,c=null;if('undefined'!=typeof eventOn&&iframe_events?.STREAM_TOKEN_RECEIVED_FULLY?(c=e=>{const s=(0,i.Wq)(e);s&&0!==s.trim().length?t.onStreamingUpdate&&t.onStreamingUpdate(s):t.onStreamingUpdate&&t.onStreamingUpdate('')},eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY,c),console.log('âœ… [æ­¥éª¤3] å·²æ³¨å†Œæµå¼è¾“å‡ºç›‘å¬å™¨')):console.log('â„¹ï¸ [æ­¥éª¤3] æµå¼äº‹ä»¶ä¸å¯ç”¨ï¼Œé€€åŒ–ä¸ºéæµå¼æ¨¡å¼'),console.log('ğŸš€ [æ­¥éª¤3] å¼€å§‹è°ƒç”¨ generate ç”Ÿæˆå›å¤...'),console.log('ğŸ“ [æ­¥éª¤3] ç”¨æˆ·è¾“å…¥:',e),!o())throw console.error('âŒ [æ­¥éª¤3] generate å‡½æ•°æœªå®šä¹‰'),console.error('âŒ [æ­¥éª¤3] è¯·æ£€æŸ¥ï¼š'),console.error('   1. é…’é¦†åŠ©æ‰‹æ˜¯å¦å·²æ­£ç¡®å®‰è£…'),console.error('   2. æ˜¯å¦åœ¨ iframe ç¯å¢ƒä¸­è¿è¡Œ'),console.error('   3. å…¨å±€ generate å‡½æ•°æ˜¯å¦å¯ç”¨'),new Error('generate å‡½æ•°ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿é…’é¦†åŠ©æ‰‹å·²æ­£ç¡®åŠ è½½');try{console.log('ğŸš€ [æ­¥éª¤3] è°ƒç”¨ generateï¼Œç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥ï¼ˆæç¤ºè¯å·²åœ¨é…’é¦†ç•Œé¢å°è£…ï¼‰...'),console.log('ğŸš€ [æ­¥éª¤3] generate å‡½æ•°ç±»å‹:',typeof generate);const e=generate({should_stream:!0}),t=new Promise((_,e)=>{setTimeout(()=>{e(new Error('generate è°ƒç”¨è¶…æ—¶ï¼ˆ5åˆ†é’Ÿï¼‰'))},3e5)});r=await Promise.race([e,t]),console.log('ğŸ“¨ [æ­¥éª¤3] generate è¿”å›ç»“æœï¼Œé•¿åº¦:',r?.length||0),r&&0!==r.length?console.log('ğŸ“¨ [æ­¥éª¤3] generate è¿”å›ç»“æœé¢„è§ˆ:',r.substring(0,200)+'...'):console.warn('âš ï¸ [æ­¥éª¤3] generate è¿”å›ç©ºç»“æœ')}catch(e){if(console.error('âŒ [æ­¥éª¤3] generate è°ƒç”¨å¤±è´¥:',e),console.error('âŒ [æ­¥éª¤3] é”™è¯¯è¯¦æƒ…:',{error:e,errorType:typeof e,errorMessage:e instanceof Error?e.message:String(e),errorStack:e instanceof Error?e.stack:void 0}),e instanceof Error&&e.message.includes('è¶…æ—¶'))throw new Error('generate è°ƒç”¨è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ– LLM æœåŠ¡çŠ¶æ€');throw new Error(`generate è°ƒç”¨å¤±è´¥: ${e instanceof Error?e.message:String(e)}`)}const l=(0,i.OK)(r);if(!l||!(0,i.Mq)(l))return console.error('âŒ [æ­¥éª¤4] generate è¿”å›çš„æ¶ˆæ¯ä¸ç¬¦åˆè§„èŒƒ'),null!==s&&(await deleteChatMessages([s],{refresh:'none'}),console.log('ğŸ—‘ï¸ å·²åˆ é™¤ä¸åˆè§„çš„ user æ¶ˆæ¯')),t.onHideGenerating&&t.onHideGenerating(),t.onError&&t.onError('ç”Ÿæˆçš„æ¶ˆæ¯ä¸ç¬¦åˆè§„èŒƒ'),!1;const d=(0,i.extractLastMaintext)(l),u=(0,i.l$)(l),m=(0,i.$R)(l),h=(0,i.Xo)(l);if(!d||!u)return console.error('âŒ [æ­¥éª¤5] æ— æ³•æå– maintext æˆ– option'),null!==s&&(await deleteChatMessages([s],{refresh:'none'}),console.log('ğŸ—‘ï¸ å·²åˆ é™¤ä¸åˆè§„çš„ user æ¶ˆæ¯')),t.onHideGenerating&&t.onHideGenerating(),t.onError&&t.onError('æ— æ³•æå– maintext æˆ– option'),!1;let g,p=`<maintext>${d}</maintext>\n\n<option>${u}</option>`;if(m&&(p+=`\n\n<sum>${m}</sum>`,console.log('ğŸ“ [æ­¥éª¤5] æå–åˆ° <sum> æ ‡ç­¾')),h&&(p+=`\n\n<UpdateVariable>${h}</UpdateVariable>`,console.log('ğŸ“ [æ­¥éª¤5] æå–åˆ° <UpdateVariable> æ ‡ç­¾')),console.log('ğŸ“Š [æ­¥éª¤6] å¼€å§‹è·å–åŸºç¡€ MVU æ•°æ®...'),null!==s){const e=getChatMessages(s)?.[0];e?.data&&(g=e.data,console.log('âœ… [æ­¥éª¤6] ä»åˆšåˆ›å»ºçš„ user æ¶ˆæ¯è¯»å–åŸºç¡€æ•°æ®'))}g||(console.log('ğŸ“Š [æ­¥éª¤6] å°è¯•ä»æœ€æ–°çš„ assistant æ¶ˆæ¯æˆ– MVU è¯»å–...'),g=getChatMessages(-1,{role:'assistant'})?.[0]?.data??Mvu.getMvuData({type:'message',message_id:'latest'}),console.log('âœ… [æ­¥éª¤6] ä»æœ€æ–°çš„ assistant æ¶ˆæ¯æˆ– MVU è¯»å–åŸºç¡€æ•°æ®')),g&&'object'==typeof g||(console.log('âš ï¸ [æ­¥éª¤6] base æ•°æ®æ— æ•ˆï¼Œä½¿ç”¨ç©ºå¯¹è±¡'),g={stat_data:{},display_data:{},delta_data:{}}),g.stat_data||(g.stat_data={}),g.display_data||(g.display_data={}),g.delta_data||(g.delta_data={}),console.log('ğŸ” [æ­¥éª¤7] å¼€å§‹è§£ææ¶ˆæ¯ä¸­çš„ MVU å‘½ä»¤...');let v=g;if(Mvu.parseMessage)try{const e=await Mvu.parseMessage(p,g);e?(v=e,console.log('âœ… [æ­¥éª¤7] MVU è§£ææˆåŠŸ')):console.log('â„¹ï¸ [æ­¥éª¤7] MVU è§£æè¿”å› undefinedï¼Œä½¿ç”¨åŸºç¡€æ•°æ®')}catch(e){console.warn('âš ï¸ [æ­¥éª¤7] MVU è§£æå¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€æ•°æ®:',e)}else console.log('â„¹ï¸ [æ­¥éª¤7] MVU.parseMessage ä¸å¯ç”¨ï¼Œè·³è¿‡è§£æ');console.log('ğŸ“ [æ­¥éª¤8] å¼€å§‹æå–é€‰é¡¹...');const y=(0,i.extractAllOptions)(p);console.log('ğŸ“ [æ­¥éª¤8] å·²æå–é€‰é¡¹:',y.length,'ä¸ª'),console.log('ğŸ“ [æ­¥éª¤9] å¼€å§‹åˆ›å»º assistant æ¶ˆæ¯...');const f=(0,i.extractLastMaintext)(p),b=f||p;f?console.log('ğŸ“ [æ­¥éª¤9] å·²æå– maintext å†…å®¹ï¼Œåªä¿å­˜ maintext éƒ¨åˆ†'):console.warn('âš ï¸ [æ­¥éª¤9] æ— æ³•ä» finalMessage ä¸­æå– maintextï¼Œä½¿ç”¨å®Œæ•´çš„ finalMessage'),await createChatMessages([{role:'assistant',message:b,data:{...v,__options:y}}],{refresh:'none'}),console.log('âœ… [æ­¥éª¤9] assistant æ¶ˆæ¯å·²åˆ›å»ºï¼Œé…’é¦†ç•Œé¢å†å²å·²åˆ·æ–°');const M=getLastMessageId();if(console.log('ğŸ†” [æ­¥éª¤10] è·å–æ–°åˆ›å»ºçš„æ¶ˆæ¯ ID:',M),t.onCreatedMessages&&null!==s)try{t.onCreatedMessages({userMessageId:s,assistantMessageId:M})}catch(e){console.warn('âš ï¸ onCreatedMessages å›è°ƒæ‰§è¡Œå¤±è´¥ï¼ˆå¿½ç•¥ï¼‰:',e)}return t.onHideGenerating&&t.onHideGenerating(),setTimeout(()=>{t.onRefreshStory&&(t.onRefreshStory(y),console.log('âœ… [æ­¥éª¤11] å·²åˆ·æ–°æ¸¸æˆæ˜¾ç¤ºï¼ˆå·²ä¼ é€’é€‰é¡¹ï¼‰'))},300),!0}catch(e){if(console.error('âŒ ç”Ÿæˆæ¶ˆæ¯å¤±è´¥:',e),null!==s)try{await deleteChatMessages([s],{refresh:'none'}),console.log('ğŸ—‘ï¸ å·²åˆ é™¤å¤±è´¥çš„ user æ¶ˆæ¯')}catch(e){console.error('âŒ åˆ é™¤ user æ¶ˆæ¯å¤±è´¥:',e)}return t.onHideGenerating&&t.onHideGenerating(),t.onError&&t.onError(e instanceof Error?e.message:'ç”Ÿæˆæ¶ˆæ¯å¤±è´¥'),!1}}},224(e){e.exports=_},685(e,t,s){function n(e){if(!e)return'';let t=e,s='';for(;t!==s;)s=t,t=t.replace(/<thinking>[\s\S]*?<\/thinking>/gi,'');return t}function a(e){if(!e)return'';let t=e.replace(/<thinking>[\s\S]*?<\/thinking>/gi,'');const s=t.lastIndexOf('<thinking>');return-1!==s&&(t=t.substring(0,s).trim()),t}function i(e){const t=e.match(/<maintext>([\s\S]*?)<\/maintext>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<maintext>([\s\S]*?)<\/maintext>/i);return s?s[1].trim():''}function o(e){const t=e.match(/<continue_choice>([\s\S]*?)<\/continue_choice>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<continue_choice>([\s\S]*?)<\/continue_choice>/i);return s?s[1].trim():''}function r(e){const t=e.match(/<result>([\s\S]*?)<\/result>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<result>([\s\S]*?)<\/result>/i);return s?s[1].trim():''}function c(e){const t=e.match(/<decision_node>([\s\S]*?)<\/decision_node>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<decision_node>([\s\S]*?)<\/decision_node>/i);return s?s[1].trim():''}function l(e){const t=e.match(/<option>([\s\S]*?)<\/option>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<option>([\s\S]*?)<\/option>/i);return s?s[1].trim():''}function d(e){if(!e)return[];const t=e.match(/<suboption>([\s\S]*?)<\/suboption>/gi);if(t&&t.length>0){const e=[];if(t.forEach(t=>{const s=t.match(/<suboption>([\s\S]*?)<\/suboption>/i);if(s&&s[1]){const t=s[1].trim();t&&e.push(t)}}),e.length>0)return e}const s=e.match(/<option>([\s\S]*?)<\/option>/gi);if(!s||0===s.length)return[];const n=[];return s.forEach(e=>{const t=e.match(/<option>([\s\S]*?)<\/option>/i);if(t&&t[1]){const e=t[1].trim();if(e){const t=e.split('\n').map(e=>e.trim()).filter(e=>e);t.length>1?n.push(...t):n.push(e)}}}),n}function u(e){const t=e.match(/<sum>([\s\S]*?)<\/sum>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<sum>([\s\S]*?)<\/sum>/i);return s?s[1].trim():''}function m(e){const t=e.match(/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/gi);if(!t||0===t.length)return'';const s=t[t.length-1].match(/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/i);if(!s)return'';const n=s[1].trim();return console.log('ğŸ“ æå–åˆ° <UpdateVariable> åŸå§‹å†…å®¹ï¼Œç›´æ¥ä¿ç•™ï¼Œä¸è¿›è¡Œè½¬æ¢'),n}function h(e){if(!e||'string'!=typeof e)return!1;const t=n(e),s=i(t),a=l(t);return!(!s||!a)||(console.warn('âš ï¸ æ¶ˆæ¯ç¼ºå°‘ <maintext> æˆ– <option> æ ‡ç­¾'),!1)}s.d(t,{$R:()=>u,Mq:()=>h,OK:()=>n,Wq:()=>a,Xo:()=>m,extractAllOptions:()=>d,extractContinueChoice:()=>o,extractLastMaintext:()=>i,extractNextChoice:()=>c,extractResult:()=>r,l$:()=>l})}},s={};function n(e){var a=s[e];if(void 0!==a)return a.exports;var i=s[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=n(224),i=n.n(a);function o(){try{const e=getLastMessageId();if(e<0)return!1;const t=getChatMessages(`0-${e}`,{role:'assistant'});return t&&t.length>1}catch(e){return console.warn('æ£€æŸ¥å­˜æ¡£çŠ¶æ€å¤±è´¥:',e),!1}}class r{element=null;callbacks;constructor(e){this.callbacks=e}createElement(){const e=document.createElement('div');return e.className='screen splash-screen',e.id='splash-screen',e.innerHTML=this.getHTML(),this.element=e,this.bindEvents(),this.updateContinueButton(),e}show(){this.element&&(this.element.classList.add('active'),this.updateContinueButton())}hide(){this.element&&this.element.classList.remove('active')}destroy(){this.element&&($(this.element).off(),$(this.element).remove(),this.element=null),this.keyDownHandler&&(document.removeEventListener('keydown',this.keyDownHandler),this.keyDownHandler=null)}updateContinueButton(){if(!this.element)return;const e=this.element.querySelector('#continue-button');e&&(o()?e.style.display='flex':e.style.display='none')}keyDownHandler=null;bindEvents(){if(!this.element)return;const e=this.element.querySelector('#new-game-button');e&&e.addEventListener('click',()=>{this.callbacks.onNewGame?.()});const t=this.element.querySelector('#continue-button');t&&t.addEventListener('click',()=>{this.callbacks.onContinue?.()});const s=this.element.querySelector('#fullscreen-button');s&&s.addEventListener('click',()=>{this.requestFullscreen()}),this.keyDownHandler=e=>{'Enter'===e.key&&this.element?.classList.contains('active')&&(e.preventDefault(),this.requestFullscreen())},document.addEventListener('keydown',this.keyDownHandler)}requestFullscreen(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen().catch(e=>{console.warn('å…¨å±è¯·æ±‚å¤±è´¥:',e)}):e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}getHTML(){return'\n      <div class="splash-screen-content">\n        <div class="splash-header">\n          <div class="splash-logo">\n            <i class="fas fa-anchor"></i>\n          </div>\n          <h1 class="splash-title">é”š</h1>\n          <p class="splash-subtitle">ANCHOR</p>\n        </div>\n        <div class="splash-actions">\n          <button type="button" class="splash-button primary" id="new-game-button">\n            <i class="fas fa-play"></i>\n            <span>å¼€å§‹æ–°æ¸¸æˆ</span>\n          </button>\n          <button type="button" class="splash-button secondary" id="continue-button" style="display: none;">\n            <i class="fas fa-redo"></i>\n            <span>ç»§ç»­æ¸¸æˆ</span>\n          </button>\n          <button type="button" class="splash-button icon-only" id="fullscreen-button" title="åˆ‡æ¢å…¨å± (Enter)">\n            <i class="fas fa-expand"></i>\n          </button>\n        </div>\n        <div class="splash-footer">\n          <p class="splash-copyright">Â© 2024 é”š</p>\n          <p class="splash-author">åŸºäºé…’é¦†åŠ©æ‰‹å¼€å‘</p>\n          <p class="splash-hint" style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--text-tertiary);">æŒ‰ Enter é”®å…¨å±</p>\n        </div>\n      </div>\n    '}}class c{element=null;callbacks;constructor(e){this.callbacks=e}createElement(){const e=document.createElement('div');return e.className='screen setup-screen',e.id='setup-screen',e.innerHTML=this.getHTML(),this.element=e,this.bindEvents(),e}show(){this.element&&this.element.classList.add('active')}hide(){this.element&&this.element.classList.remove('active')}destroy(){this.element&&($(this.element).off(),$(this.element).remove(),this.element=null)}bindEvents(){if(!this.element)return;const e=this.element.querySelector('#energy-reserve');e&&e.addEventListener('input',async()=>{const e=this.getConfig();void 0!==e.reserve&&await this.updateMvuVariable(e.reserve)});const t=this.element.querySelector('#setup-confirm-button');t&&t.addEventListener('click',()=>{const e=this.element?.querySelector('#energy-reserve'),t=e?.value?.trim()||'';if(!t)return void toastr.error('è¯·è¾“å…¥ç³»ç»Ÿå‰©ä½™èƒ½æº','éªŒè¯å¤±è´¥');if(t.includes('.'))return void toastr.error('ç³»ç»Ÿå‰©ä½™èƒ½æºå¿…é¡»æ˜¯æ•´æ•°','éªŒè¯å¤±è´¥');const s=parseInt(t,10);if(isNaN(s))return void toastr.error('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—','éªŒè¯å¤±è´¥');if(!Number.isInteger(s))return void toastr.error('ç³»ç»Ÿå‰©ä½™èƒ½æºå¿…é¡»æ˜¯æ•´æ•°','éªŒè¯å¤±è´¥');if(s<0||s>1e5)return void toastr.error('ç³»ç»Ÿå‰©ä½™èƒ½æºå¿…é¡»åœ¨ 0-100000 ä¹‹é—´','éªŒè¯å¤±è´¥');const n={reserve:s};this.callbacks.onConfirm?.(n)});const s=this.element.querySelector('#setup-cancel-button');s&&s.addEventListener('click',()=>{this.callbacks.onCancel?.()})}async updateMvuVariable(e){try{if('undefined'!=typeof waitGlobalInitialized&&await waitGlobalInitialized('Mvu'),'undefined'==typeof Mvu||!Mvu.getMvuData||!Mvu.replaceMvuData)return void console.warn('âš ï¸ MVU ä¸å¯ç”¨ï¼Œè·³è¿‡å®æ—¶æ›´æ–°');let t=null,s=null,n=null;try{t=Mvu.getMvuData({type:'message',message_id:0})}catch{}try{s=Mvu.getMvuData({type:'message',message_id:'latest'})}catch{}n=Mvu.getMvuData({type:'chat'});const a=i().merge({},t??{},s??{},n??{}),o={...a?.stat_data||{}};o.system_state||(o.system_state={}),o.system_state.antimatter||(o.system_state.antimatter={}),o.system_state.antimatter.reserve=Math.max(0,Math.min(1e5,e));const r={...a,stat_data:o};await Mvu.replaceMvuData(r,{type:'chat'}),console.info(`âœ… å®æ—¶æ›´æ–° MVU å˜é‡ reserve: ${e}`)}catch(e){console.warn('âš ï¸ å®æ—¶æ›´æ–° MVU å˜é‡ reserve å¤±è´¥:',e)}}getConfig(){if(!this.element)return{};const e=this.element.querySelector('#energy-reserve');return{reserve:e?.value?parseInt(e.value,10):void 0}}getHTML(){return'\n      <div class="setup-screen-content">\n        <div class="setup-header">\n          <h1 class="setup-title">æ–°æ¸¸æˆè®¾ç½®</h1>\n          <p class="setup-subtitle">é…ç½®æ‚¨çš„æ¸¸æˆ</p>\n        </div>\n        <div class="setup-form">\n          <div class="setup-form-group">\n            <label class="setup-label" for="energy-reserve">ç³»ç»Ÿå‰©ä½™èƒ½æº</label>\n            <input\n              type="number"\n              id="energy-reserve"\n              class="setup-input"\n              min="0"\n              max="100000"\n              step="1"\n              placeholder="è¾“å…¥ç³»ç»Ÿå‰©ä½™èƒ½æº"\n              required\n            />\n            <small style="color: var(--text-secondary); font-size: 0.7rem; margin-top: 0.25rem;">\n              èŒƒå›´ï¼š0 - 100000ï¼ˆæ•´æ•°ï¼‰\n            </small>\n          </div>\n        </div>\n        <div class="setup-actions">\n          <button type="button" class="setup-button secondary" id="setup-cancel-button">\n            <i class="fas fa-times"></i>\n            <span>å–æ¶ˆ</span>\n          </button>\n          <button type="button" class="setup-button primary" id="setup-confirm-button">\n            <i class="fas fa-check"></i>\n            <span>ç¡®è®¤</span>\n          </button>\n        </div>\n      </div>\n    '}}class l{element=null;callbacks;gameData={};loadedMessageIds=new Set;keyDownHandler=null;mvuUpdateListener=null;statusRetryCount=0;statusRetryTimer=null;constructor(e){this.callbacks=e}createElement(){try{const e=document.createElement('div');return e.className='screen main-screen',e.id='main-screen',e.innerHTML=this.getHTML(),this.element=e,this.bindEvents(),this.refreshData(),console.log('âœ… Dashboard å…ƒç´ å·²åˆ›å»º'),e}catch(e){console.error('âŒ åˆ›å»º Dashboard å…ƒç´ å¤±è´¥:',e);const t=document.createElement('div');return t.className='screen main-screen',t.id='main-screen',t.innerHTML='<div style="padding: 2rem; color: var(--text-primary);">é”šåŠ è½½ä¸­...</div>',this.element=t,t}}show(){if(this.element){this.element.classList.add('active');try{this.refreshData(),console.log('âœ… Dashboard æ•°æ®å·²åˆ·æ–°')}catch(e){console.error('âŒ Dashboard åˆ·æ–°æ•°æ®å¤±è´¥:',e)}}else console.error('âŒ Dashboard element ä¸º nullï¼Œæ— æ³•æ˜¾ç¤º')}hide(){this.element&&this.element.classList.remove('active')}destroy(){this.element&&($(this.element).off(),$(this.element).remove(),this.element=null),this.keyDownHandler&&(document.removeEventListener('keydown',this.keyDownHandler),this.keyDownHandler=null),this.mvuUpdateListener&&(this.mvuUpdateListener.stop(),this.mvuUpdateListener=null),null!==this.statusRetryTimer&&(window.clearTimeout(this.statusRetryTimer),this.statusRetryTimer=null)}updateGameData(e){this.gameData={...this.gameData,...e},this.refreshData()}refreshData(){if(this.element)try{this.updateStatusCards().catch(e=>{console.warn('âš ï¸ æ›´æ–°çŠ¶æ€å¡ç‰‡å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:',e)}),this.updateTasksList(),this.updateDiaryList(),setTimeout(()=>{try{this.loadMaintextFromChat()}catch(e){console.warn('âš ï¸ åŠ è½½ maintext å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:',e)}},100),console.info('âœ… æ¸¸æˆæ•°æ®å·²åˆ·æ–°')}catch(e){console.error('âŒ åˆ·æ–°æ•°æ®æ—¶å‡ºé”™:',e)}else console.warn('âš ï¸ Dashboard element ä¸º nullï¼Œæ— æ³•åˆ·æ–°æ•°æ®')}async updateStatusCards(){if(!this.element)return;const t=this.element.querySelector('#status-grid');if(t)try{await waitGlobalInitialized('Mvu'),await e(()=>i().has(getVariables({type:'message'}),'stat_data'),{timeout:3e3,intervalBetweenAttempts:100}).catch(()=>{});const s=Mvu.getMvuData({type:'chat'}),n=i().get(s,'stat_data.system_state');let a=null,o=null;try{const e=Mvu.getMvuData({type:'message',message_id:'latest'});a=i().get(e,'stat_data.system_state')}catch(e){console.warn('âš ï¸ è¯»å– latest message çš„ system_state å¤±è´¥:',e)}try{const e=Mvu.getMvuData({type:'message',message_id:0});o=i().get(e,'stat_data.system_state')}catch(e){}const r=i().merge({},o||{},a||{},n||{});if(!(r&&(void 0!==r.cycle||void 0!==r.system_pressure||void 0!==r.instability||!!r.population||!!r.antimatter)))return t.innerHTML='<div class="status-empty">ç³»ç»ŸçŠ¶æ€åŠ è½½ä¸­â€¦</div>',void(this.statusRetryCount<10&&(this.statusRetryCount+=1,null!==this.statusRetryTimer&&window.clearTimeout(this.statusRetryTimer),this.statusRetryTimer=window.setTimeout(()=>{this.updateStatusCards().catch(()=>{})},250)));this.statusRetryCount=0,null!==this.statusRetryTimer&&(window.clearTimeout(this.statusRetryTimer),this.statusRetryTimer=null);const c=[];if(void 0!==r.cycle&&c.push(`\n          <div class="status-card">\n            <div class="status-card-header">\n              <i class="fas fa-clock status-card-icon"></i>\n              <span class="status-card-title">æ—¶é—´å‘¨æœŸ</span>\n            </div>\n            <div class="status-card-content">\n              <div class="status-value">\n                <span class="value-number">${r.cycle}</span>\n              </div>\n            </div>\n          </div>\n        `),r.antimatter){const e=r.antimatter.reserve??0,t=r.antimatter.leak_risk??0,s=Math.round(e/1e5*100),n=t<.3?'low':t<.7?'medium':'high';c.push(`\n          <div class="status-card">\n            <div class="status-card-header">\n              <i class="fas fa-atom status-card-icon"></i>\n              <span class="status-card-title">åç‰©è´¨å‚¨å¤‡</span>\n            </div>\n            <div class="status-card-content">\n              <div class="status-value">\n                <span class="value-number">${e.toLocaleString()}</span>\n                <div class="status-bar">\n                  <div class="status-bar-fill" style="width: ${s}%"></div>\n                </div>\n                <div class="status-detail" style="font-size: 0.65rem; margin-top: 0.3rem; color: var(--text-tertiary);">\n                  æ³„æ¼é£é™©: <span class="risk-${n}">${(100*t).toFixed(1)}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        `)}if(r.population){const e=r.population,t=e.active??0,s=e.standby??0,n=e.archived??0,a=t+s+n;c.push(`\n          <div class="status-card">\n            <div class="status-card-header">\n              <i class="fas fa-users status-card-icon"></i>\n              <span class="status-card-title">äººå£ç»Ÿè®¡</span>\n            </div>\n            <div class="status-card-content">\n              <div class="status-value">\n                <span class="value-number">${a}</span>\n                <div class="status-detail" style="font-size: 0.65rem; margin-top: 0.3rem; color: var(--text-tertiary);">\n                  å¯ç”¨: ${t} | å¾…æœº: ${s} | å½’æ¡£: ${n}\n                </div>\n              </div>\n            </div>\n          </div>\n        `)}if(void 0!==r.system_pressure){const e=r.system_pressure??0,t=Math.round(100*e),s=e<.5?'low':e<.8?'medium':'high';c.push(`\n          <div class="status-card">\n            <div class="status-card-header">\n              <i class="fas fa-tachometer-alt status-card-icon"></i>\n              <span class="status-card-title">ç³»ç»Ÿå‹åŠ›</span>\n            </div>\n            <div class="status-card-content">\n              <div class="status-value">\n                <span class="value-number">${t}%</span>\n                <div class="status-bar">\n                  <div class="status-bar-fill status-${s}" style="width: ${t}%"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        `)}if(void 0!==r.instability){const e=r.instability??0,t=Math.round(100*e),s=e<.3?'low':e<.7?'medium':'high';c.push(`\n          <div class="status-card">\n            <div class="status-card-header">\n              <i class="fas fa-exclamation-triangle status-card-icon"></i>\n              <span class="status-card-title">ç³»ç»Ÿä¸ç¨³å®šæ€§</span>\n            </div>\n            <div class="status-card-content">\n              <div class="status-value">\n                <span class="value-number">${t}%</span>\n                <div class="status-bar">\n                  <div class="status-bar-fill status-${s}" style="width: ${t}%"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        `)}c.length>0?t.innerHTML=c.join(''):t.innerHTML='<div class="status-empty">æš‚æ— ç³»ç»ŸçŠ¶æ€æ•°æ®</div>'}catch(e){console.error('âŒ æ›´æ–°çŠ¶æ€å¡ç‰‡å¤±è´¥:',e),t.innerHTML='<div class="status-empty">åŠ è½½ç³»ç»ŸçŠ¶æ€å¤±è´¥</div>'}}updateTasksList(){if(!this.element)return;const e=this.element.querySelector('#tasks-list');if(!e)return;const t=this.gameData.tasks&&Array.isArray(this.gameData.tasks)&&this.gameData.tasks.length>0?this.gameData.tasks:this.getDefaultTasks();e.innerHTML=t.map(e=>`\n      <div class="entry-item">\n        <div class="entry-icon">\n          <i class="fas ${this.getTaskIcon(e.status)}"></i>\n        </div>\n        <div class="entry-content">\n          <div class="entry-header">\n            <span class="entry-title">${this.escapeHtml(e.title)}</span>\n            <span class="entry-status ${e.status}">${this.getStatusText(e.status)}</span>\n          </div>\n          <div class="entry-meta">\n            <span class="entry-time">${e.time}</span>\n            <span class="entry-priority priority-${e.priority}">${this.getPriorityText(e.priority)}</span>\n          </div>\n          <div class="entry-description">${this.escapeHtml(e.description)}</div>\n        </div>\n      </div>\n    `).join('')}updateDiaryList(){if(!this.element)return;const e=this.element.querySelector('#diary-list');if(!e)return;const t=this.gameData.diary&&Array.isArray(this.gameData.diary)&&this.gameData.diary.length>0?this.gameData.diary:this.getDefaultDiary();e.innerHTML=t.map(e=>`\n      <div class="entry-item">\n        <div class="entry-icon">\n          <i class="fas fa-book-open"></i>\n        </div>\n        <div class="entry-content">\n          <div class="entry-header">\n            <span class="entry-title">${this.escapeHtml(e.title)}</span>\n            <span class="entry-date">${e.date}</span>\n          </div>\n          <div class="entry-description">${this.escapeHtml(e.description)}</div>\n        </div>\n      </div>\n    `).join('')}updateChatMessages(){}getDefaultTasks(){return[{id:'1',title:'ç»´æŠ¤èƒ½æºç³»ç»Ÿ',status:'completed',priority:'high',time:'01-15 14:30',description:'æ£€æŸ¥å¹¶ç»´æŠ¤ç©ºé—´ç«™èƒ½æºç³»ç»Ÿï¼Œç¡®ä¿æ‰€æœ‰è®¾å¤‡æ­£å¸¸è¿è¡Œ'},{id:'2',title:'ç‰©èµ„è¡¥ç»™ä»»åŠ¡',status:'in-progress',priority:'medium',time:'01-15 10:00',description:'æ¥æ”¶å¹¶åˆ†é…æ–°ä¸€æ‰¹ç‰©èµ„è¡¥ç»™ï¼Œæ›´æ–°åº“å­˜è®°å½•'},{id:'3',title:'ç´§æ€¥ç»´ä¿®ä»»åŠ¡',status:'pending',priority:'urgent',time:'01-15 16:00',description:'æ£€æµ‹åˆ°ç”Ÿå‘½ç»´æŒç³»ç»Ÿå¼‚å¸¸ï¼Œéœ€è¦ç«‹å³è¿›è¡Œç»´ä¿®æ£€æŸ¥'},{id:'4',title:'å®éªŒæ•°æ®åˆ†æ',status:'in-progress',priority:'medium',time:'01-15 09:00',description:'åˆ†ææœ€æ–°å®éªŒæ•°æ®ï¼Œç”ŸæˆæŠ¥å‘Šå¹¶ä¸Šä¼ è‡³ç³»ç»Ÿ'},{id:'5',title:'é€šä¿¡ç³»ç»Ÿæ ¡å‡†',status:'pending',priority:'low',time:'01-16 08:00',description:'å®šæœŸæ ¡å‡†é€šä¿¡ç³»ç»Ÿï¼Œç¡®ä¿ä¸åœ°çƒæ€»éƒ¨çš„ç¨³å®šè¿æ¥'},{id:'6',title:'é˜²æŠ¤ç³»ç»Ÿæ£€æŸ¥',status:'pending',priority:'high',time:'01-16 10:00',description:'æ£€æŸ¥ç©ºé—´ç«™é˜²æŠ¤ç³»ç»Ÿï¼ŒåŒ…æ‹¬è¾å°„é˜²æŠ¤å’Œå¾®é™¨çŸ³é˜²æŠ¤'},{id:'7',title:'ç³»ç»Ÿå¤‡ä»½',status:'completed',priority:'medium',time:'01-15 03:00',description:'å®Œæˆæ¯æ—¥ç³»ç»Ÿæ•°æ®å¤‡ä»½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨'},{id:'8',title:'äººå‘˜è½®æ¢',status:'in-progress',priority:'medium',time:'01-15 12:00',description:'æ‰§è¡Œäººå‘˜è½®æ¢è®¡åˆ’ï¼Œç¡®ä¿å„å²—ä½æ­£å¸¸è¿è½¬'}]}getDefaultDiary(){return[{id:'1',title:'æ—¥å¸¸è®°å½•',date:'01-15',description:'ç©ºé—´ç«™è¿è¡Œæ­£å¸¸ï¼Œæ‰€æœ‰ç³»ç»ŸæŒ‡æ ‡åœ¨å®‰å…¨èŒƒå›´å†…ã€‚å®Œæˆèƒ½æºç³»ç»Ÿä¾‹è¡Œæ£€æŸ¥ï¼Œæœªå‘ç°å¼‚å¸¸ã€‚'},{id:'2',title:'ç‰©èµ„è¡¥ç»™',date:'01-14',description:'æ¥æ”¶æ–°ä¸€æ‰¹ç‰©èµ„è¡¥ç»™ï¼ŒåŒ…æ‹¬é£Ÿç‰©ã€åŒ»ç–—ç”¨å“å’Œå·¥ç¨‹ææ–™ã€‚å·²æŒ‰æ ‡å‡†æµç¨‹æ¸…ç‚¹å’Œåˆ†é…ã€‚'},{id:'3',title:'ç³»ç»Ÿç»´æŠ¤',date:'01-13',description:'è¿›è¡Œæœˆåº¦ç³»ç»Ÿç»´æŠ¤ï¼Œæ›´æ–°éƒ¨åˆ†è€åŒ–è®¾å¤‡ã€‚ç»´æŠ¤è¿‡ç¨‹æœªå‘ç°é‡å¤§é—®é¢˜ï¼Œè¿è¡Œç¨³å®šã€‚'},{id:'4',title:'å®éªŒæŠ¥å‘Š',date:'01-12',description:'å®Œæˆç¬¬47æ¬¡é›¶é‡åŠ›å®éªŒï¼Œæ•°æ®é‡‡é›†æ­£å¸¸ã€‚åˆæ­¥åˆ†ææ˜¾ç¤ºå®éªŒç»“æœç¬¦åˆé¢„æœŸã€‚'},{id:'5',title:'é€šä¿¡æ—¥å¿—',date:'01-11',description:'ä¸åœ°çƒæ€»éƒ¨å»ºç«‹ç¨³å®šè¿æ¥ï¼Œå»¶è¿Ÿ12msã€‚æ¥æ”¶æœ€æ–°æŒ‡ä»¤ï¼Œå‡†å¤‡æ‰§è¡Œä¸‹ä¸€é˜¶æ®µä»»åŠ¡ã€‚'},{id:'6',title:'å®‰å…¨æ£€æŸ¥',date:'01-10',description:'å®Œæˆæ¯å‘¨å®‰å…¨æ£€æŸ¥ï¼Œæ‰€æœ‰é˜²æŠ¤ç³»ç»Ÿè¿è¡Œæ­£å¸¸ã€‚è¾å°„æ°´å¹³åœ¨å®‰å…¨èŒƒå›´å†…ã€‚'},{id:'7',title:'äººå‘˜æ—¥å¿—',date:'01-09',description:'æ‰§è¡Œäººå‘˜å¥åº·æ£€æŸ¥ï¼Œæ‰€æœ‰æˆå‘˜èº«ä½“çŠ¶å†µè‰¯å¥½ã€‚å®Œæˆå¿ƒç†è¯„ä¼°ï¼ŒçŠ¶æ€æ­£å¸¸ã€‚'},{id:'8',title:'ç³»ç»Ÿæ›´æ–°',date:'01-08',description:'å®‰è£…ç³»ç»Ÿè¡¥ä¸v2.3.1ï¼Œä¿®å¤å·²çŸ¥æ¼æ´ã€‚é‡å¯åç³»ç»Ÿè¿è¡Œç¨³å®šï¼Œæ€§èƒ½æå‡5%ã€‚'}]}getDefaultMessages(){return[{id:'1',role:'user',content:'ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹ç©ºé—´ç«™çš„å½“å‰çŠ¶æ€ã€‚',time:'14:32'},{id:'2',role:'assistant',content:'æ‚¨å¥½ï¼ç©ºé—´ç«™å½“å‰è¿è¡ŒçŠ¶æ€è‰¯å¥½ã€‚èƒ½æºç³»ç»Ÿï¼š87%ï¼Œç”Ÿå‘½ç»´æŒç³»ç»Ÿï¼š92%ï¼Œç³»ç»Ÿå®Œæ•´æ€§ï¼š78%ã€‚æ‰€æœ‰å…³é”®æŒ‡æ ‡å‡åœ¨å®‰å…¨èŒƒå›´å†…ã€‚éœ€è¦æˆ‘è¯¦ç»†è¯´æ˜æŸä¸ªç³»ç»Ÿçš„çŠ¶æ€å—ï¼Ÿ',time:'14:32'},{id:'3',role:'user',content:'èƒ½æºç³»ç»Ÿçš„è¯¦ç»†æƒ…å†µå¦‚ä½•ï¼Ÿ',time:'14:33'},{id:'4',role:'assistant',content:'èƒ½æºç³»ç»Ÿå½“å‰è¿è¡Œåœ¨87%çš„å®¹é‡æ°´å¹³ã€‚ä¸»è¦èƒ½æºæ¥æºåŒ…æ‹¬å¤ªé˜³èƒ½ç”µæ± æ¿å’Œå¤‡ç”¨æ ¸èƒ½å‘ç”µæœºã€‚æœ€è¿‘ä¸€æ¬¡æ£€æŸ¥æ˜¾ç¤ºæ‰€æœ‰ç»„ä»¶è¿è¡Œæ­£å¸¸ï¼Œé¢„è®¡å¯ä»¥ç»´æŒå½“å‰è´Ÿè½½è‡³å°‘30å¤©ã€‚å»ºè®®åœ¨ä¸‹å‘¨è¿›è¡Œä¾‹è¡Œç»´æŠ¤æ£€æŸ¥ã€‚',time:'14:33'}]}getTaskIcon(e){switch(e){case'completed':return'fa-check-circle';case'in-progress':return'fa-clock';case'pending':return'fa-exclamation-circle';default:return'fa-circle'}}getStatusText(e){switch(e){case'completed':return'å®Œæˆ';case'in-progress':return'è¿›è¡Œä¸­';case'pending':return'å¾…å¤„ç†';default:return e}}getPriorityText(e){switch(e){case'urgent':return'ç´§æ€¥';case'high':return'é«˜';case'medium':return'ä¸­';case'low':return'ä½';default:return e}}escapeHtml(e){const t=document.createElement('div');return t.textContent=e,t.innerHTML}parseMaintext(e){const t=e.match(/<maintext>([\s\S]*?)<\/maintext>/i);return t?t[1].trim():''}loadMaintextFromChat(){if(this.element)try{if('undefined'==typeof getChatMessages)return void console.warn('âš ï¸ getChatMessages ä¸å¯ç”¨');let e=[];try{e=getChatMessages(-1,{role:'assistant'})}catch(e){console.warn('âš ï¸ è·å– assistant æ¶ˆæ¯å¤±è´¥:',e)}let t=e.length>0?e[e.length-1]:null;if(!t)try{e=getChatMessages(-1),t=e.length>0?e[e.length-1]:null}catch(e){console.warn('âš ï¸ è·å–æœ€æ–°æ¶ˆæ¯å¤±è´¥:',e)}if(!t)return;if(this.loadedMessageIds.has(t.message_id))return;const s=t.message||'';Promise.resolve().then(n.bind(n,685)).then(({extractContinueChoice:e,extractResult:n,extractNextChoice:a})=>{const i=this.element;if(!i)return;const o=e(s),r=n(s),c=a(s),l=i.querySelector('#maintext-continue-choice'),d=i.querySelector('#maintext-result'),u=i.querySelector('#maintext-next-choice');if(o||r||c)l&&(l.textContent=o||''),d&&(d.textContent=r||''),u&&(u.textContent=c||'');else{const e=this.parseMaintext(s);u&&e&&(u.textContent=e),l&&(l.textContent=''),d&&(d.textContent='')}this.loadedMessageIds.add(t.message_id),console.info(`âœ… å·²åŠ è½½ maintext (message_id: ${t.message_id})`)}).catch(e=>{console.error('âŒ å¯¼å…¥ textParser å¤±è´¥:',e);const t=this.element;if(!t)return;const n=this.parseMaintext(s),a=t.querySelector('#maintext-next-choice');a&&n&&(a.textContent=n)})}catch(e){console.error('âŒ åŠ è½½èŠå¤©æ¶ˆæ¯å¤±è´¥:',e)}}setupMessageListener(){try{if('undefined'==typeof eventOn||'undefined'==typeof tavern_events)return void console.warn('âš ï¸ äº‹ä»¶ç›‘å¬ API ä¸å¯ç”¨');const e=()=>{setTimeout(()=>{try{this.loadMaintextFromChat(),this.updateStatusCards().catch(()=>{})}catch(e){console.error('âŒ å¤„ç†æ¶ˆæ¯æ¥æ”¶äº‹ä»¶å¤±è´¥:',e)}},150)};tavern_events.MESSAGE_RECEIVED&&eventOn(tavern_events.MESSAGE_RECEIVED,e),tavern_events.CHAT_CHANGED&&eventOn(tavern_events.CHAT_CHANGED,e),tavern_events.MESSAGE_UPDATED&&eventOn(tavern_events.MESSAGE_UPDATED,e),this.element&&(this.element.addEventListener('refresh-maintext',()=>{setTimeout(()=>{this.loadMaintextFromChat()},100)}),this.element.addEventListener('refresh-status',()=>{setTimeout(()=>{this.updateStatusCards().catch(()=>{})},50)})),console.info('âœ… å·²è®¾ç½®æ¶ˆæ¯ç›‘å¬å™¨')}catch(e){console.error('âŒ è®¾ç½®æ¶ˆæ¯ç›‘å¬å™¨å¤±è´¥:',e)}}bindEvents(){if(this.element)try{const e=this.element.querySelector('#dashboard-fullscreen-button');e?e.addEventListener('click',()=>{this.toggleFullscreen()}):console.warn('âš ï¸ æœªæ‰¾åˆ°å…¨å±æŒ‰é’®å…ƒç´ '),this.setupEnterKeyFullscreen(),setTimeout(()=>{try{'undefined'!=typeof eventOn&&'undefined'!=typeof tavern_events?this.setupMessageListener():console.warn('âš ï¸ äº‹ä»¶ç›‘å¬ API ä¸å¯ç”¨ï¼Œè·³è¿‡æ¶ˆæ¯ç›‘å¬å™¨è®¾ç½®')}catch(e){console.warn('âš ï¸ è®¾ç½®æ¶ˆæ¯ç›‘å¬å™¨å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:',e)}},200),setTimeout(async()=>{try{if(await waitGlobalInitialized('Mvu'),this.mvuUpdateListener)return;if('undefined'==typeof Mvu||!Mvu.events?.VARIABLE_UPDATE_ENDED)return;this.mvuUpdateListener=eventOn(Mvu.events.VARIABLE_UPDATE_ENDED,()=>{null!==this.statusRetryTimer&&window.clearTimeout(this.statusRetryTimer),this.statusRetryTimer=window.setTimeout(()=>{this.updateStatusCards().catch(()=>{})},50)})}catch(e){console.warn('âš ï¸ MVU äº‹ä»¶ç›‘å¬å®‰è£…å¤±è´¥:',e)}},250)}catch(e){console.error('âŒ bindEvents å¤±è´¥:',e)}else console.warn('âš ï¸ Dashboard element ä¸º nullï¼Œæ— æ³•ç»‘å®šäº‹ä»¶')}getHTML(){return'\n      \x3c!-- é¡¶éƒ¨å¯¼èˆªæ  --\x3e\n      <header class="main-header">\n        <div class="header-content">\n          <div class="logo-section">\n            <i class="fas fa-anchor logo-icon"></i>\n            <h1 class="logo-text">é”š</h1>\n          </div>\n          \x3c!-- æ¨¡å—åˆ‡æ¢å¯¼èˆª --\x3e\n          <nav class="top-nav-menu">\n            <button type="button" class="nav-item active" data-module="status" id="nav-status" title="èˆ°ä½“çŠ¶æ€ (1)">\n              <span class="nav-shortcut">1</span>\n              <i class="fas fa-chart-line nav-icon"></i>\n              <span class="nav-text">èˆ°ä½“çŠ¶æ€</span>\n            </button>\n            <button type="button" class="nav-item" data-module="tasks" id="nav-tasks" title="ä»»åŠ¡æ¨¡å— (2)">\n              <span class="nav-shortcut">2</span>\n              <i class="fas fa-tasks nav-icon"></i>\n              <span class="nav-text">ä»»åŠ¡æ¨¡å—</span>\n            </button>\n            <button type="button" class="nav-item" data-module="diary" id="nav-diary" title="æ—¥è®°æ¨¡å— (3)">\n              <span class="nav-shortcut">3</span>\n              <i class="fas fa-book nav-icon"></i>\n              <span class="nav-text">æ—¥è®°æ¨¡å—</span>\n            </button>\n            <button type="button" class="nav-item" data-module="communication" id="nav-communication" title="é€šè®¯æ¨¡å— (4)">\n              <span class="nav-shortcut">4</span>\n              <i class="fas fa-comments nav-icon"></i>\n              <span class="nav-text">é€šè®¯æ¨¡å—</span>\n            </button>\n          </nav>\n          <div class="header-actions">\n            <button type="button" class="fullscreen-button" id="dashboard-fullscreen-button" title="å…¨å± (Enter)">\n              <i class="fas fa-expand"></i>\n            </button>\n            <div class="header-status">\n              <div class="status-indicator online">\n                <span class="status-dot"></span>\n                <span class="status-text">ç³»ç»Ÿåœ¨çº¿</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      \x3c!-- ä¸»å†…å®¹åŒºåŸŸ --\x3e\n      <main class="main-content">\n        \x3c!-- å†…å®¹é¢æ¿ --\x3e\n        <section class="content-panel">\n          \x3c!-- ç©ºé—´ç«™çŠ¶æ€æ¨¡å—ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ --\x3e\n          <div class="module-container active" id="module-status">\n            <div class="module-body">\n              \x3c!-- ä¸»æ–‡æœ¬æ¡†åŒºåŸŸ --\x3e\n              <div class="maintext-container">\n                <div class="maintext-header">\n                  <h3 class="maintext-title">\n                    <i class="fas fa-scroll"></i>\n                    å½“å‰å‰§æƒ…\n                  </h3>\n                </div>\n                <div class="maintext-areas">\n                  <div class="maintext-section">\n                    <div class="maintext-section-header">\n                      <span class="maintext-section-title">é€‰æ‹©å»¶ç»­</span>\n                    </div>\n                    <div class="maintext-section-area" id="maintext-continue-choice"></div>\n                  </div>\n                  <div class="maintext-section">\n                    <div class="maintext-section-header">\n                      <span class="maintext-section-title">åæœæ€»ç»“</span>\n                    </div>\n                    <div class="maintext-section-area" id="maintext-result"></div>\n                  </div>\n                  <div class="maintext-section">\n                    <div class="maintext-section-header">\n                      <span class="maintext-section-title">æ–°å‰§æƒ…</span>\n                    </div>\n                    <div class="maintext-section-area" id="maintext-next-choice"></div>\n                  </div>\n                </div>\n              </div>\n              <div class="status-grid" id="status-grid"></div>\n            </div>\n          </div>\n\n          \x3c!-- ä»»åŠ¡æ¨¡å— --\x3e\n          <div class="module-container" id="module-tasks">\n            <div class="module-body">\n              <div class="entry-list" id="tasks-list"></div>\n            </div>\n          </div>\n\n          \x3c!-- æ—¥è®°æ¨¡å— --\x3e\n          <div class="module-container" id="module-diary">\n            <div class="module-body">\n              <div class="entry-list" id="diary-list"></div>\n            </div>\n          </div>\n\n          \x3c!-- é€šè®¯æ¨¡å— --\x3e\n          <div class="module-container" id="module-communication">\n            <div class="module-body communication-body">\n              <div class="chat-messages" id="chat-messages"></div>\n              <div class="chat-input-container">\n                <div class="chat-input-wrapper">\n                  <button type="button" id="chat-show-options-btn" class="chat-show-options-btn" title="æ˜¾ç¤ºé€‰é¡¹">\n                    <i class="fas fa-list"></i>\n                  </button>\n                  <button\n                    type="button"\n                    id="chat-regenerate-btn"\n                    class="chat-regenerate-btn"\n                    title="é‡æ–°ç”Ÿæˆå½“å‰è½®ï¼ˆä¼šåˆ é™¤æœ¬è½® user/assistant æ¶ˆæ¯ï¼‰"\n                  >\n                    <i class="fas fa-rotate-right"></i>\n                  </button>\n                  <textarea id="chat-input" class="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>\n                  <button type="button" id="chat-send-btn" class="chat-send-btn">\n                    <i class="fas fa-paper-plane"></i>\n                  </button>\n                </div>\n              </div>\n              \x3c!-- Option é€‰é¡¹æµ®å±‚å®¹å™¨ --\x3e\n              <div class="chat-options-overlay" id="chat-options-overlay">\n                <div class="chat-options-container" id="chat-options-container">\n                  <div class="chat-options-header">\n                    <span class="chat-options-title">å¯ç”¨é€‰é¡¹</span>\n                    <button type="button" class="chat-options-close" id="chat-options-close" title="å…³é—­">\n                      <i class="fas fa-times"></i>\n                    </button>\n                  </div>\n                </div>\n                <div class="chat-options-list" id="chat-options-list"></div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      \x3c!-- æ¨¡æ€æ¡†å®¹å™¨ --\x3e\n      <div class="modal-overlay" id="modal-overlay">\n        <div class="modal-container" id="modal-container">\n          <div class="modal-header">\n            <h3 class="modal-title" id="modal-title">æ ‡é¢˜</h3>\n            <button class="modal-close" id="modal-close">\n              <i class="fas fa-times"></i>\n            </button>\n          </div>\n          <div class="modal-body" id="modal-body"></div>\n        </div>\n      </div>\n\n    '}setupEnterKeyFullscreen(){try{this.keyDownHandler&&(document.removeEventListener('keydown',this.keyDownHandler),this.keyDownHandler=null),this.keyDownHandler=e=>{try{if(!this.element?.classList.contains('active'))return;const t=document.activeElement;if(t&&('INPUT'===t.tagName||'TEXTAREA'===t.tagName))return;'Enter'===e.key&&(e.preventDefault(),this.toggleFullscreen())}catch(e){console.error('âŒ é”®ç›˜äº‹ä»¶å¤„ç†å¤±è´¥:',e)}},document.addEventListener('keydown',this.keyDownHandler),console.log('âœ… Enter é”®å…¨å±æ”¯æŒå·²è®¾ç½®')}catch(e){console.error('âŒ è®¾ç½®é”®ç›˜äº‹ä»¶æ”¯æŒå¤±è´¥:',e)}}requestFullscreen(){try{const e=document.documentElement;e.requestFullscreen?e.requestFullscreen().catch(e=>{console.warn('å…¨å±è¯·æ±‚å¤±è´¥:',e)}):e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}catch(e){console.error('âŒ è¯·æ±‚å…¨å±å¤±è´¥:',e)}}exitFullscreen(){try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){console.error('âŒ é€€å‡ºå…¨å±å¤±è´¥:',e)}}toggleFullscreen(){try{document.fullscreenElement?this.exitFullscreen():this.requestFullscreen()}catch(e){console.error('âŒ åˆ‡æ¢å…¨å±å¤±è´¥:',e)}}}async function d(e){await async function(e){try{await waitGlobalInitialized('Mvu');let t=null,s=null,n=null;try{t=Mvu.getMvuData({type:'message',message_id:0})}catch{}try{s=Mvu.getMvuData({type:'message',message_id:'latest'})}catch{}n=Mvu.getMvuData({type:'chat'});const a=i().merge({},t??{},s??{},n??{}),o=a?.stat_data||{},r=i().cloneDeep(o);if(void 0!==e.reserve){r.system_state||(r.system_state={}),r.system_state.antimatter||(r.system_state.antimatter={});const t=i().clamp(e.reserve,0,1e5);r.system_state.antimatter.reserve=t,console.info(`âœ… æ›´æ–° system_state.antimatter.reserve: ${t}`)}const c={...a,stat_data:r};await Mvu.replaceMvuData(c,{type:'chat'}),console.info('âœ… MVU å˜é‡å·²æ›´æ–°')}catch(e){throw console.error('âŒ æ›´æ–° MVU å˜é‡å¤±è´¥:',e),e}}(e);const t={station_name:'ç©ºé—´ç«™ Alpha',difficulty:'normal',resources:{energy:100,supplies:100,crew:10},status:{energy:87,life_support:92,system:78,personnel:'æ­£å¸¸',communication:95,laboratory:83,storage:64,computing:71},tasks:[],diary:[],messages:[]};return await async function(e){try{const t=getVariables({type:'message'}),s={...t,game_data:{...t.game_data||{},...e}};replaceVariables(s,{type:'message'}),console.info('æ¸¸æˆæ•°æ®å·²æ›´æ–°')}catch(e){throw console.error('æ›´æ–°æ¸¸æˆæ•°æ®å¤±è´¥:',e),e}}(t),await async function(e){try{const t={...getVariables({type:'message'}),game_config:e};replaceVariables(t,{type:'message'}),console.info('æ¸¸æˆé…ç½®å·²æ›´æ–°')}catch(e){throw console.error('æ›´æ–°æ¸¸æˆé…ç½®å¤±è´¥:',e),e}}(e),t}class u{currentPage='splash';splashScreen;setupScreen;dashboard;appContainer;constructor(e){this.appContainer=e;const t={onStart:()=>this.goToSplash(),onNewGame:()=>this.goToSetup(),onContinue:()=>this.goToGame(),onConfirm:e=>this.handleConfirm(e),onCancel:()=>this.goToSplash(),onFullscreenToggle:()=>this.toggleFullscreen()};this.splashScreen=new r(t),this.setupScreen=new c(t),this.dashboard=new l(t)}initialize(){this.appContainer.appendChild(this.splashScreen.createElement()),this.appContainer.appendChild(this.setupScreen.createElement()),this.appContainer.appendChild(this.dashboard.createElement());o()?this.goToGame():this.showPage('splash')}showPage(e){console.log(`ğŸ”„ å¼€å§‹åˆ‡æ¢é¡µé¢: ${e}`);try{this.splashScreen.hide(),this.setupScreen.hide(),this.dashboard.hide()}catch(e){console.warn('âš ï¸ éšè—é¡µé¢æ—¶å‡ºé”™:',e)}try{switch(e){case'splash':this.splashScreen.show(),this.requestFullscreen();break;case'setup':this.setupScreen.show();break;case'game':this.dashboard.show(),setTimeout(()=>{const e=document.getElementById('main-screen');e&&e.classList.contains('active')?console.log('âœ… Dashboard å·²æ­£ç¡®æ˜¾ç¤º'):console.error('âŒ Dashboard æ˜¾ç¤ºå¼‚å¸¸ï¼Œelement:',e)},100)}}catch(t){throw console.error(`âŒ æ˜¾ç¤ºé¡µé¢ ${e} å¤±è´¥:`,t),t}this.currentPage=e,console.info(`âœ… æˆåŠŸåˆ‡æ¢åˆ°é¡µé¢: ${e}`)}goToSplash(){this.showPage('splash')}goToSetup(){this.showPage('setup')}async goToGame(){try{console.log('ğŸ”„ å¼€å§‹åŠ è½½æ¸¸æˆ...');const e=await async function(){console.info('ç»§ç»­æ¸¸æˆ...');const e=getVariables({type:'message'}),t=e.game_data||e.stat_data||{};return console.info('æ¸¸æˆæ•°æ®å·²åŠ è½½'),t}();console.log('âœ… æ¸¸æˆæ•°æ®åŠ è½½å®Œæˆ:',e),this.dashboard.updateGameData(e),this.showPage('game'),console.log('âœ… å·²åˆ‡æ¢åˆ°æ¸¸æˆé¡µé¢')}catch(e){console.error('âŒ åŠ è½½æ¸¸æˆå¤±è´¥:',e),console.error('âŒ é”™è¯¯è¯¦æƒ…:',{error:e,errorMessage:e instanceof Error?e.message:String(e),errorStack:e instanceof Error?e.stack:void 0});try{this.dashboard.updateGameData({}),this.showPage('game'),console.warn('âš ï¸ ä½¿ç”¨ç©ºæ•°æ®ç»§ç»­æ˜¾ç¤ºæ¸¸æˆé¡µé¢')}catch(e){console.error('âŒ æ˜¾ç¤ºæ¸¸æˆé¡µé¢ä¹Ÿå¤±è´¥:',e),toastr.error('åŠ è½½æ¸¸æˆå¤±è´¥','é”™è¯¯')}}}async handleConfirm(e){try{const t=await async function(e){console.info('åˆå§‹åŒ–æ–°æ¸¸æˆ...',e);const t=await d(e);return console.info('æ–°æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼ˆå¼€åœºç™½ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼‰'),t}(e);this.dashboard.updateGameData(t),this.showPage('game'),toastr.success('æ¸¸æˆå·²åˆå§‹åŒ–','æˆåŠŸ')}catch(e){console.error('åˆå§‹åŒ–æ¸¸æˆå¤±è´¥:',e),toastr.error('åˆå§‹åŒ–æ¸¸æˆå¤±è´¥','é”™è¯¯')}}requestFullscreen(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen().catch(e=>{console.warn('å…¨å±è¯·æ±‚å¤±è´¥:',e)}):e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():this.requestFullscreen()}getDashboard(){return this.dashboard}}function m(){const e=document.getElementById('chat-input'),t=document.getElementById('chat-send-btn'),s=document.getElementById('chat-regenerate-btn'),a=document.getElementById('chat-messages');if(!e||!t||!a)return;let i=[],o=-1,r=null;function c(){return null!==r&&r>=0&&r<i.length&&i[r]?.pending?r:function(){for(let e=i.length-1;e>=0;e--){const t=i[e];if(t&&t.pending)return e}return null}()}let l=null,d='',u=!1,m=!1,h=[],g=null,p=null,v=null;function y(){e.style.height='auto';const t=Math.min(e.scrollHeight,80);e.style.height=`${t}px`}function f(e){const t=document.createElement('div');return t.textContent=e,t.innerHTML}async function b(e){if(u){Array.from(a.children).filter(e=>e!==l).forEach(e=>e.remove())}else a.innerHTML='',l=null;if(e<0||e>=i.length)return void M();const t=i[e];t.userMessage?w(t.userMessage.message):t.pendingUserMessage&&w(t.pendingUserMessage),t.assistantMessage?await async function(e,t){const s=document.createElement('div');s.className='message-item message-assistant';try{const{extractContinueChoice:a,extractResult:i,extractNextChoice:o}=await Promise.resolve().then(n.bind(n,685)),{extractLastMaintext:r}=await Promise.resolve().then(n.bind(n,685)),c=r(t)||t,l=a(c),d=i(c),u=o(c),m=[];if(l&&m.push({header:'é€‰æ‹©å»¶ç»­',content:l,key:'continue'}),d&&m.push({header:'åæœæ€»ç»“',content:d,key:'result'}),u&&m.push({header:'æ–°å‰§æƒ…',content:u,key:'next'}),m.length>0){const e=m.map(e=>`\n          <div class="message-column">\n            <div class="message-column-header">${f(e.header)}</div>\n            <div class="message-column-content">${f(e.content)}</div>\n          </div>\n        `).join('');s.innerHTML=`\n          <div class="message-bubble">\n            <div class="message-content message-content-three-columns">\n              ${e}\n            </div>\n            <div class="message-time"></div>\n          </div>\n        `}else s.innerHTML=`\n          <div class="message-bubble">\n            <div class="message-content">${f(e)}</div>\n            <div class="message-time"></div>\n          </div>\n        `}catch(t){console.error('âŒ è§£æç»“æ„åŒ–æ ‡ç­¾å¤±è´¥ï¼Œä½¿ç”¨å•æ æ˜¾ç¤º:',t),s.innerHTML=`\n        <div class="message-bubble">\n          <div class="message-content">${f(e)}</div>\n          <div class="message-time"></div>\n        </div>\n      `}a.appendChild(s)}(t.assistantMessage.message,t.assistantMessage.message):t.pending&&u?(l||S(),l&&l.parentNode===a&&a.appendChild(l)):t.assistantMessage||u||l||(l=document.createElement('div'),l.className='message-item message-assistant',l.innerHTML='\n        <div class="message-bubble">\n          <div class="message-content message-content-three-columns">\n            <div class="message-column">\n              <div class="message-column-header">æ–°å‰§æƒ…</div>\n              <div class="message-column-content">ç­‰å¾…é€‰æ‹©ã€‚</div>\n            </div>\n          </div>\n          <div class="message-time"></div>\n        </div>\n      ',a.appendChild(l)),M()}function M(){if(!s)return;if(u||m)return void(s.disabled=!0);const e=i[o],t=!!e&&!!e.userMessage&&'string'==typeof e.userMessage.message&&e.userMessage.message.trim().length>0&&!!e.assistantMessage&&'number'==typeof e.assistantMessage.message_id&&Number.isFinite(e.assistantMessage.message_id)&&!e.pending;s.disabled=!t}function w(e){const t=document.createElement('div');t.className='message-item message-user',t.innerHTML=`\n      <div class="message-bubble">\n        <div class="message-content">${f(e)}</div>\n        <div class="message-time"></div>\n      </div>\n    `,a.appendChild(t)}async function E(){try{const e=getLastMessageId(),t=function(e){const t=[];let s=null;return e.forEach(e=>{if('user'===e.role){const n={userMessage:{message_id:e.message_id,message:e.message},assistantMessage:null};return t.push(n),void(s=n)}'assistant'===e.role&&(s&&!s.assistantMessage?(s.assistantMessage={message_id:e.message_id,message:e.message},s=null):t.push({userMessage:null,assistantMessage:{message_id:e.message_id,message:e.message}}))}),t}(e>=0?getChatMessages(`0-${e}`):[]);i=t,i.length>0&&(o=i.length-1,u||await b(o)),console.log('âœ… å·²åŠ è½½èŠå¤©å†å²ï¼Œå…±',i.length,'è½®å¯¹è¯ï¼Œå½“å‰æ˜¾ç¤ºç¬¬',o+1,'è½®')}catch(e){console.error('åŠ è½½èŠå¤©å†å²å¤±è´¥:',e)}}async function x(){if(m)return void console.warn('âš ï¸ æ­£åœ¨å‘é€æ¶ˆæ¯ï¼Œè¯·å‹¿é‡å¤ç‚¹å‡»');const s=e.value.trim();if(s){m=!0,e.value='',y(),t.disabled=!0,e.disabled=!0,u=!0,M();try{const a=await(p||(p=Promise.resolve().then(n.bind(n,137)).then(e=>e.generateMessage)),p);console.log('ğŸš€ å¼€å§‹ç”Ÿæˆæ¶ˆæ¯ï¼Œç”¨æˆ·è¾“å…¥:',s);await a(s,{onShowGenerating:()=>{l||S()},onHideGenerating:()=>{if(l){const e=l.querySelector('.message-time');e&&(e.textContent='')}},onError:s=>{console.error('âŒ ç”Ÿæˆæ¶ˆæ¯å¤±è´¥:',s),L(),u=!1,t.disabled=!1,e.disabled=!1,m=!1},onStreamingUpdate:e=>{k(e)},onRefreshStoryIfOpen:e=>{console.log('ğŸ“ user æ¶ˆæ¯å·²åˆ›å»ºï¼Œç«‹å³æ˜¾ç¤º:',e),u=!0;const t={assistantMessage:null,userMessage:null,pending:!0,pendingUserMessage:e};i.push(t),o=i.length-1,r=o,b(o)},onRefreshStory:async s=>{if(console.log('ğŸ“ assistant æ¶ˆæ¯å·²åˆ›å»ºï¼Œè½¬ä¸ºæœ€ç»ˆæ¶ˆæ¯'),h=s&&s.length>0?s:[],await C(d||''),g){const e=c(),t='number'==typeof e?i[e]:i[o];t?.userMessage&&(t.userMessage.message_id=g.userMessageId),t?.assistantMessage&&(t.assistantMessage.message_id=g.assistantMessageId)}u=!1,m=!1,t.disabled=!1,e.disabled=!1,M(),setTimeout(()=>{try{const e=document.getElementById('main-screen');e?.dispatchEvent(new CustomEvent('refresh-maintext')),e?.dispatchEvent(new CustomEvent('refresh-status'))}catch(e){console.debug('refresh-maintext dispatch failed:',e)}},200)},onCreatedMessages:e=>{g=e}})&&console.log('âœ… æ¶ˆæ¯ç”ŸæˆæˆåŠŸ')}catch(s){console.error('âŒ å‘é€æ¶ˆæ¯å¼‚å¸¸:',s),L(),u=!1,t.disabled=!1,e.disabled=!1,m=!1,M()}}}function S(){l||(l=document.createElement('div'),l.className='message-item message-assistant message-streaming',l.innerHTML='\n        <div class="message-bubble">\n          <div class="message-content message-content-three-columns"></div>\n        </div>\n      ',a.appendChild(l))}function L(){l&&(l.remove(),l=null)}async function C(e){if(l){try{let t=l.querySelector('.message-content-three-columns');t||(l.innerHTML='\n            <div class="message-bubble">\n              <div class="message-content message-content-three-columns"></div>\n              <div class="message-time"></div>\n            </div>\n          ',t=l.querySelector('.message-content-three-columns')),await T(e,t)}catch(t){console.error('âŒ finalize æ›´æ–°æµå¼ DOM å¤±è´¥ï¼Œå›é€€ä¸ºå•æ :',t),l&&(l.innerHTML=`\n            <div class="message-bubble">\n              <div class="message-content">${f(e)}</div>\n              <div class="message-time"></div>\n            </div>\n          `)}l.classList.remove('message-streaming');const t=l.querySelector('.message-time');t&&(t.textContent='')}const t=c();if('number'==typeof t&&t>=0&&t<i.length){const s=i[t];s&&s.pending&&(s.assistantMessage={message_id:Date.now(),message:e||l&&l.textContent||''},s.pendingUserMessage&&(s.userMessage={message_id:Date.now()-1,message:s.pendingUserMessage}),s.pending=!1,delete s.pendingUserMessage)}else console.warn('âš ï¸ finalize: æœªæ‰¾åˆ° pending è½®æ¬¡ï¼Œå¯èƒ½æ˜¯çŠ¶æ€ç«äº‰æˆ–å·²è¢«åˆ·æ–°é‡å»º');l=null,r=null}async function k(e){if(d=e,l||S(),l)try{let t=l.querySelector('.message-content-three-columns');if(!t&&(l.innerHTML='\n          <div class="message-bubble">\n            <div class="message-content message-content-three-columns"></div>\n            <div class="message-time">ç”Ÿæˆä¸­</div>\n          </div>\n        ',t=l.querySelector('.message-content-three-columns'),!t))return;await T(e,t)}catch(e){console.error('âŒ æ›´æ–°æµå¼æ¶ˆæ¯å¤±è´¥:',e)}}async function T(e,t){const s=[{tag:'continue_choice',header:'é€‰æ‹©å»¶ç»­',key:'continue'},{tag:'result',header:'åæœæ€»ç»“',key:'result'},{tag:'decision_node',header:'æ–°å‰§æƒ…',key:'next'}];for(const n of s){const s=`<${n.tag}>`,a=`</${n.tag}>`;let i=t.querySelector(`[data-column-key="${n.key}"]`);if(i){if(i.hasAttribute('data-closed'))continue}const o=e.indexOf(s);if(-1===o)continue;const r=o+s.length,c=e.indexOf(a,r);let l='';if(-1!==c){if(l=e.substring(r,c),!i){i=document.createElement('div'),i.className='message-column',i.setAttribute('data-column-key',n.key);const e=document.createElement('div');e.className='message-column-header',e.textContent=n.header;const s=document.createElement('div');s.className='message-column-content',i.appendChild(e),i.appendChild(s),t.appendChild(i)}i.setAttribute('data-closed','true')}else if(l=e.substring(r),!i){i=document.createElement('div'),i.className='message-column',i.setAttribute('data-column-key',n.key);const e=document.createElement('div');e.className='message-column-header',e.textContent=n.header;const s=document.createElement('div');s.className='message-column-content',i.appendChild(e),i.appendChild(s),t.appendChild(i)}const d=i.querySelector('.message-column-content');if(d){const e=d.scrollTop,t=d.scrollHeight,s=e+d.clientHeight>=t-10;if(d.textContent=l,s)d.scrollTop=d.scrollHeight;else{const s=d.scrollHeight;d.scrollTop=s>t?e+(s-t):e}}}}e.addEventListener('input',y);const D=document.getElementById('chat-options-overlay'),q=document.getElementById('chat-options-container'),H=document.getElementById('chat-options-list'),F=document.getElementById('chat-show-options-btn'),I=document.getElementById('chat-options-close');function R(){D&&D.classList.remove('active'),H&&H.classList.remove('collapse')}F&&F.addEventListener('click',async function(){if(!D||!q||!H)return;const t=await async function(){try{if(h.length>0)return console.log('âœ… ä½¿ç”¨ä¿å­˜çš„é€‰é¡¹ï¼ˆä» messageGenerator ä¼ é€’ï¼‰'),h;const e=getChatMessages(-1,{role:'assistant'}),t=e.length>0?e[e.length-1]:null;if(!t)return[];if(t.data?.__options&&t.data.__options.length>0)return console.log('âœ… ä» assistant.data è¯»å–é€‰é¡¹ï¼ˆæŒä¹…åŒ–ï¼‰'),t.data.__options;const{extractAllOptions:s}=await Promise.resolve().then(n.bind(n,685)),a=s(t.message||'');return a.length>0&&console.log('âœ… ä»æ¶ˆæ¯ä¸­æå–é€‰é¡¹ï¼ˆé™çº§æ–¹æ¡ˆï¼‰'),a}catch(e){return console.error('âŒ è·å–é€‰é¡¹å¤±è´¥:',e),[]}}();if(0===t.length)return void function(){const e=document.createElement('div');e.className='chat-no-options-message',e.innerHTML='\n      <div class="chat-no-options-content">\n        <div class="chat-no-options-text">åšå†³å®šå§ qwq</div>\n        <button type="button" class="chat-no-options-close" title="å…³é—­">Ã—</button>\n      </div>\n    ';const t=e.querySelector('.chat-no-options-close');t&&t.addEventListener('click',()=>{R()}),H&&(H.innerHTML='',H.style.position='absolute',H.style.top='50%',H.style.left='50%',H.style.transform='translate(-50%, -50%)',H.style.width='auto',H.style.height='auto',H.style.pointerEvents='auto',H.classList.remove('collapse'),H.appendChild(e)),D&&D.classList.add('active')}();if(H.innerHTML='',H.classList.remove('collapse'),H.style.position='absolute',H.style.top='0',H.style.left='0',H.style.right='0',H.style.bottom='0',H.style.width='100%',H.style.height='100%',H.style.pointerEvents='auto',!D)return;const s=[];t.forEach((n,a)=>{setTimeout(()=>{const i=document.createElement('div');i.className='chat-option';const o=document.createElement('button');o.type='button',o.className='chat-option-button';const r=document.createElement('span');r.className='chat-option-text',r.textContent=n,o.title=n,o.appendChild(r),i.appendChild(o);const c=function(){let e=0;const t=.15;for(;e<50;){const n=t+.7*Math.random(),a=t+.7*Math.random();if(!s.some(e=>{const t=D.clientWidth,s=D.clientHeight,i=(n-e.x)*t,o=(a-e.y)*s;return Math.sqrt(i*i+o*o)<150}))return s.push({x:n,y:a}),{x:n,y:a};e++}const n=t+.7*Math.random(),a=t+.7*Math.random();return s.push({x:n,y:a}),{x:n,y:a}}(),l=30*(Math.random()-.5);i.style.setProperty('--rot',`${l}deg`),i.style.left=100*c.x+'%',i.style.top=100*c.y+'%',i.style.position='absolute',i.style.pointerEvents='auto';const d=t.length-a;o.style.opacity=''+(.85+.03*d),o.style.filter='none',o.addEventListener('click',()=>{o.classList.add('selected'),i.classList.add('selected-parent'),H.classList.add('collapse'),setTimeout(()=>{e.value=n,y(),x(),R()},220)}),H.appendChild(i),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.classList.add('show')})})},80*a)}),D.classList.add('active'),console.log(`âœ… å·²æ˜¾ç¤º ${t.length} ä¸ªé€‰é¡¹`)}),I&&I.addEventListener('click',R),D&&D.addEventListener('click',e=>{e.target!==D&&e.target!==H||R()}),t.addEventListener('click',x),s&&s.addEventListener('click',async function(){if(!s)return;if(u||m)return;const a=i[o];if(!a?.userMessage||!a.assistantMessage)return void M();const p=a.userMessage.message_id,y=a.assistantMessage.message_id;if('number'==typeof p&&Number.isFinite(p)&&'number'==typeof y&&Number.isFinite(y)){m=!0,u=!0,d='',t.disabled=!0,e.disabled=!0,s.disabled=!0,a.assistantMessage=null,a.pending=!0,r=o,await b(o);try{await deleteChatMessages([y],{refresh:'none'}),console.log('ğŸ—‘ï¸ å·²åˆ é™¤å½“å‰è½® assistant æ¶ˆæ¯ï¼Œå‡†å¤‡é‡æ–°ç”Ÿæˆ:',y);const s=await(v||(v=Promise.resolve().then(n.bind(n,137)).then(e=>e.regenerateAssistantMessage)),v);await s(p,{onShowGenerating:()=>{l||S()},onHideGenerating:()=>{if(l){const e=l.querySelector('.message-time');e&&(e.textContent='')}},onError:s=>{console.error('âŒ é‡æ–°ç”Ÿæˆå¤±è´¥:',s),L(),u=!1,m=!1,t.disabled=!1,e.disabled=!1,a.pending=!1,M(),E()},onStreamingUpdate:e=>{k(e)},onRefreshStory:async s=>{if(console.log('ğŸ“ assistant æ¶ˆæ¯å·²é‡æ–°ç”Ÿæˆï¼Œè½¬ä¸ºæœ€ç»ˆæ¶ˆæ¯'),h=s&&s.length>0?s:[],await C(d||''),g){const e=c(),t='number'==typeof e?i[e]:i[o];t?.assistantMessage&&(t.assistantMessage.message_id=g.assistantMessageId)}a.pending=!1,u=!1,m=!1,t.disabled=!1,e.disabled=!1,M(),setTimeout(()=>{try{const e=document.getElementById('main-screen');e?.dispatchEvent(new CustomEvent('refresh-maintext')),e?.dispatchEvent(new CustomEvent('refresh-status'))}catch(e){console.debug('refresh-maintext dispatch failed:',e)}},200)},onCreatedMessages:e=>{g=e}})}catch(s){console.error('âŒ é‡æ–°ç”Ÿæˆå¼‚å¸¸:',s),L(),a.pending=!1,u=!1,m=!1,t.disabled=!1,e.disabled=!1,M(),E()}}}),e.addEventListener('keydown',e=>{'Enter'!==e.key||e.shiftKey||(e.preventDefault(),x())}),function(){const t=document.getElementById('module-communication');if(!t)return;document.addEventListener('keydown',s=>{if(t.classList.contains('active')&&document.activeElement!==e)if('ArrowLeft'===s.key)s.preventDefault(),o>0&&(o--,b(o));else if('ArrowRight'===s.key)s.preventDefault(),o<i.length-1&&(o++,b(o));else if('o'===s.key||'O'===s.key){s.preventDefault();const e=document.getElementById('chat-show-options-btn');e&&e.click()}})}(),E(),function(){const e=document.getElementById('module-communication');if(!e)return;new MutationObserver(()=>{e.classList.contains('active')&&(console.log('ğŸ“¡ é€šè®¯æ¨¡å—å·²æ¿€æ´»ï¼Œåˆ·æ–°æ˜¾ç¤º'),async function(){await E()}())}).observe(e,{attributes:!0,attributeFilter:['class']})}()}let h=null;function g(){const e=document.getElementById('app');if(!e)return void console.error('æœªæ‰¾åˆ° #app å®¹å™¨');h=new u(e),h.initialize();const t=document.getElementById('main-screen');if(t){new MutationObserver(()=>{t.classList.contains('active')&&setTimeout(()=>{!function(){if(document.querySelector('.nav-item[data-module="status"]')?.hasAttribute('data-initialized'))return;(function(){const e=document.querySelectorAll('.nav-item'),t=document.querySelectorAll('.module-container');function s(s){if(!s)return;e.forEach(e=>e.classList.remove('active')),t.forEach(e=>e.classList.remove('active'));const n=document.querySelector(`.nav-item[data-module="${s}"]`),a=document.getElementById(`module-${s}`);n&&n.classList.add('active'),a&&a.classList.add('active')}e.forEach(e=>{e.addEventListener('click',()=>{const t=e.getAttribute('data-module');t&&s(t)})});const n={1:'status',2:'tasks',3:'diary',4:'communication'};document.addEventListener('keydown',e=>{const t=document.getElementById('main-screen');if(!t||!t.classList.contains('active'))return;const a=document.activeElement;if((!a||!('INPUT'===a.tagName||'TEXTAREA'===a.tagName||a instanceof HTMLElement&&a.isContentEditable))&&e.key>='1'&&e.key<='4'){const t=n[e.key];t&&(e.preventDefault(),s(t),console.log(`âŒ¨ï¸ å¿«æ·é”®åˆ‡æ¢æ¨¡å—: ${t} (${e.key})`))}})})(),function(){const e=document.getElementById('modal-overlay'),t=document.getElementById('modal-close');e&&t&&(t.addEventListener('click',()=>{e.classList.remove('active')}),e.addEventListener('click',t=>{t.target===e&&e.classList.remove('active')}))}(),document.querySelectorAll('.status-card').forEach(e=>{e.addEventListener('click',()=>{console.log('çŠ¶æ€å¡ç‰‡è¢«ç‚¹å‡»')})}),m(),document.querySelectorAll('.nav-item').forEach(e=>{e.setAttribute('data-initialized','true')}),console.info('ä¸»æ¸¸æˆç•Œé¢åŠŸèƒ½å·²åˆå§‹åŒ–')}()},100)}).observe(t,{attributes:!0,attributeFilter:['class']})}eventOn(tavern_events.MESSAGE_UPDATED,()=>{if(h){h.getDashboard();console.info('æ¶ˆæ¯å·²æ›´æ–°ï¼Œåˆ·æ–°æ¸¸æˆæ•°æ®')}})}$(()=>{errorCatched(g)()}),$(window).on('pagehide',()=>{console.info('é”šç•Œé¢å·²å¸è½½')}),$(()=>{!function(){if(!document.querySelector('link[href*="font-awesome"]')){const e=document.createElement('link');e.rel='stylesheet',e.href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css',document.head.appendChild(e)}if(!document.querySelector('meta[charset]')){const e=document.createElement('meta');e.setAttribute('charset','UTF-8'),document.head.appendChild(e)}if(!document.querySelector('meta[name="viewport"]')){const e=document.createElement('meta');e.setAttribute('name','viewport'),e.setAttribute('content','width=device-width, initial-scale=1.0'),document.head.appendChild(e)}if(document.title='é”š',!document.querySelector('meta[name="description"]')){const e=document.createElement('meta');e.setAttribute('name','description'),e.setAttribute('content','é”š - èˆ°ä½“ç”Ÿå­˜ç»è¥æ¸¸æˆ - ç®¡ç†ä»»åŠ¡ã€è®°å½•æ—¥å¿—ã€å¤„ç†é€šè®¯ã€ç›‘æ§èˆ°ä½“çŠ¶æ€'),document.head.appendChild(e)}}(),console.info('é”šç•Œé¢å·²åŠ è½½')}),$(window).on('pagehide',()=>{console.info('é”šç•Œé¢å·²å¸è½½')});
//# sourceMappingURL=index.js.map</script><style>:root{--primary-cyan:hsl(180,100%,40%);--primary-blue:hsl(200,100%,35%);--primary-indigo:hsl(240,80%,40%);--accent-teal:hsl(170,100%,35%);--accent-purple:hsl(270,80%,45%);--accent-green:hsl(120,60%,40%);--accent-red:hsl(0,70%,45%);--accent-orange:hsl(30,80%,45%);--bg-primary:hsl(220,15%,8%);--bg-secondary:hsl(220,12%,12%);--bg-tertiary:hsl(220,15%,15%);--bg-card:hsl(220,18%,10%);--bg-glass:hsla(220,20%,12%,0.8);--text-primary:hsl(180,20%,88%);--text-secondary:hsl(180,15%,65%);--text-tertiary:hsl(180,10%,50%);--border-color:hsl(180,30%,20%);--border-glow:hsl(180,100%,40%);--shadow-sm:0 1px 4px hsla(0,0%,0%,0.5);--shadow-md:0 2px 8px hsla(0,0%,0%,0.6);--shadow-lg:0 4px 16px hsla(0,0%,0%,0.7);--shadow-glow:0 0 12px hsla(180,100%,40%,0.3);--gradient-primary:linear-gradient(135deg,var(--primary-cyan),var(--primary-blue));--gradient-card:linear-gradient(135deg,var(--bg-card),var(--bg-tertiary));--gradient-glass:linear-gradient(135deg,hsla(220,30%,25%,0.8),hsla(220,30%,20%,0.6));--radius-xs:6px;--radius-sm:10px;--radius-md:14px;--radius-lg:18px;--panel-border:hsla(187,85%,45%,0.22);--panel-border-strong:hsla(187,85%,55%,0.42);--panel-glow:0 0 0 1px var(--panel-border) inset,0 0 20px hsla(187,85%,45%,0.12);--panel-bg:linear-gradient(180deg,hsla(220,18%,12%,0.96),hsla(220,22%,8%,0.96));--panel-bg-hover:linear-gradient(180deg,hsla(220,18%,14%,0.98),hsla(220,22%,9%,0.98));--panel-border-gradient:linear-gradient(135deg,hsla(180,100%,45%,0.55),hsla(200,100%,40%,0.18) 35%,hsla(270,80%,45%,0.12) 70%,transparent);--transition-fast:0.15s;--transition-normal:0.3s;--transition-slow:0.5s}*{margin:0;padding:0;box-sizing:border-box}html{height:100%;width:100%;margin:0;padding:0;overflow:hidden}body{height:100%;width:100%;margin:0;padding:0;font-family:'Inter','Roboto',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg-primary);color:var(--text-primary);font-size:1rem;line-height:1.8;overflow:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@font-face {font-family:'Pixel';src:url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap')}.space-station-app{width:100%;min-height:100%;height:100%;position:relative;color:var(--text-primary);overflow:hidden;background:var(--bg-primary)}html:fullscreen .space-station-app,html:-webkit-full-screen .space-station-app,html:-moz-full-screen .space-station-app,html:-ms-fullscreen .space-station-app{width:100vw !important;height:100vh !important}.screen{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;display:none;opacity:0;transition:opacity var(--transition-slow);overflow:hidden}.screen.active{display:flex;opacity:1;z-index:10}.start-screen{align-items:center;justify-content:center;background:radial-gradient(circle at 50% 50%,hsla(180,100%,40%,0.15) 0%,transparent 70%),var(--bg-primary);flex-direction:column}.start-screen-content{text-align:center;display:flex;flex-direction:column;align-items:center;gap:1.5rem;animation:fadeInUp 1s ease-out}.start-screen-logo{font-size:4rem;color:var(--primary-cyan);filter:drop-shadow(0 0 20px var(--primary-cyan));margin-bottom:1rem;animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,100%{transform:scale(1);filter:drop-shadow(0 0 20px var(--primary-cyan))}50%{transform:scale(1.05);filter:drop-shadow(0 0 30px var(--primary-cyan))}}.start-screen-title{font-size:2rem;font-weight:700;color:var(--primary-cyan);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.2em;margin:0}.start-screen-subtitle{font-size:0.75rem;color:var(--text-secondary);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.3em;margin:0}.start-screen-button{margin-top:2rem;padding:0.75rem 2rem;background:var(--primary-cyan);border:2px solid var(--primary-cyan);border-radius:4px;color:var(--bg-primary);font-size:0.9rem;font-weight:600;font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;display:flex;align-items:center;gap:0.75rem;transition:all var(--transition-normal);box-shadow:0 0 20px hsla(180,100%,40%,0.3)}.start-screen-button:hover{background:var(--accent-teal);border-color:var(--accent-teal);transform:translateY(-2px);box-shadow:0 0 30px hsla(170,100%,35%,0.5)}.start-screen-button:active{transform:translateY(0)}.start-screen-hint{margin-top:1rem;font-size:0.7rem;color:var(--text-tertiary);font-family:'Courier New',monospace;animation:blink 2s ease-in-out infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}.splash-screen{align-items:center;justify-content:center;background:radial-gradient(circle at 30% 30%,hsla(180,100%,40%,0.1) 0%,transparent 50%),radial-gradient(circle at 70% 70%,hsla(200,100%,35%,0.1) 0%,transparent 50%),var(--bg-primary);flex-direction:column}.splash-screen-content{width:100%;max-width:600px;display:flex;flex-direction:column;align-items:center;gap:2rem;padding:2rem;animation:fadeInUp 0.8s ease-out}.splash-header{text-align:center;display:flex;flex-direction:column;align-items:center;gap:1rem}.splash-logo{font-size:3rem;color:var(--primary-cyan);filter:drop-shadow(0 0 15px var(--primary-cyan))}.splash-title{font-size:1.75rem;font-weight:700;color:var(--primary-cyan);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.2em;margin:0}.splash-subtitle{font-size:0.7rem;color:var(--text-secondary);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.3em;margin:0}.splash-actions{display:flex;flex-direction:column;gap:0.75rem;width:100%;max-width:300px}.splash-button{padding:0.75rem 1.5rem;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-primary);font-size:0.85rem;font-weight:600;font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.5rem;transition:all var(--transition-fast)}.splash-button.primary{background:var(--primary-cyan);border-color:var(--primary-cyan);color:var(--bg-primary)}.splash-button.primary:hover{background:var(--accent-teal);border-color:var(--accent-teal);box-shadow:0 0 20px hsla(170,100%,35%,0.4)}.splash-button.secondary:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(187,85%,45%,0.14)}.splash-button.icon-only{width:40px;height:40px;padding:0;border-radius:50%;margin:0 auto}.splash-button.icon-only:hover{background:var(--bg-tertiary);border-color:var(--primary-cyan);transform:scale(1.1)}.splash-footer{margin-top:auto;text-align:center;display:flex;flex-direction:column;gap:0.5rem}.splash-copyright,.splash-author{font-size:0.65rem;color:var(--text-tertiary);font-family:'Courier New',monospace;margin:0}.main-screen{flex-direction:column;background:radial-gradient(circle at 20% 50%,hsla(187,85%,45%,0.1) 0%,transparent 50%),radial-gradient(circle at 80% 80%,hsla(240,60%,50%,0.1) 0%,transparent 50%),var(--bg-primary)}.space-station-app::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background-image:linear-gradient(90deg,hsla(187,85%,45%,0.035) 1px,transparent 1px),linear-gradient(0deg,hsla(187,85%,45%,0.03) 1px,transparent 1px),repeating-linear-gradient(0deg,transparent 0 10px,hsla(0,0%,100%,0.012) 10px 11px);background-size:72px 72px,72px 72px,100% 100%;background-position:center,center,center;pointer-events:none;z-index:0}:where(.status-card,.entry-item,.monitor-item,.detail-section,.maintext-container,.message-column,.chat-options-container,.chat-no-options-content,.setup-screen-content,.module-container){position:relative;isolation:isolate;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-sm);box-shadow:var(--shadow-md),var(--panel-glow)}:where(.status-card,.entry-item,.monitor-item,.detail-section,.maintext-container,.message-column,.chat-options-container,.chat-no-options-content,.setup-screen-content,.module-container)::before{z-index:2}:where(.status-card,.entry-item,.monitor-item,.detail-section,.maintext-container,.message-column,.chat-options-container,.chat-no-options-content,.setup-screen-content,.module-container)::after{content:'';position:absolute;inset:0;border-radius:inherit;pointer-events:none;z-index:1;background:linear-gradient(180deg,hsla(0,0%,100%,0.06),transparent 28%,transparent 70%,hsla(0,0%,0%,0.25));opacity:0.9;mix-blend-mode:normal}:where(.status-card,.entry-item,.monitor-item,.detail-section,.maintext-container,.message-column,.chat-options-container,.chat-no-options-content,.setup-screen-content,.module-container)>*{position:relative;z-index:3}.setup-screen{align-items:center;justify-content:center;background:radial-gradient(circle at 30% 30%,hsla(180,100%,40%,0.1) 0%,transparent 50%),radial-gradient(circle at 70% 70%,hsla(200,100%,35%,0.1) 0%,transparent 50%),var(--bg-primary);flex-direction:column}.setup-screen-content{width:100%;max-width:500px;display:flex;flex-direction:column;gap:1.5rem;padding:2rem;background:var(--gradient-glass) padding-box,var(--panel-border-gradient) border-box;border-radius:var(--radius-md);animation:fadeInUp 0.8s ease-out}.setup-header{text-align:center}.setup-title{font-size:1.5rem;font-weight:700;color:var(--primary-cyan);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em;margin:0 0 0.5rem 0}.setup-subtitle{font-size:0.75rem;color:var(--text-secondary);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em;margin:0}.setup-form{display:flex;flex-direction:column;gap:1rem}.setup-form-group{display:flex;flex-direction:column;gap:0.5rem}.setup-label{font-size:0.75rem;color:var(--text-secondary);font-weight:600;font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.05em}.setup-input,.setup-select{padding:0.5rem 0.75rem;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-primary);font-size:0.8rem;font-family:'Courier New',monospace;transition:all var(--transition-fast)}.setup-input:focus,.setup-select:focus{outline:none;box-shadow:0 0 0 2px hsla(187,85%,45%,0.22),0 0 20px hsla(187,85%,45%,0.12)}.setup-actions{display:flex;gap:0.75rem;justify-content:flex-end;margin-top:0.5rem}.setup-button{padding:0.6rem 1.25rem;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-primary);font-size:0.8rem;font-weight:600;font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:all var(--transition-fast)}.setup-button.primary{background:var(--primary-cyan);border-color:var(--primary-cyan);color:var(--bg-primary)}.setup-button.primary:hover{background:var(--accent-teal);border-color:var(--accent-teal);box-shadow:0 0 20px hsla(170,100%,35%,0.4)}.setup-button.secondary:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(187,85%,45%,0.14)}.main-screen{display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden}.main-header{background:var(--bg-secondary);border-bottom:1px solid var(--border-color);box-shadow:var(--shadow-sm);position:sticky;top:0;z-index:100;padding:0.5rem 0.75rem;flex-shrink:0}.header-content{display:flex;justify-content:space-between;align-items:center;gap:1.5rem;max-width:1400px;margin:0 auto}.logo-section{display:flex;align-items:center;gap:1rem}.logo-icon{font-size:1.25rem;color:var(--primary-cyan);filter:drop-shadow(0 0 6px var(--primary-cyan))}.logo-text{font-size:0.95rem;font-weight:600;color:var(--primary-cyan);letter-spacing:0.1em;font-family:'Courier New',monospace;text-transform:uppercase}.header-actions{display:flex;align-items:center;gap:1rem}.header-status{display:flex;align-items:center;gap:1rem}.fullscreen-button{background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);padding:0.4rem 0.6rem;color:var(--text-primary);cursor:pointer;transition:all var(--transition-fast);display:flex;align-items:center;justify-content:center;font-size:0.9rem;min-width:36px;height:36px}.fullscreen-button:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(187,85%,45%,0.14);color:var(--primary-cyan);transform:scale(1.05)}.fullscreen-button:active{transform:scale(0.95)}.start-screen .fullscreen-button{position:absolute;top:1rem;right:1rem;z-index:100}.status-indicator{display:flex;align-items:center;gap:0.4rem;padding:0.3rem 0.6rem;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border-radius:var(--radius-xs);border:1px solid transparent;font-size:0.75rem}.status-dot{width:6px;height:6px;border-radius:50%;background:var(--accent-green);box-shadow:0 0 3px var(--accent-green)}.status-indicator.online .status-dot{background:var(--accent-teal);box-shadow:0 0 10px var(--accent-teal)}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.7;transform:scale(1.1)}}.status-text{font-size:0.7rem;color:var(--text-secondary);font-weight:500;font-family:'Courier New',monospace}.main-content{display:flex;flex-direction:column;flex:1;max-width:100%;margin:0 auto;width:100%;padding:0;gap:0;position:relative;z-index:1;overflow:hidden;min-height:0}.top-nav-menu{display:flex;align-items:center;gap:0.5rem;flex:1;justify-content:center}.nav-item{position:relative;display:flex;align-items:center;gap:0.5rem;padding:0.6rem 1rem;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-secondary);font-size:0.9rem;line-height:1.6;cursor:pointer;transition:all var(--transition-normal) ease;font-weight:500;cursor:pointer;transition:all var(--transition-fast);overflow:hidden;text-align:left;width:100%;font-family:'Courier New',monospace}.nav-item::before{content:'';position:absolute;bottom:0;left:0;width:100%;height:3px;background:var(--gradient-primary);transform:scaleX(0);transition:transform var(--transition-normal)}.nav-item:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(187,85%,45%,0.14);color:var(--text-primary)}.nav-item:hover::before{transform:scaleX(1)}.nav-item.active{background:var(--gradient-glass) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;color:var(--text-primary);box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 24px hsla(187,85%,45%,0.16)}.nav-item.active::before{transform:scaleX(1)}.nav-shortcut{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;background:hsla(220,18%,12%,0.85);border:1px solid hsla(187,85%,45%,0.18);border-radius:7px;font-size:0.7rem;font-weight:600;color:var(--text-tertiary);margin-right:0.25rem;transition:all var(--transition-fast)}.nav-item:hover .nav-shortcut,.nav-item.active .nav-shortcut{background:var(--primary-cyan);border-color:var(--primary-cyan);color:var(--bg-primary)}.nav-icon{font-size:1rem;color:var(--primary-cyan);transition:transform var(--transition-fast);width:16px;text-align:center}.nav-item:hover .nav-icon,.nav-item.active .nav-icon{color:var(--accent-teal)}.nav-text{flex:1}.main-content{flex:1;display:flex;flex-direction:column;overflow:hidden}.content-panel{flex:1;min-width:0;display:flex;flex-direction:column;overflow:hidden;padding:0.75rem}.module-container{display:none;background:var(--gradient-glass) padding-box,var(--panel-border-gradient) border-box;background-color:hsla(220,18%,10%,0.98);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg),0 0 0 1px hsla(187,85%,45%,0.18) inset;overflow:hidden;flex:1;flex-direction:column;min-height:0}.module-container.active{display:flex;animation:fadeInUp 0.4s ease-out}@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.module-header{padding:0.5rem 0.75rem;border-bottom:1px solid var(--border-color);background:var(--bg-glass);flex-shrink:0}.module-title{font-size:0.85rem;font-weight:600;display:flex;align-items:center;gap:0.5rem;color:var(--text-primary);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em}.module-title i{color:var(--primary-cyan)}.maintext-container{margin-bottom:1.2rem;padding:1rem}.maintext-header{display:flex;align-items:center;margin-bottom:0.8rem;padding-bottom:0.6rem;border-bottom:1px solid var(--border-color)}.maintext-title{font-size:0.9rem;font-weight:600;color:var(--text-primary);display:flex;align-items:center;gap:0.5rem;margin:0}.maintext-title i{color:var(--primary-cyan)}.maintext-areas{display:flex;gap:0.75rem;align-items:stretch}.maintext-section{flex:1;display:flex;flex-direction:column;min-width:0}.maintext-section-header{margin-bottom:0.5rem;padding-bottom:0.4rem;border-bottom:1px solid var(--border-color)}.maintext-section-title{font-size:0.7rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px}.maintext-section-area{flex:1;min-height:120px;max-height:300px;overflow-y:auto;padding:0.8rem;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;color:var(--text-primary);font-size:0.85rem;line-height:1.8;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New',monospace;contain:content;overscroll-behavior:contain;-webkit-overflow-scrolling:touch;box-shadow:var(--shadow-sm)}.maintext-section-area::-webkit-scrollbar{width:6px}.maintext-section-area::-webkit-scrollbar-track{background:var(--bg-tertiary);border-radius:3px}.maintext-section-area::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}.maintext-section-area::-webkit-scrollbar-thumb:hover{background:var(--primary-cyan)}.maintext-area{min-height:120px;max-height:300px;overflow-y:auto;padding:0.8rem;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;color:var(--text-primary);font-size:0.85rem;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New','Consolas','Monaco',monospace}.maintext-area::-webkit-scrollbar{width:6px}.maintext-area::-webkit-scrollbar-track{background:var(--bg-tertiary);border-radius:3px}.maintext-area::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}.maintext-area::-webkit-scrollbar-thumb:hover{background:var(--primary-cyan)}.module-body{padding:0.75rem;flex:1;overflow-y:auto;min-height:0}.status-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:0.5rem;margin-bottom:0.75rem}.status-card{padding:0.6rem 0.75rem;transition:all var(--transition-fast);position:relative;overflow:hidden}.status-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gradient-primary);transform:scaleX(0);transition:transform var(--transition-normal)}.status-card:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-lg),0 0 0 1px var(--panel-border-strong) inset,0 0 28px hsla(187,85%,45%,0.18)}.status-card:hover::before{transform:scaleX(1)}.status-card-header{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem}.status-card-icon{font-size:0.85rem;color:var(--primary-cyan);width:14px}.status-card-title{font-size:0.7rem;font-weight:600;color:var(--text-secondary);font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.05em}.status-card-content{margin-top:0.4rem}.status-value{display:flex;flex-direction:column;gap:0.5rem}.value-number{font-size:1rem;font-weight:600;color:var(--primary-cyan);font-family:'Courier New',monospace}.status-bar{width:100%;height:4px;background:var(--bg-tertiary);border-radius:2px;overflow:hidden;position:relative;margin-top:0.3rem}.status-bar-fill{height:100%;background:var(--primary-cyan);border-radius:2px;transition:width var(--transition-slow);position:relative;box-shadow:0 0 4px var(--primary-cyan)}.status-bar-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,hsla(0,0%,100%,0.3),transparent);animation:shimmer 2s infinite}.status-empty{padding:2rem;text-align:center;color:var(--text-tertiary);font-size:0.75rem;font-family:'Courier New',monospace}.status-detail{font-size:0.65rem;color:var(--text-tertiary);margin-top:0.3rem;line-height:1.4}.risk-low{color:var(--accent-green)}.risk-medium{color:var(--accent-orange)}.risk-high{color:var(--accent-red)}.status-bar-fill.status-low{background:var(--accent-green)}.status-bar-fill.status-medium{background:var(--accent-orange)}.status-bar-fill.status-high{background:var(--accent-red)}.status-bar-fill.status-healthy{background:var(--accent-green)}.status-bar-fill.status-warning{background:var(--accent-orange)}.status-bar-fill.status-critical{background:var(--accent-red)}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.status-indicator-small{display:inline-flex;align-items:center;gap:0.5rem}.status-dot-small{width:8px;height:8px;border-radius:50%;background:var(--accent-teal);box-shadow:0 0 8px var(--accent-teal)}.status-indicator-small.healthy .status-dot-small{background:var(--accent-teal);box-shadow:0 0 8px var(--accent-teal)}.status-details{margin-top:0.75rem}.detail-section{padding:0.75rem}.detail-title{font-size:0.75rem;font-weight:600;color:var(--text-secondary);margin-bottom:0.5rem;display:flex;align-items:center;gap:0.4rem;font-family:'Courier New',monospace;text-transform:uppercase;letter-spacing:0.1em}.detail-title::before{content:'';width:4px;height:20px;background:var(--gradient-primary);border-radius:2px}.monitor-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:0.5rem}.monitor-item{display:flex;flex-direction:column;gap:0.25rem;padding:0.5rem 0.6rem;border-radius:var(--radius-xs);transition:all var(--transition-fast)}.monitor-item:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(187,85%,45%,0.14)}.monitor-label{font-size:0.65rem;color:var(--text-tertiary);font-weight:500;font-family:'Courier New',monospace;text-transform:uppercase}.monitor-value{font-size:0.9rem;font-weight:600;color:var(--primary-cyan);font-family:'Courier New',monospace}.placeholder-content{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center;min-height:400px}.placeholder-icon{font-size:4rem;color:var(--primary-cyan);margin-bottom:1.5rem;opacity:0.6;animation:float 3s ease-in-out infinite}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.placeholder-text{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:0.5rem}.placeholder-subtext{font-size:1rem;color:var(--text-secondary)}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:hsla(0,0%,0%,0.7);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:1000;opacity:0;transition:opacity var(--transition-normal)}.modal-overlay.active{display:flex;opacity:1}.modal-container{background:var(--gradient-glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--border-color);border-radius:16px;box-shadow:var(--shadow-lg);max-width:600px;width:90%;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;transform:scale(0.9);transition:transform var(--transition-normal)}.modal-overlay.active .modal-container{transform:scale(1)}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 2rem;border-bottom:1px solid var(--border-color);background:var(--bg-glass)}.modal-title{font-size:1.5rem;font-weight:700;color:var(--text-primary)}.modal-close{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid var(--border-color);border-radius:8px;color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.modal-close:hover{background:var(--bg-tertiary);border-color:var(--primary-cyan);color:var(--text-primary);transform:rotate(90deg)}.modal-body{padding:2rem;overflow-y:auto;flex:1}.modal-detail-content{color:var(--text-primary)}.modal-detail-content p{margin-bottom:1rem;line-height:1.6}@media (max-width:1024px){.main-content{flex-direction:column;padding:0.5rem;gap:0.5rem}.header-content{flex-wrap:wrap;gap:0.75rem}.top-nav-menu{order:3;width:100%;justify-content:center;gap:0.4rem;overflow-x:auto}.nav-item{min-width:100px;padding:0.5rem 0.75rem;font-size:0.85rem}.nav-shortcut{width:18px;height:18px;font-size:0.65rem}.status-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.75rem}.entry-item{padding:0.75rem;gap:0.75rem}.entry-icon{width:32px;height:32px;font-size:1rem}}@media (max-width:768px){.header-content{flex-direction:column;gap:0.5rem;align-items:flex-start}.logo-text{font-size:1rem}.logo-icon{font-size:1.5rem}.status-grid{grid-template-columns:1fr}.monitor-grid{grid-template-columns:1fr}.entry-header{flex-direction:column;align-items:flex-start;gap:0.5rem}.entry-meta{flex-direction:column;align-items:flex-start;gap:0.5rem}}::-webkit-scrollbar{width:10px;height:10px}::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:5px}::-webkit-scrollbar-thumb{background:var(--primary-cyan);border-radius:5px;border:2px solid var(--bg-secondary)}::-webkit-scrollbar-thumb:hover{background:var(--accent-teal)}::selection{background:var(--primary-cyan);color:var(--bg-primary)}::-moz-selection{background:var(--primary-cyan);color:var(--bg-primary)}.fade-in{animation:fadeIn 0.6s ease-out forwards;opacity:0}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.loading{display:inline-block;animation:spin 1s linear infinite}.entry-list{display:flex;flex-direction:column;gap:0.4rem;height:100%;overflow-y:auto;overflow-x:hidden}.entry-item{display:flex;gap:0.75rem;padding:0.6rem 0.75rem;transition:all var(--transition-fast);cursor:pointer;position:relative;flex-shrink:0}.entry-item::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--gradient-primary);transform:scaleY(0);transition:transform var(--transition-normal)}.entry-item:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-lg),0 0 0 1px var(--panel-border-strong) inset,0 0 26px hsla(187,85%,45%,0.16)}.entry-item:hover::before{transform:scaleY(1)}.entry-icon{flex-shrink:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:hsla(220,18%,12%,0.85);border-radius:8px;color:var(--primary-cyan);font-size:0.75rem;border:1px solid hsla(187,85%,45%,0.18);transition:all var(--transition-fast)}.entry-item:hover .entry-icon{background:var(--primary-cyan);color:var(--bg-primary);border-color:var(--primary-cyan)}.entry-content{flex:1;display:flex;flex-direction:column;gap:0.5rem;min-width:0}.entry-header{display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap}.entry-title{font-size:0.75rem;font-weight:600;color:var(--text-primary);flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:'Courier New',monospace}.entry-status{padding:0.15rem 0.4rem;border-radius:3px;font-size:0.65rem;font-weight:600;text-transform:uppercase;flex-shrink:0;font-family:'Courier New',monospace}.entry-status.completed{background:hsla(120,60%,50%,0.2);color:hsl(120,60%,60%);border:1px solid hsl(120,60%,50%)}.entry-status.in-progress{background:hsla(45,80%,50%,0.2);color:hsl(45,80%,60%);border:1px solid hsl(45,80%,50%)}.entry-status.pending{background:hsla(210,60%,50%,0.2);color:hsl(210,60%,60%);border:1px solid hsl(210,60%,50%)}.entry-status.unread{background:hsla(0,70%,50%,0.2);color:hsl(0,70%,60%);border:1px solid hsl(0,70%,50%)}.entry-status.read{background:hsla(210,20%,30%,0.2);color:var(--text-tertiary);border:1px solid var(--border-color)}.entry-meta{display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap;font-size:0.65rem;color:var(--text-tertiary);font-family:'Courier New',monospace}.entry-time,.entry-date,.entry-sender{display:flex;align-items:center;gap:0.25rem}.entry-time::before,.entry-date::before{content:'\f017';font-family:'Font Awesome 6 Free';font-weight:900;font-size:0.75rem;opacity:0.6}.entry-sender::before{content:'\f007';font-family:'Font Awesome 6 Free';font-weight:900;font-size:0.75rem;opacity:0.6}.entry-priority{padding:0.15rem 0.35rem;border-radius:3px;font-size:0.65rem;font-weight:600;flex-shrink:0;font-family:'Courier New',monospace}.entry-priority.priority-urgent{background:hsla(0,70%,50%,0.2);color:hsl(0,70%,60%);border:1px solid hsl(0,70%,50%)}.entry-priority.priority-high{background:hsla(15,70%,50%,0.2);color:hsl(15,70%,60%);border:1px solid hsl(15,70%,50%)}.entry-priority.priority-medium{background:hsla(45,70%,50%,0.2);color:hsl(45,70%,60%);border:1px solid hsl(45,70%,50%)}.entry-priority.priority-low{background:hsla(210,40%,50%,0.2);color:hsl(210,40%,60%);border:1px solid hsl(210,40%,50%)}.entry-description{font-size:0.7rem;color:var(--text-secondary);line-height:1.4;margin-top:0.2rem;word-wrap:break-word;white-space:normal}.entry-item:hover .entry-description{color:var(--text-primary)}.communication-body{position:relative;display:flex;flex-direction:column;height:100%;padding:0 !important;overflow:hidden !important}.chat-messages{flex:1;min-height:0;overflow:hidden;padding:0.75rem 1rem;padding-bottom:0.5rem;display:flex;flex-direction:column;gap:0.9rem}.message-item{display:flex;align-items:flex-end;gap:0.35rem;padding:0;min-height:0}.message-item.message-user{justify-content:flex-end;flex:0 1 auto;min-height:0}.message-item.message-assistant{justify-content:flex-start;flex:1;min-height:0;align-items:stretch}.message-item.message-assistant .message-bubble{height:100%;width:83%;max-width:83%}.message-bubble{position:relative;max-width:96%;width:-moz-fit-content;width:fit-content;overflow:hidden;padding:0.85rem 1rem;border-radius:20px;background:var(--bubble-bg,radial-gradient(circle at 25% 25%,hsla(183,70%,35%,0.18),hsla(183,65%,18%,0.32)));background-color:hsla(183,65%,15%,0.85);border:1px solid var(--bubble-border,hsla(183,75%,55%,0.6));box-shadow:0 10px 26px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.08);transition:box-shadow var(--transition-fast),border-color var(--transition-fast);display:flex;flex-direction:column;min-height:0}.message-bubble:hover{box-shadow:0 12px 30px rgba(0,0,0,0.32),inset 0 1px 0 rgba(255,255,255,0.12);border-color:hsla(183,90%,65%,0.7)}.message-bubble::before,.message-bubble::after{content:'';position:absolute;background:inherit;border:1px solid inherit;border-radius:50%;box-shadow:inset 0 1px 0 rgba(255,255,255,0.14)}.message-bubble::before{width:14px;height:14px;bottom:-7px}.message-bubble::after{width:9px;height:9px;bottom:-14px;opacity:0.85}.message-assistant .message-bubble{--bubble-bg:radial-gradient(circle at 22% 20%,hsla(183,80%,42%,0.24),hsla(183,70%,16%,0.32));--bubble-border:hsla(183,80%,55%,0.55)}.message-assistant .message-bubble::before{left:16px}.message-assistant .message-bubble::after{left:6px}.message-user .message-bubble{--bubble-bg:radial-gradient(circle at 78% 20%,hsla(280,70%,48%,0.24),hsla(280,50%,16%,0.32));--bubble-border:hsla(280,70%,60%,0.55);align-self:flex-end}.message-user .message-bubble::before{right:16px}.message-user .message-bubble::after{right:6px}.message-content-three-columns{display:flex;gap:0.75rem;align-items:stretch;flex:1;min-height:0;overflow:visible;width:auto;max-width:100%;flex-wrap:nowrap;justify-content:flex-start}.message-column{flex:1 1 0;min-width:0;max-width:25vw;display:flex;flex-direction:column;min-height:0;overflow-y:auto;padding:0.6rem;contain:content;overscroll-behavior:contain;-webkit-overflow-scrolling:touch;box-shadow:var(--shadow-sm);background:var(--bg-secondary);border:1px solid var(--border-color)}.message-column-header{font-size:0.85rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:0.4rem;padding-bottom:0.3rem;border-bottom:1px solid var(--border-color)}.message-column-content{flex:1;color:var(--text-primary);font-size:0.85rem;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New',monospace}.message-column::-webkit-scrollbar{width:4px}.message-column::-webkit-scrollbar-track{background:var(--bg-tertiary);border-radius:2px}.message-column::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:2px}.message-column::-webkit-scrollbar-thumb:hover{background:var(--primary-cyan)}.message-content{font-size:0.85rem;line-height:1.8;color:var(--text-primary);word-wrap:break-word;white-space:pre-wrap;margin-top:0.1rem;font-family:'Courier New',monospace;width:100%}.message-time{font-size:0.65rem;color:var(--text-tertiary);white-space:nowrap;margin-left:0.4rem;font-family:'Courier New',monospace;text-align:right;margin-top:0.45rem}.chat-input-container{flex-shrink:0;padding:0.75rem 1rem;padding-top:0.5rem;border-top:1px solid var(--border-color);background:var(--bg-glass);min-height:60px;margin-top:auto}.chat-input-wrapper{display:flex;align-items:flex-end;gap:0.5rem;max-width:100%}.chat-input{flex:1;min-height:32px;max-height:80px;padding:0.4rem 0.6rem;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-primary);font-size:0.75rem;font-family:'Courier New',monospace;line-height:1.4;resize:none;overflow-y:auto;transition:all var(--transition-fast)}.chat-input:focus{outline:none;box-shadow:0 0 0 2px hsla(187,85%,45%,0.22),0 0 20px hsla(187,85%,45%,0.12)}.chat-input::placeholder{color:var(--text-tertiary)}.chat-send-btn{flex-shrink:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--primary-cyan);border:none;border-radius:4px;color:var(--bg-primary);font-size:0.8rem;cursor:pointer;transition:all var(--transition-fast)}.chat-send-btn:hover{background:var(--accent-teal);box-shadow:0 0 6px var(--accent-teal)}.chat-send-btn:active{opacity:0.8}.chat-send-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}.chat-show-options-btn{flex-shrink:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-secondary);font-size:0.75rem;cursor:pointer;transition:all var(--transition-fast)}.chat-show-options-btn:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(187,85%,45%,0.14);color:var(--primary-cyan)}.chat-show-options-btn:active{opacity:0.8;transform:scale(0.95)}.chat-regenerate-btn{flex-shrink:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--panel-bg) padding-box,var(--panel-border-gradient) border-box;border:1px solid transparent;border-radius:var(--radius-xs);color:var(--text-secondary);font-size:0.75rem;cursor:pointer;transition:all var(--transition-fast)}.chat-regenerate-btn:hover{background:var(--panel-bg-hover) padding-box,var(--panel-border-gradient) border-box;box-shadow:var(--shadow-md),0 0 0 1px var(--panel-border-strong) inset,0 0 18px hsla(30,80%,45%,0.14);color:var(--accent-orange)}.chat-regenerate-btn:active{opacity:0.8;transform:scale(0.95)}.chat-regenerate-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}.chat-options-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,0.85);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:opacity var(--transition-normal),visibility var(--transition-normal);pointer-events:none}.chat-options-overlay.active{opacity:1;visibility:visible;pointer-events:all}.chat-options-container{position:absolute;top:1rem;right:1rem;border-radius:var(--radius-md);padding:0.75rem 1rem;box-shadow:0 8px 32px rgba(0,0,0,0.5),0 0 16px hsla(180,100%,40%,0.2);display:flex;align-items:center;gap:0.75rem;z-index:1001;pointer-events:auto}.chat-options-header{display:flex;align-items:center;justify-content:space-between;gap:0.75rem}.chat-options-title{font-size:0.8rem;font-weight:600;color:var(--text-primary);text-transform:uppercase;letter-spacing:0.5px}.chat-options-close{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid var(--border-color);border-radius:4px;color:var(--text-secondary);font-size:0.8rem;cursor:pointer;transition:all var(--transition-fast)}.chat-options-close:hover{background:var(--bg-tertiary);border-color:var(--primary-cyan);color:var(--primary-cyan)}.chat-options-list{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;pointer-events:none;overflow:visible}.chat-options-list::-webkit-scrollbar{width:6px}.chat-options-list::-webkit-scrollbar-track{background:var(--bg-tertiary);border-radius:3px}.chat-options-list::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}.chat-options-list::-webkit-scrollbar-thumb:hover{background:var(--primary-cyan)}.chat-option{display:inline-flex;align-items:center;justify-content:center;opacity:0;transform:translate(-50%,-50%) scale(0.85) rotate(var(--rot));transition:opacity 0.35s ease,transform 0.45s cubic-bezier(0.22,1,0.36,1),filter 0.3s ease;animation:thought-float 4.5s ease-in-out infinite}.chat-option.show{opacity:1;transform:translate(-50%,-50%) scale(1) rotate(var(--rot))}@keyframes thought-float{0%{transform:translate(-50%,-52%) rotate(var(--rot))}50%{transform:translate(-50%,-48%) rotate(var(--rot))}100%{transform:translate(-50%,-52%) rotate(var(--rot))}}.chat-option-button{position:relative;width:136px;height:136px;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;padding:1.2rem;border-radius:50% 45% 52% 48%/48% 52% 45% 50%;overflow:visible;background:radial-gradient(circle at 25% 25%,hsla(183,80%,42%,0.28),hsla(183,70%,16%,0.38));border:1px solid hsla(183,80%,55%,0.55);color:var(--text-primary);cursor:pointer;box-shadow:0 10px 25px rgba(0,0,0,0.4),inset 0 1px 1px rgba(255,255,255,0.1);backdrop-filter:blur(8px);will-change:transform,filter;transition:transform var(--transition-normal),box-shadow var(--transition-normal),border-color var(--transition-normal),background var(--transition-normal),filter var(--transition-normal)}.chat-option-button:hover{transform:scale(1.12);background:radial-gradient(circle at 25% 25%,hsla(183,90%,50%,0.35),hsla(183,80%,20%,0.45));border-color:var(--primary-cyan);box-shadow:0 15px 35px rgba(0,0,0,0.5),0 0 20px hsla(180,100%,40%,0.4);filter:brightness(1.1)}.chat-option-button:active{transform:scale(0.9);transition:transform 0.1s ease}.chat-option-text{font-size:0.8rem;line-height:1.3;text-align:center;width:100%;max-height:80%;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;line-clamp:3;overflow:hidden;word-break:break-word;pointer-events:none;color:var(--text-primary);font-family:'Courier New',monospace;font-weight:500;text-shadow:0 1px 3px rgba(0,0,0,0.8);padding:0 0.8rem}.chat-options-list:has(.chat-option:hover) .chat-option:not(:hover){opacity:0.75}.chat-options-list:has(.chat-option:hover) .chat-option:not(:hover) .chat-option-button{filter:blur(3px) grayscale(0.2) brightness(0.95)}@supports not selector(:has(*)){.chat-options-list:hover .chat-option:not(:hover){opacity:0.75}.chat-options-list:hover .chat-option:not(:hover) .chat-option-button{filter:blur(3px) grayscale(0.2) brightness(0.95)}}.chat-option:hover{z-index:10;opacity:1 !important;filter:none !important}.chat-option:hover .chat-option-button{filter:brightness(1.2) contrast(1.1);transform:scale(1.12);box-shadow:0 12px 32px rgba(0,0,0,0.4),0 0 25px hsla(180,100%,40%,0.5)}.chat-option-button.selected{transform:scale(1.4);background:var(--primary-cyan);border-color:white;color:white;box-shadow:0 0 40px hsla(180,100%,40%,0.6);z-index:100;animation:none}.chat-option-button.selected .chat-option-text{color:white;text-shadow:0 1px 3px rgba(0,0,0,0.3)}.chat-options-list.collapse .chat-option:not(.selected-parent){opacity:0.3;transform:translate(-50%,-50%) scale(0.85);pointer-events:none}.chat-options-list.collapse .chat-option:not(.selected-parent) .chat-option-button{filter:blur(6px) grayscale(0.5) brightness(0.9)}.chat-option.selected-parent{z-index:20}.chat-no-options-message{width:100%;padding:1rem}.chat-no-options-content{border-radius:var(--radius-md);padding:1rem 1.5rem;display:flex;align-items:center;justify-content:space-between;gap:1rem}.chat-no-options-text{color:var(--text-primary);font-size:0.9rem;font-family:'Courier New',monospace}.chat-no-options-close{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid var(--border-color);border-radius:50%;color:var(--text-secondary);font-size:1.2rem;cursor:pointer;transition:all var(--transition-fast);flex-shrink:0}.chat-no-options-close:hover{background:var(--bg-tertiary);border-color:var(--primary-cyan);color:var(--primary-cyan)}.message-streaming{opacity:0.8}.streaming-indicator{display:flex;align-items:center;gap:0.4rem;margin-bottom:0.3rem;color:var(--primary-cyan);font-size:0.7rem}.streaming-dot{width:6px;height:6px;border-radius:50%;background:var(--primary-cyan);animation:streaming-pulse 1.5s ease-in-out infinite}@keyframes streaming-pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.8)}}.streaming-text{font-family:'Courier New',monospace;font-size:0.7rem}.streaming-text-content{color:var(--text-primary);font-size:0.75rem;line-height:1.4;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New',monospace;margin-top:0.2rem}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app" class="space-station-app"></div></body>